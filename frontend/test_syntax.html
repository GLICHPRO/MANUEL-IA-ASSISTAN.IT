<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GIDEON 4.0 - Unified Intelligence Platform</title>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;500;700;900&family=Rajdhani:wght@300;400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
    <style>
        :root {
            --neon-cyan: #00f5ff;
            --neon-magenta: #ff00ff;
            --neon-blue: #0080ff;
            --neon-purple: #8000ff;
            --neon-green: #00ff88;
            --neon-yellow: #ffcc00;
            --neon-red: #ff3366;
            --neon-orange: #ff8800;
            
            --pilot-color: #00ff88;
            --copilot-color: #00f5ff;
            --passive-color: #888888;
            --executive-color: #ff00ff;
            
            --dark-bg: #050508;
            --dark-card: rgba(10, 10, 18, 0.95);
            --glass-border: rgba(0, 245, 255, 0.25);
            --current-mode-color: var(--copilot-color);
            
            /* Module Colors */
            --science-color: #00ff88;
            --medical-color: #ff3366;
            --security-color: #ffcc00;
            --military-color: #ff8800;
            
            /* Glow effects */
            --glow-cyan: 0 0 20px rgba(0,245,255,0.5), 0 0 40px rgba(0,245,255,0.3);
            --glow-purple: 0 0 20px rgba(128,0,255,0.5), 0 0 40px rgba(128,0,255,0.3);
            --glow-green: 0 0 20px rgba(0,255,136,0.5), 0 0 40px rgba(0,255,136,0.3);
        }
        
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body {
            font-family: 'Rajdhani', sans-serif;
            background: var(--dark-bg);
            min-height: 100vh;
            color: #fff;
            overflow-x: hidden;
        }
        
        /* ============ FUTURISTIC BACKGROUND ============ */
        body::before {
            content: '';
            position: fixed;
            top: 0; left: 0;
            width: 100%; height: 100%;
            background: 
                radial-gradient(ellipse at 20% 20%, rgba(0,245,255,0.08) 0%, transparent 50%),
                radial-gradient(ellipse at 80% 80%, rgba(128,0,255,0.08) 0%, transparent 50%),
                radial-gradient(ellipse at 50% 50%, rgba(0,128,255,0.05) 0%, transparent 60%);
            pointer-events: none;
            z-index: -2;
            animation: backgroundShift 20s ease-in-out infinite;
        }
        
        @keyframes backgroundShift {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }
        
        /* Animated Grid */
        body::after {
            content: '';
            position: fixed;
            top: 0; left: 0;
            width: 100%; height: 100%;
            background: 
                linear-gradient(90deg, rgba(0,245,255,0.03) 1px, transparent 1px),
                linear-gradient(rgba(0,245,255,0.03) 1px, transparent 1px);
            background-size: 50px 50px;
            pointer-events: none;
            z-index: -1;
            animation: gridPulse 8s ease-in-out infinite;
        }
        
        @keyframes gridPulse {
            0%, 100% { opacity: 0.5; }
            50% { opacity: 1; }
        }
        
        /* Scanlines Effect */
        .scanlines {
            position: fixed;
            top: 0; left: 0;
            width: 100%; height: 100%;
            background: repeating-linear-gradient(
                0deg,
                transparent,
                transparent 2px,
                rgba(0,0,0,0.1) 2px,
                rgba(0,0,0,0.1) 4px
            );
            pointer-events: none;
            z-index: 9999;
            opacity: 0.3;
        }
        
        /* ============ FLOATING PARTICLES ============ */
        .particles-container {
            position: fixed;
            top: 0; left: 0;
            width: 100%; height: 100%;
            pointer-events: none;
            z-index: -1;
            overflow: hidden;
        }
        
        .particle {
            position: absolute;
            width: 4px;
            height: 4px;
            background: var(--neon-cyan);
            border-radius: 50%;
            box-shadow: 0 0 10px var(--neon-cyan), 0 0 20px var(--neon-cyan);
            animation: floatParticle 15s linear infinite;
            opacity: 0.6;
        }
        
        @keyframes floatParticle {
            0% { transform: translateY(100vh) rotate(0deg); opacity: 0; }
            10% { opacity: 0.6; }
            90% { opacity: 0.6; }
            100% { transform: translateY(-100vh) rotate(720deg); opacity: 0; }
        }
        
        /* ============ CORNER DECORATIONS ============ */
        .corner-decoration {
            position: fixed;
            width: 100px;
            height: 100px;
            pointer-events: none;
            z-index: 9998;
        }
        
        .corner-decoration.top-left {
            top: 0; left: 0;
            border-top: 2px solid var(--neon-cyan);
            border-left: 2px solid var(--neon-cyan);
            animation: cornerGlow 3s ease-in-out infinite;
        }
        
        .corner-decoration.top-right {
            top: 0; right: 0;
            border-top: 2px solid var(--neon-purple);
            border-right: 2px solid var(--neon-purple);
            animation: cornerGlow 3s ease-in-out infinite 0.5s;
        }
        
        .corner-decoration.bottom-left {
            bottom: 0; left: 0;
            border-bottom: 2px solid var(--neon-purple);
            border-left: 2px solid var(--neon-purple);
            animation: cornerGlow 3s ease-in-out infinite 1s;
        }
        
        .corner-decoration.bottom-right {
            bottom: 0; right: 0;
            border-bottom: 2px solid var(--neon-cyan);
            border-right: 2px solid var(--neon-cyan);
            animation: cornerGlow 3s ease-in-out infinite 1.5s;
        }
        
        @keyframes cornerGlow {
            0%, 100% { 
                box-shadow: inset 0 0 20px rgba(0,245,255,0.2);
                opacity: 0.5;
            }
            50% { 
                box-shadow: inset 0 0 40px rgba(0,245,255,0.4);
                opacity: 1;
            }
        }
        
        /* ============ MAIN LAYOUT ============ */
        .main-container {
            display: grid;
            grid-template-columns: 280px 1fr 320px;
            grid-template-rows: 70px 1fr;
            height: 100vh;
            gap: 0;
        }
        
        /* ============ TOP BAR - ENHANCED ============ */
        .top-bar {
            grid-column: 1 / -1;
            background: linear-gradient(180deg, rgba(10,10,18,0.98) 0%, rgba(5,5,10,0.95) 100%);
            border-bottom: 1px solid var(--glass-border);
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 25px;
            z-index: 100;
            backdrop-filter: blur(20px);
            box-shadow: 0 5px 30px rgba(0,0,0,0.5);
        }
        
        .logo-section {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .logo {
            width: 50px;
            height: 50px;
            background: linear-gradient(135deg, var(--neon-cyan), var(--neon-purple));
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-family: 'Orbitron', monospace;
            font-weight: 900;
            font-size: 1.5em;
            color: #000;
            box-shadow: var(--glow-cyan);
            animation: logoPulse 3s ease-in-out infinite;
            position: relative;
            overflow: hidden;
        }
        
        .logo::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: linear-gradient(
                45deg,
                transparent,
                rgba(255,255,255,0.3),
                transparent
            );
            animation: logoShine 3s ease-in-out infinite;
        }
        
        @keyframes logoShine {
            0% { transform: translateX(-100%) rotate(45deg); }
            100% { transform: translateX(100%) rotate(45deg); }
        }
        
        @keyframes logoPulse {
            0%, 100% { box-shadow: var(--glow-cyan); transform: scale(1); }
            50% { box-shadow: 0 0 35px rgba(0,245,255,0.8), 0 0 60px rgba(128,0,255,0.5); transform: scale(1.02); }
        }
        
        .logo-text {
            font-family: 'Orbitron', monospace;
        }
        
        .logo-text h1 {
            font-size: 1.5em;
            font-weight: 700;
            background: linear-gradient(90deg, var(--neon-cyan), var(--neon-purple), var(--neon-cyan));
            background-size: 200% auto;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            animation: textGradient 5s linear infinite;
        }
        
        @keyframes textGradient {
            0% { background-position: 0% center; }
            100% { background-position: 200% center; }
        }
        
        .logo-text span {
            font-size: 0.7em;
            color: rgba(255,255,255,0.5);
            letter-spacing: 4px;
            text-transform: uppercase;
        }
        
        /* Mode Selector - Enhanced */
        .mode-selector {
            display: flex;
            gap: 10px;
            padding: 5px;
            background: rgba(0,0,0,0.3);
            border-radius: 12px;
            border: 1px solid rgba(255,255,255,0.1);
        }
        
        .mode-btn {
            padding: 12px 22px;
            border: 1px solid transparent;
            border-radius: 8px;
            background: transparent;
            color: rgba(255,255,255,0.5);
            font-family: 'Orbitron', monospace;
            font-size: 0.75em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
        }
        
        .mode-btn::before {
            content: '';
            position: absolute;
            top: 0; left: -100%;
            width: 100%; height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
            transition: left 0.5s ease;
        }
        
        .mode-btn:hover::before {
            left: 100%;
        }
        
        .mode-btn:hover {
            border-color: var(--neon-cyan);
            color: var(--neon-cyan);
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(0,245,255,0.2);
        }
        
        .mode-btn.active {
            background: linear-gradient(135deg, rgba(0,245,255,0.2), rgba(128,0,255,0.1));
            border-color: var(--current-mode-color);
            color: var(--current-mode-color);
            box-shadow: 0 0 20px rgba(0,245,255,0.3);
        }
        
        /* Status Indicators */
        .status-section {
            display: flex;
            align-items: center;
            gap: 20px;
        }
        
        .status-item {
            display: flex;
            align-items: center;
            gap: 8px;
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.8em;
            color: rgba(255,255,255,0.7);
        }
        
        .status-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: var(--neon-green);
            box-shadow: 0 0 10px var(--neon-green);
            animation: statusBlink 2s ease-in-out infinite;
        }
        
        @keyframes statusBlink {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
        
        /* Debug Button */
        .debug-btn {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 8px 16px;
            background: rgba(255,102,0,0.1);
            border: 1px solid rgba(255,102,0,0.3);
            border-radius: 8px;
            color: var(--neon-orange);
            font-family: 'Orbitron', monospace;
            font-size: 0.75em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }
        
        .debug-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,102,0,0.2), transparent);
            transition: left 0.5s ease;
        }
        
        .debug-btn:hover::before {
            left: 100%;
        }
        
        .debug-btn:hover {
            background: rgba(255,102,0,0.2);
            border-color: var(--neon-orange);
            box-shadow: 0 0 20px rgba(255,102,0,0.3);
            transform: scale(1.05);
        }
        
        .debug-btn.active {
            background: linear-gradient(135deg, rgba(255,102,0,0.3), rgba(255,51,0,0.2));
            border-color: var(--neon-orange);
            box-shadow: 0 0 25px rgba(255,102,0,0.5);
            animation: debugPulse 1.5s ease-in-out infinite;
        }
        
        @keyframes debugPulse {
            0%, 100% { box-shadow: 0 0 15px rgba(255,102,0,0.4); }
            50% { box-shadow: 0 0 30px rgba(255,102,0,0.7); }
        }
        
        .debug-icon {
            font-size: 1.2em;
        }
        
        /* Scheduler Panel Styles */
        .scheduler-container {
            display: flex;
            flex-direction: column;
            gap: 25px;
        }
        
        .scheduler-section {
            background: rgba(0, 0, 0, 0.3);
            border: 1px solid rgba(0, 255, 255, 0.2);
            border-radius: 12px;
            padding: 20px;
        }
        
        .schedule-form {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }
        
        .schedule-input {
            background: rgba(0, 0, 0, 0.4);
            border: 1px solid rgba(0, 255, 255, 0.3);
            border-radius: 8px;
            padding: 12px 15px;
            color: var(--text-primary);
            font-family: 'Inter', sans-serif;
            font-size: 0.95rem;
            transition: all 0.3s ease;
        }
        
        .schedule-input:focus {
            outline: none;
            border-color: var(--accent-cyan);
            box-shadow: 0 0 15px rgba(0, 255, 255, 0.2);
        }
        
        .schedule-time-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
        }
        
        .datetime-input {
            color-scheme: dark;
        }
        
        .scheduled-tasks {
            max-height: 200px;
            overflow-y: auto;
        }
        
        .scheduled-task-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: rgba(0, 255, 255, 0.05);
            border: 1px solid rgba(0, 255, 255, 0.2);
            border-radius: 8px;
            padding: 12px 15px;
            margin-bottom: 10px;
            transition: all 0.3s ease;
        }
        
        .scheduled-task-item:hover {
            background: rgba(0, 255, 255, 0.1);
            border-color: var(--accent-cyan);
        }
        
        .task-info {
            flex: 1;
        }
        
        .task-name {
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 4px;
        }
        
        .task-time {
            font-size: 0.85rem;
            color: var(--text-secondary);
        }
        
        .task-delete {
            background: transparent;
            border: 1px solid rgba(255, 82, 82, 0.4);
            color: #ff5252;
            padding: 6px 12px;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .task-delete:hover {
            background: rgba(255, 82, 82, 0.2);
            border-color: #ff5252;
        }
        
        .empty-scheduler {
            text-align: center;
            color: var(--text-secondary);
            padding: 20px;
            font-style: italic;
        }
        
        .automation-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
        }
        
        .automation-card {
            background: rgba(0, 0, 0, 0.3);
            border: 1px solid rgba(0, 255, 255, 0.2);
            border-radius: 10px;
            padding: 15px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .automation-card:hover {
            background: rgba(0, 255, 255, 0.1);
            border-color: var(--accent-cyan);
            transform: translateY(-2px);
        }
        
        .automation-icon {
            font-size: 1.8rem;
            margin-bottom: 8px;
        }
        
        .automation-name {
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 8px;
            font-size: 0.9rem;
        }
        
        .automation-status {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 0.75rem;
            font-weight: 700;
            background: rgba(255, 82, 82, 0.2);
            color: #ff5252;
            border: 1px solid rgba(255, 82, 82, 0.4);
        }
        
        .automation-status.on {
            background: rgba(0, 255, 136, 0.2);
            color: #00ff88;
            border-color: rgba(0, 255, 136, 0.4);
        }

        /* Scheduler Styles */
        .scheduler-container {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }
        
        .scheduler-section {
            background: rgba(0, 0, 0, 0.3);
            border: 1px solid rgba(0, 255, 255, 0.2);
            border-radius: 12px;
            padding: 20px;
        }
        
        .schedule-form {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }
        
        .schedule-input {
            background: rgba(0, 0, 0, 0.5);
            border: 1px solid rgba(0, 255, 255, 0.3);
            border-radius: 8px;
            padding: 12px 15px;
            color: white;
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.9rem;
        }
        
        .schedule-input:focus {
            outline: none;
            border-color: var(--accent-cyan);
            box-shadow: 0 0 10px rgba(0, 255, 255, 0.2);
        }
        
        .schedule-time-row {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 12px;
        }
        
        .datetime-input {
            color-scheme: dark;
        }
        
        .scheduled-tasks {
            max-height: 200px;
            overflow-y: auto;
        }
        
        .scheduled-task {
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: rgba(0, 255, 255, 0.05);
            border: 1px solid rgba(0, 255, 255, 0.2);
            border-radius: 8px;
            padding: 12px 15px;
            margin-bottom: 8px;
        }
        
        .scheduled-task.completed {
            opacity: 0.5;
            border-color: rgba(0, 255, 136, 0.3);
        }
        
        .task-info {
            flex: 1;
        }
        
        .task-name {
            color: var(--text-primary);
            font-weight: 600;
            margin-bottom: 4px;
        }
        
        .task-time {
            color: var(--text-secondary);
            font-size: 0.8rem;
        }
        
        .task-btn {
            background: rgba(255, 82, 82, 0.2);
            border: 1px solid rgba(255, 82, 82, 0.4);
            color: #ff5252;
            padding: 6px 10px;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .task-btn:hover {
            background: rgba(255, 82, 82, 0.4);
        }
        
        .empty-scheduler {
            color: var(--text-secondary);
            text-align: center;
            padding: 20px;
            font-style: italic;
        }

        /* ============ RESPONSE MODE SELECTOR ============ */
        .response-mode-selector {
            display: flex;
            gap: 8px;
            margin-bottom: 12px;
            justify-content: center;
            padding: 0 15px;
        }
        
        .response-mode-btn {
            padding: 6px 14px;
            border-radius: 20px;
            border: 1px solid rgba(255,255,255,0.2);
            background: rgba(0, 0, 0, 0.3);
            color: #888;
            font-family: 'Rajdhani', sans-serif;
            font-size: 0.8em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        .response-mode-btn:hover {
            background: rgba(255, 255, 255, 0.1);
            color: #aaa;
        }
        
        .response-mode-btn.active {
            border-color: var(--neon-cyan);
            color: var(--neon-cyan);
            background: rgba(0, 245, 255, 0.15);
            box-shadow: 0 0 10px rgba(0, 245, 255, 0.3);
        }
        
        .response-mode-btn.eco.active {
            border-color: #00ff66;
            color: #00ff66;
            background: rgba(0, 255, 100, 0.15);
            box-shadow: 0 0 10px rgba(0, 255, 100, 0.3);
        }
        
        .response-mode-btn.fast.active {
            border-color: #ffaa00;
            color: #ffaa00;
            background: rgba(255, 170, 0, 0.15);
            box-shadow: 0 0 10px rgba(255, 170, 0, 0.3);
        }
        
        .response-mode-btn.deep.active {
            border-color: #aa66ff;
            color: #aa66ff;
            background: rgba(170, 100, 255, 0.15);
            box-shadow: 0 0 10px rgba(170, 100, 255, 0.3);
        }
        
        .mode-indicator {
            font-size: 1em;
        }

        /* ============ QUICK ACTIONS ============ */
        .quick-actions {
            display: flex;
            gap: 8px;
            padding: 10px 15px;
            overflow-x: auto;
            scrollbar-width: none;
            justify-content: flex-start;
            flex-wrap: nowrap;
        }
        
        .quick-actions::-webkit-scrollbar { display: none; }
        
        .quick-action {
            padding: 8px 14px;
            background: rgba(0, 245, 255, 0.05);
            border: 1px solid var(--glass-border);
            border-radius: 20px;
            color: var(--neon-cyan);
            font-family: 'Rajdhani', sans-serif;
            font-size: 0.8em;
            font-weight: 600;
            cursor: pointer;
            white-space: nowrap;
            transition: all 0.3s ease;
            letter-spacing: 0.5px;
        }
        
        .quick-action:hover {
            background: rgba(0, 245, 255, 0.15);
            border-color: var(--neon-cyan);
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 245, 255, 0.3);
        }

        /* ============ REASONING PREVIEW ============ */
        .reasoning-preview {
            display: none;
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.75em;
            color: var(--neon-purple);
            padding: 10px 15px;
            background: rgba(128, 0, 255, 0.1);
            border-left: 2px solid var(--neon-purple);
            border-radius: 0 8px 8px 0;
            margin: 8px 15px;
        }
        
        .reasoning-preview.active {
            display: block;
            animation: fadeIn 0.3s ease;
        }

        /* ============ AVATAR 3D HOLOGRAPHIC ADVANCED ============ */
        .avatar-container {
            position: fixed;
            top: 80px;
            right: 20px;
            width: 220px;
            height: 320px;
            z-index: 100;
            perspective: 1200px;
            --avatar-color: #00f5ff;
            --avatar-secondary: #8000ff;
            --avatar-energy: #00ff88;
        }
        
        .avatar-hologram {
            width: 100%;
            height: 100%;
            position: relative;
            transform-style: preserve-3d;
            animation: float-3d 6s ease-in-out infinite;
        }
        
        @keyframes float-3d {
            0%, 100% { transform: translateY(0) rotateY(0deg) rotateX(0deg); }
            25% { transform: translateY(-8px) rotateY(3deg) rotateX(2deg); }
            50% { transform: translateY(-15px) rotateY(0deg) rotateX(-2deg); }
            75% { transform: translateY(-8px) rotateY(-3deg) rotateX(2deg); }
        }
        
        /* Multi-layer holographic glow */
        .avatar-glow {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 200px;
            height: 200px;
            border-radius: 50%;
            background: 
                radial-gradient(circle at 30% 30%, rgba(0,245,255,0.4) 0%, transparent 50%),
                radial-gradient(circle at 70% 70%, rgba(128,0,255,0.3) 0%, transparent 50%),
                radial-gradient(circle, var(--avatar-color) 0%, transparent 70%);
            opacity: 0.5;
            filter: blur(25px);
            animation: pulse-glow-multi 3s ease-in-out infinite;
        }
        
        .avatar-glow::after {
            content: '';
            position: absolute;
            inset: -20px;
            border-radius: 50%;
            background: radial-gradient(circle, var(--avatar-secondary) 0%, transparent 60%);
            opacity: 0.3;
            animation: pulse-glow-secondary 2s ease-in-out infinite 0.5s;
        }
        
        @keyframes pulse-glow-multi {
            0%, 100% { opacity: 0.4; transform: translate(-50%, -50%) scale(1); filter: blur(25px) hue-rotate(0deg); }
            50% { opacity: 0.7; transform: translate(-50%, -50%) scale(1.15); filter: blur(30px) hue-rotate(15deg); }
        }
        
        @keyframes pulse-glow-secondary {
            0%, 100% { opacity: 0.2; transform: scale(1); }
            50% { opacity: 0.4; transform: scale(1.2); }
        }
        
        @keyframes slideInRight {
            from {
                opacity: 0;
                transform: translateX(100px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }
        
        /* Rotating orbital rings */
        .avatar-ring {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 180px;
            height: 180px;
            border: 2px solid transparent;
            border-top-color: var(--avatar-color);
            border-radius: 50%;
            opacity: 0.7;
            animation: rotate-ring-x 6s linear infinite;
            box-shadow: 0 0 20px var(--avatar-color);
        }
        
        .avatar-ring::before {
            content: '';
            position: absolute;
            inset: 10px;
            border: 2px solid transparent;
            border-right-color: var(--avatar-secondary);
            border-radius: 50%;
            animation: rotate-ring-y 4s linear infinite reverse;
        }
        
        .avatar-ring::after {
            content: '';
            position: absolute;
            top: -8px;
            left: 50%;
            width: 16px;
            height: 16px;
            background: var(--avatar-color);
            border-radius: 50%;
            box-shadow: 0 0 20px var(--avatar-color), 0 0 40px var(--avatar-color);
            animation: energy-pulse 1s ease-in-out infinite;
        }
        
        @keyframes rotate-ring-x {
            from { transform: translate(-50%, -50%) rotateX(75deg) rotateZ(0deg); }
            to { transform: translate(-50%, -50%) rotateX(75deg) rotateZ(360deg); }
        }
        
        @keyframes rotate-ring-y {
            from { transform: rotateY(0deg); }
            to { transform: rotateY(360deg); }
        }
        
        @keyframes energy-pulse {
            0%, 100% { transform: translateX(-50%) scale(1); opacity: 1; }
            50% { transform: translateX(-50%) scale(1.5); opacity: 0.6; }
        }
        
        /* Second orbital ring */
        .avatar-ring-secondary {
            position: absolute;
            top: 50%;
            left: 50%;
            width: 150px;
            height: 150px;
            border: 1px solid var(--avatar-energy);
            border-radius: 50%;
            opacity: 0.4;
            animation: rotate-ring-z 8s linear infinite;
            transform-origin: center;
        }
        
        @keyframes rotate-ring-z {
            from { transform: translate(-50%, -50%) rotateY(60deg) rotateZ(0deg); }
            to { transform: translate(-50%, -50%) rotateY(60deg) rotateZ(-360deg); }
        }
        
        /* Advanced holographic face */
        .avatar-face {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 130px;
            height: 160px;
            background: 
                linear-gradient(180deg, 
                    rgba(0,245,255,0.2) 0%, 
                    rgba(128,0,255,0.1) 50%,
                    rgba(0,245,255,0.05) 100%);
            border: 2px solid;
            border-image: linear-gradient(180deg, var(--avatar-color), var(--avatar-secondary)) 1;
            border-radius: 50% 50% 45% 45%;
            box-shadow: 
                0 0 30px rgba(0,245,255,0.4),
                0 0 60px rgba(128,0,255,0.2),
                inset 0 0 40px rgba(0,245,255,0.1),
                inset 0 -20px 40px rgba(128,0,255,0.1);
            backdrop-filter: blur(5px);
        }
        
        /* Scan line effect */
        .avatar-face::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 2px;
            background: linear-gradient(90deg, transparent, var(--avatar-color), transparent);
            animation: scan-line 2s linear infinite;
        }
        
        @keyframes scan-line {
            0% { top: 0; opacity: 0; }
            10% { opacity: 1; }
            90% { opacity: 1; }
            100% { top: 100%; opacity: 0; }
        }
        
        /* Holographic grid overlay */
        .avatar-face::after {
            content: '';
            position: absolute;
            inset: 0;
            background: 
                repeating-linear-gradient(0deg, transparent, transparent 4px, rgba(0,245,255,0.03) 4px, rgba(0,245,255,0.03) 5px),
                repeating-linear-gradient(90deg, transparent, transparent 4px, rgba(0,245,255,0.03) 4px, rgba(0,245,255,0.03) 5px);
            border-radius: inherit;
            pointer-events: none;
        }
        
        /* Advanced eyes with tracking */
        .avatar-eyes {
            position: absolute;
            top: 38%;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            gap: 30px;
        }
        
        .avatar-eye {
            width: 22px;
            height: 22px;
            background: radial-gradient(circle at 30% 30%, #fff 0%, var(--avatar-color) 50%, var(--avatar-secondary) 100%);
            border-radius: 50%;
            box-shadow: 
                0 0 20px var(--avatar-color),
                0 0 40px rgba(0,245,255,0.5),
                inset 0 0 10px rgba(255,255,255,0.5);
            animation: blink-advanced 5s ease-in-out infinite;
            position: relative;
            overflow: hidden;
        }
        
        /* Pupil with tracking animation */
        .avatar-eye::after {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 10px;
            height: 10px;
            background: radial-gradient(circle, #000 60%, var(--avatar-secondary) 100%);
            border-radius: 50%;
            animation: eye-track 8s ease-in-out infinite;
            box-shadow: 0 0 5px var(--avatar-secondary);
        }
        
        /* Eye glow effect */
        .avatar-eye::before {
            content: '';
            position: absolute;
            top: 2px;
            left: 4px;
            width: 6px;
            height: 6px;
            background: rgba(255,255,255,0.8);
            border-radius: 50%;
            filter: blur(1px);
        }
        
        @keyframes blink-advanced {
            0%, 42%, 44%, 100% { transform: scaleY(1); }
            43% { transform: scaleY(0.1); }
            70%, 72% { transform: scaleY(1); }
            71% { transform: scaleY(0.1); }
        }
        
        @keyframes eye-track {
            0%, 100% { transform: translate(-50%, -50%); }
            15% { transform: translate(-30%, -60%); }
            30% { transform: translate(-70%, -40%); }
            45% { transform: translate(-50%, -50%); }
            60% { transform: translate(-60%, -70%); }
            75% { transform: translate(-40%, -30%); }
        }
        
        /* Advanced mouth with sound waves */
        .avatar-mouth {
            position: absolute;
            bottom: 28%;
            left: 50%;
            transform: translateX(-50%);
            width: 35px;
            height: 10px;
            background: transparent;
            border: 2px solid var(--avatar-color);
            border-radius: 0 0 20px 20px;
            border-top: none;
            transition: all 0.1s;
            box-shadow: 0 0 10px var(--avatar-color);
        }
        
        .avatar-mouth.speaking {
            animation: speak-advanced 0.12s ease-in-out infinite alternate;
        }
        
        @keyframes speak-advanced {
            0% { height: 6px; width: 30px; border-radius: 0 0 15px 15px; }
            50% { height: 12px; width: 40px; border-radius: 50%; }
            100% { height: 18px; width: 35px; border-radius: 50%; }
        }
        
        /* Sound wave visualizer */
        .avatar-soundwave {
            position: absolute;
            bottom: 15%;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            gap: 3px;
            height: 25px;
            align-items: flex-end;
            opacity: 0;
            transition: opacity 0.3s;
        }
        
        .avatar-container[data-speaking="true"] .avatar-soundwave {
            opacity: 1;
        }
        
        .soundwave-bar {
            width: 3px;
            background: linear-gradient(180deg, var(--avatar-color), var(--avatar-secondary));
            border-radius: 2px;
            animation: wave-bar 0.5s ease-in-out infinite;
        }
        
        .soundwave-bar:nth-child(1) { animation-delay: 0s; height: 8px; }
        .soundwave-bar:nth-child(2) { animation-delay: 0.1s; height: 15px; }
        .soundwave-bar:nth-child(3) { animation-delay: 0.05s; height: 20px; }
        .soundwave-bar:nth-child(4) { animation-delay: 0.15s; height: 12px; }
        .soundwave-bar:nth-child(5) { animation-delay: 0.08s; height: 18px; }
        .soundwave-bar:nth-child(6) { animation-delay: 0.12s; height: 10px; }
        .soundwave-bar:nth-child(7) { animation-delay: 0.03s; height: 14px; }
        
        @keyframes wave-bar {
            0%, 100% { transform: scaleY(0.3); }
            50% { transform: scaleY(1); }
        }
        
        /* Neural network particles */
        .avatar-neural {
            position: absolute;
            inset: 0;
            overflow: hidden;
            pointer-events: none;
        }
        
        .neural-particle {
            position: absolute;
            width: 4px;
            height: 4px;
            background: var(--avatar-color);
            border-radius: 50%;
            box-shadow: 0 0 10px var(--avatar-color);
            animation: neural-float 3s ease-in-out infinite;
        }
        
        .neural-particle:nth-child(1) { top: 20%; left: 15%; animation-delay: 0s; }
        .neural-particle:nth-child(2) { top: 30%; left: 80%; animation-delay: 0.5s; }
        .neural-particle:nth-child(3) { top: 60%; left: 10%; animation-delay: 1s; }
        .neural-particle:nth-child(4) { top: 70%; left: 85%; animation-delay: 1.5s; }
        .neural-particle:nth-child(5) { top: 45%; left: 5%; animation-delay: 0.8s; }
        .neural-particle:nth-child(6) { top: 55%; left: 90%; animation-delay: 1.2s; }
        
        @keyframes neural-float {
            0%, 100% { transform: translate(0, 0) scale(1); opacity: 0.4; }
            25% { transform: translate(10px, -15px) scale(1.2); opacity: 1; }
            50% { transform: translate(-5px, -25px) scale(0.8); opacity: 0.6; }
            75% { transform: translate(15px, -10px) scale(1.1); opacity: 0.9; }
        }
        
        /* Neural connections */
        .neural-connection {
            position: absolute;
            height: 1px;
            background: linear-gradient(90deg, transparent, var(--avatar-color), transparent);
            opacity: 0.3;
            animation: connection-pulse 2s ease-in-out infinite;
        }
        
        .neural-connection:nth-child(1) { width: 60px; top: 25%; left: 20%; transform: rotate(25deg); animation-delay: 0s; }
        .neural-connection:nth-child(2) { width: 50px; top: 65%; left: 60%; transform: rotate(-30deg); animation-delay: 0.5s; }
        .neural-connection:nth-child(3) { width: 70px; top: 50%; left: 15%; transform: rotate(45deg); animation-delay: 1s; }
        
        @keyframes connection-pulse {
            0%, 100% { opacity: 0.1; }
            50% { opacity: 0.6; }
        }
        
        .avatar-data-stream {
            position: absolute;
            top: 0;
            left: 50%;
            transform: translateX(-50%);
            width: 3px;
            height: 100%;
            overflow: hidden;
            pointer-events: none;
        }
        
        .data-particle {
            position: absolute;
            width: 3px;
            height: 15px;
            background: linear-gradient(180deg, transparent, var(--avatar-color), var(--avatar-secondary), transparent);
            animation: data-flow 1.2s linear infinite;
            border-radius: 2px;
        }
        
        @keyframes data-flow {
            0% { top: -15px; opacity: 0; }
            10% { opacity: 1; }
            90% { opacity: 1; }
            100% { top: 100%; opacity: 0; }
        }
        
        /* HUD Display */
        .avatar-hud {
            position: absolute;
            top: 8px;
            left: 8px;
            right: 8px;
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.55rem;
            color: var(--avatar-color);
            opacity: 0.8;
            text-shadow: 0 0 5px var(--avatar-color);
        }
        
        .hud-item {
            display: flex;
            justify-content: space-between;
            margin-bottom: 3px;
            padding: 2px 5px;
            background: rgba(0,0,0,0.3);
            border-radius: 3px;
            border-left: 2px solid var(--avatar-color);
        }
        
        .avatar-status {
            position: absolute;
            bottom: 8px;
            left: 50%;
            transform: translateX(-50%);
            font-family: 'Orbitron', monospace;
            font-size: 0.75rem;
            color: var(--avatar-color);
            text-transform: uppercase;
            letter-spacing: 3px;
            white-space: nowrap;
            text-shadow: 0 0 10px var(--avatar-color);
            padding: 4px 12px;
            background: rgba(0,0,0,0.4);
            border: 1px solid var(--avatar-color);
            border-radius: 15px;
        }
        
        /* Avatar States */
        .avatar-container[data-state="thinking"] {
            --avatar-color: #ffaa00;
        }
        .avatar-container[data-state="thinking"] .avatar-glow {
            animation: pulse-glow-multi 0.4s ease-in-out infinite;
        }
        .avatar-container[data-state="thinking"] .avatar-ring {
            animation: rotate-ring-x 2s linear infinite;
        }
        
        .avatar-container[data-state="processing"] {
            --avatar-color: #ff00ff;
        }
        .avatar-container[data-state="processing"] .avatar-ring {
            animation: rotate-ring-x 1s linear infinite;
        }
        
        .avatar-container[data-state="alert"] {
            --avatar-color: #ff4444;
            --avatar-secondary: #ff8800;
        }
        
        .avatar-container[data-state="success"] {
            --avatar-color: #00ff88;
            --avatar-secondary: #00ffcc;
        }
        
        /* Mode colors */
        .avatar-container[data-mode="pilot"] {
            --avatar-color: #00ff7f;
            --avatar-secondary: #00ffaa;
        }
        
        .avatar-container[data-mode="copilot"] {
            --avatar-color: #00f5ff;
            --avatar-secondary: #8000ff;
        }
        
        .avatar-container[data-mode="passive"] {
            --avatar-color: #6699ff;
            --avatar-secondary: #4466cc;
        }
        
        .avatar-container[data-mode="executive"] {
            --avatar-color: #aa66ff;
            --avatar-secondary: #ff66aa;
        }
        
        /* Minimized state */
        .avatar-minimized {
            width: 70px;
            height: 70px;
            cursor: pointer;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        .avatar-minimized .avatar-face,
        .avatar-minimized .avatar-hud,
        .avatar-minimized .avatar-status,
        .avatar-minimized .avatar-data-stream,
        .avatar-minimized .avatar-neural,
        .avatar-minimized .avatar-ring-secondary,
        .avatar-minimized .avatar-soundwave {
            display: none;
        }
        
        .avatar-minimized .avatar-ring {
            width: 55px;
            height: 55px;
        }
        
        .avatar-minimized .avatar-glow {
            width: 60px;
            height: 60px;
        }
        
        .avatar-minimized:hover {
            transform: scale(1.1);
        }
            width: 60px;
            height: 60px;
        }
        
        .avatar-toggle {
            position: absolute;
            top: -25px;
            right: 0;
            background: rgba(0,0,0,0.5);
            border: 1px solid var(--avatar-color, #00f5ff);
            color: var(--avatar-color, #00f5ff);
            padding: 3px 8px;
            border-radius: 5px;
            font-size: 0.7rem;
            cursor: pointer;
            font-family: 'Orbitron', monospace;
        }

        /* Debug Panel */
        .debug-panel {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            height: 300px;
            background: linear-gradient(180deg, rgba(15,10,5,0.98) 0%, rgba(10,5,0,0.99) 100%);
            border-top: 2px solid var(--neon-orange);
            z-index: 1001;
            transform: translateY(100%);
            transition: transform 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            display: flex;
            flex-direction: column;
        }
        
        .debug-panel.active {
            transform: translateY(0);
        }
        
        .debug-panel::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 2px;
            background: linear-gradient(90deg, transparent, var(--neon-orange), var(--neon-yellow), var(--neon-orange), transparent);
            animation: debugBorderGlow 2s linear infinite;
        }
        
        @keyframes debugBorderGlow {
            0%, 100% { opacity: 0.5; }
            50% { opacity: 1; }
        }
        
        .debug-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 20px;
            background: rgba(255,102,0,0.1);
            border-bottom: 1px solid rgba(255,102,0,0.2);
        }
        
        .debug-title {
            display: flex;
            align-items: center;
            gap: 10px;
            font-family: 'Orbitron', monospace;
            font-size: 1em;
            color: var(--neon-orange);
            text-shadow: 0 0 10px rgba(255,102,0,0.5);
        }
        
        .debug-tabs {
            display: flex;
            gap: 5px;
        }
        
        .debug-tab {
            padding: 6px 15px;
            background: rgba(255,255,255,0.05);
            border: 1px solid rgba(255,255,255,0.1);
            border-radius: 6px;
            color: rgba(255,255,255,0.6);
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.75em;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .debug-tab:hover {
            background: rgba(255,102,0,0.1);
            border-color: rgba(255,102,0,0.3);
            color: var(--neon-orange);
        }
        
        .debug-tab.active {
            background: rgba(255,102,0,0.2);
            border-color: var(--neon-orange);
            color: var(--neon-orange);
        }
        
        .debug-actions {
            display: flex;
            gap: 10px;
        }
        
        .debug-action-btn {
            padding: 6px 12px;
            background: rgba(255,255,255,0.05);
            border: 1px solid rgba(255,255,255,0.1);
            border-radius: 6px;
            color: rgba(255,255,255,0.7);
            font-size: 0.75em;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .debug-action-btn:hover {
            background: rgba(0,245,255,0.1);
            border-color: var(--neon-cyan);
            color: var(--neon-cyan);
        }
        
        .debug-action-btn.danger:hover {
            background: rgba(255,51,102,0.1);
            border-color: var(--neon-red);
            color: var(--neon-red);
        }
        
        .debug-body {
            flex: 1;
            display: flex;
            overflow: hidden;
        }
        
        .debug-content {
            flex: 1;
            padding: 15px;
            overflow-y: auto;
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.8em;
            line-height: 1.6;
        }
        
        .debug-content::-webkit-scrollbar {
            width: 6px;
        }
        
        .debug-content::-webkit-scrollbar-thumb {
            background: var(--neon-orange);
            border-radius: 3px;
        }
        
        .debug-sidebar {
            width: 250px;
            border-left: 1px solid rgba(255,102,0,0.2);
            padding: 15px;
            overflow-y: auto;
        }
        
        .debug-stat {
            display: flex;
            justify-content: space-between;
            padding: 8px 0;
            border-bottom: 1px solid rgba(255,255,255,0.05);
            font-size: 0.8em;
        }
        
        .debug-stat-label {
            color: rgba(255,255,255,0.5);
        }
        
        .debug-stat-value {
            color: var(--neon-cyan);
            font-weight: 600;
        }
        
        .log-entry {
            padding: 6px 10px;
            margin-bottom: 4px;
            border-radius: 4px;
            border-left: 3px solid;
        }
        
        .log-entry.info {
            background: rgba(0,245,255,0.05);
            border-color: var(--neon-cyan);
            color: var(--neon-cyan);
        }
        
        .log-entry.warn {
            background: rgba(255,204,0,0.05);
            border-color: var(--neon-yellow);
            color: var(--neon-yellow);
        }
        
        .log-entry.error {
            background: rgba(255,51,102,0.05);
            border-color: var(--neon-red);
            color: var(--neon-red);
        }
        
        .log-entry.success {
            background: rgba(0,255,136,0.05);
            border-color: var(--neon-green);
            color: var(--neon-green);
        }
        
        .log-time {
            color: rgba(255,255,255,0.4);
            margin-right: 10px;
        }
        
        /* ============ LEFT SIDEBAR - ENHANCED MODULES ============ */
        .left-sidebar {
            background: linear-gradient(180deg, rgba(8,8,15,0.98) 0%, rgba(5,5,10,0.95) 100%);
            border-right: 1px solid var(--glass-border);
            overflow-y: auto;
            padding: 15px;
            backdrop-filter: blur(10px);
            position: relative;
        }
        
        .left-sidebar::before {
            content: '';
            position: absolute;
            top: 0; left: 0;
            width: 100%; height: 100%;
            background: linear-gradient(180deg, rgba(0,245,255,0.02) 0%, transparent 50%, rgba(128,0,255,0.02) 100%);
            pointer-events: none;
        }
        
        .sidebar-section {
            margin-bottom: 25px;
            position: relative;
        }
        
        .section-title {
            font-family: 'Orbitron', monospace;
            font-size: 0.7em;
            font-weight: 600;
            color: var(--neon-cyan);
            letter-spacing: 3px;
            margin-bottom: 15px;
            padding-left: 5px;
            display: flex;
            align-items: center;
            gap: 10px;
            text-transform: uppercase;
            text-shadow: 0 0 10px rgba(0,245,255,0.5);
        }
        
        .section-title::after {
            content: '';
            flex: 1;
            height: 1px;
            background: linear-gradient(90deg, var(--neon-cyan), transparent);
        }
        
        .module-card {
            background: linear-gradient(135deg, rgba(15,15,25,0.9) 0%, rgba(10,10,20,0.8) 100%);
            border: 1px solid rgba(255,255,255,0.08);
            border-radius: 12px;
            padding: 15px;
            margin-bottom: 12px;
            cursor: pointer;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
        }
        
        .module-card::before {
            content: '';
            position: absolute;
            top: 0; left: -100%;
            width: 100%; height: 100%;
            background: linear-gradient(90deg, transparent, rgba(0,245,255,0.1), transparent);
            transition: left 0.6s ease;
        }
        
        .module-card:hover::before {
            left: 100%;
        }
        
        .module-card:hover {
            border-color: var(--neon-cyan);
            transform: translateX(5px);
            box-shadow: 0 0 20px rgba(0,245,255,0.2);
        }
        
        .module-card.active {
            border-color: var(--current-mode-color);
            background: linear-gradient(135deg, rgba(0,245,255,0.1), transparent);
        }
        
        .module-header {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 8px;
        }
        
        .module-icon {
            width: 32px;
            height: 32px;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.1em;
        }
        
        .module-icon.science { background: linear-gradient(135deg, var(--science-color), #00aa55); }
        .module-icon.medical { background: linear-gradient(135deg, var(--medical-color), #aa0033); }
        .module-icon.security { background: linear-gradient(135deg, var(--security-color), #aa8800); }
        .module-icon.military { background: linear-gradient(135deg, var(--military-color), #cc4400); }
        .module-icon.ai { background: linear-gradient(135deg, var(--neon-cyan), var(--neon-purple)); }
        .module-icon.cam { background: linear-gradient(135deg, #ff3366, #ff8800); }
        .module-icon.emergency { background: linear-gradient(135deg, #ff0000, #cc0000); }
        
        /* CAM Module Special Styles */
        .cam-module {
            border: 1px solid rgba(255,51,102,0.3);
            position: relative;
        }
        
        .cam-module::before {
            content: '';
            position: absolute;
            top: 0; left: 0; right: 0; bottom: 0;
            background: linear-gradient(135deg, rgba(255,51,102,0.1), rgba(255,136,0,0.05));
            pointer-events: none;
        }
        
        .cam-status-indicator {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: var(--neon-green);
            box-shadow: 0 0 10px var(--neon-green);
            animation: statusBlink 2s ease-in-out infinite;
            margin-left: auto;
        }
        
        .cam-status-indicator.engaged {
            background: var(--neon-red);
            box-shadow: 0 0 15px var(--neon-red);
            animation: camAlertPulse 0.5s ease-in-out infinite;
        }
        
        .cam-status-indicator.recovery {
            background: var(--neon-yellow);
            box-shadow: 0 0 10px var(--neon-yellow);
        }
        
        @keyframes camAlertPulse {
            0%, 100% { opacity: 1; transform: scale(1); }
            50% { opacity: 0.5; transform: scale(1.2); }
        }
        
        .cam-level {
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.65em;
            padding: 2px 8px;
            background: rgba(0,255,136,0.2);
            border: 1px solid rgba(0,255,136,0.3);
            border-radius: 4px;
            color: var(--neon-green);
            margin-top: 6px;
            text-align: center;
        }
        
        .cam-level.watch { background: rgba(255,204,0,0.2); border-color: rgba(255,204,0,0.3); color: var(--neon-yellow); }
        .cam-level.soft { background: rgba(255,136,0,0.2); border-color: rgba(255,136,0,0.3); color: var(--neon-orange); }
        .cam-level.active { background: rgba(255,51,102,0.2); border-color: rgba(255,51,102,0.3); color: var(--neon-red); }
        .cam-level.critical { background: rgba(255,0,0,0.3); border-color: rgba(255,0,0,0.5); color: #ff0000; animation: camAlertPulse 0.5s infinite; }
        
        .module-name {
            font-family: 'Orbitron', monospace;
            font-size: 0.85em;
            font-weight: 600;
        }
        
        .module-desc {
            font-size: 0.75em;
            color: rgba(255,255,255,0.5);
            line-height: 1.4;
        }
        
        /* ============ MAIN AREA ============ */
        .main-area {
            display: flex;
            flex-direction: column;
            background: rgba(5,5,10,0.9);
            position: relative;
        }
        
        /* Tab Navigation */
        .tab-nav {
            display: flex;
            background: rgba(15,15,25,0.9);
            border-bottom: 1px solid var(--glass-border);
            padding: 0 15px;
        }
        
        .tab-btn {
            padding: 15px 25px;
            background: transparent;
            border: none;
            color: rgba(255,255,255,0.5);
            font-family: 'Orbitron', monospace;
            font-size: 0.8em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            border-bottom: 2px solid transparent;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .tab-btn:hover {
            color: var(--neon-cyan);
        }
        
        .tab-btn.active {
            color: var(--neon-cyan);
            border-bottom-color: var(--neon-cyan);
            background: linear-gradient(180deg, rgba(0,245,255,0.1) 0%, transparent 100%);
        }
        
        /* Content Areas */
        .tab-content {
            flex: 1;
            display: none;
            overflow: hidden;
        }
        
        .tab-content.active {
            display: flex;
            flex-direction: column;
        }
        
        /* ============ CHAT TAB ============ */
        .chat-messages {
            flex: 1;
            overflow-y: auto;
            padding: 20px;
        }
        
        .message {
            max-width: 85%;
            margin-bottom: 15px;
            animation: messageIn 0.3s ease;
        }
        
        @keyframes messageIn {
            from { opacity: 0; transform: translateY(20px) scale(0.95); }
            to { opacity: 1; transform: translateY(0) scale(1); }
        }
        
        .message.user {
            margin-left: auto;
        }
        
        .message-content {
            padding: 16px 20px;
            border-radius: 16px;
            font-size: 0.95em;
            line-height: 1.7;
            position: relative;
            overflow: hidden;
        }
        
        .message.user .message-content {
            background: linear-gradient(135deg, var(--neon-cyan), var(--neon-blue));
            color: #000;
            font-weight: 500;
            border-bottom-right-radius: 5px;
            box-shadow: 0 5px 25px rgba(0,245,255,0.3);
        }
        
        .message.assistant .message-content {
            background: linear-gradient(135deg, rgba(15,15,30,0.95) 0%, rgba(10,10,25,0.9) 100%);
            border: 1px solid var(--glass-border);
            border-bottom-left-radius: 5px;
            box-shadow: 0 5px 25px rgba(0,0,0,0.4);
        }
        
        .message.assistant .message-content::before {
            content: '';
            position: absolute;
            top: 0; left: 0;
            width: 3px; height: 100%;
            background: linear-gradient(180deg, var(--neon-cyan), var(--neon-purple));
        }
        
        .message-meta {
            font-size: 0.7em;
            color: rgba(255,255,255,0.4);
            margin-top: 6px;
            padding: 0 5px;
            font-family: 'JetBrains Mono', monospace;
        }
        
        /* Chat Input - Enhanced */
        .chat-input-area {
            padding: 20px;
            background: linear-gradient(180deg, rgba(10,10,20,0.98) 0%, rgba(5,5,15,0.95) 100%);
            border-top: 1px solid var(--glass-border);
            backdrop-filter: blur(10px);
        }
        
        .voice-controls {
            display: flex;
            gap: 10px;
            padding: 10px 0;
            margin-bottom: 12px;
            flex-wrap: wrap;
            align-items: center;
        }
        
        .control-btn {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 10px 16px;
            border-radius: 25px;
            border: 1px solid rgba(255,255,255,0.15);
            background: linear-gradient(135deg, rgba(20,20,30,0.8) 0%, rgba(10,10,20,0.9) 100%);
            color: #fff;
            font-family: 'Rajdhani', sans-serif;
            font-size: 0.9em;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
        }
        
        .control-btn::before {
            content: '';
            position: absolute;
            top: 50%; left: 50%;
            width: 0; height: 0;
            background: radial-gradient(circle, rgba(0,245,255,0.3) 0%, transparent 70%);
            transform: translate(-50%, -50%);
            transition: width 0.5s ease, height 0.5s ease;
        }
        
        .control-btn:hover::before {
            width: 200%; height: 200%;
        }
        
        .control-btn:hover {
            border-color: var(--neon-cyan);
            box-shadow: 0 0 20px rgba(0,245,255,0.3);
            transform: translateY(-2px);
        }
        
        .control-btn.active {
            border-color: var(--neon-green);
            background: rgba(0,255,136,0.2);
            color: var(--neon-green);
        }
        
        .control-btn.recording {
            border-color: var(--neon-red);
            background: rgba(255,51,102,0.2);
            color: var(--neon-red);
            animation: recordPulse 1s ease-in-out infinite;
        }
        
        @keyframes recordPulse {
            0%, 100% { box-shadow: 0 0 5px rgba(255,51,102,0.3); }
            50% { box-shadow: 0 0 20px rgba(255,51,102,0.6); }
        }
        
        .control-btn .icon {
            font-size: 1.1em;
        }
        
        .control-btn .label {
            font-weight: 500;
        }
        
        .control-divider {
            width: 1px;
            height: 24px;
            background: var(--glass-border);
            margin: 0 5px;
        }
        
        .hands-free-indicator {
            display: none;
            align-items: center;
            gap: 6px;
            padding: 6px 12px;
            border-radius: 15px;
            background: linear-gradient(135deg, rgba(0,255,136,0.2), rgba(0,245,255,0.2));
            border: 1px solid var(--neon-green);
            color: var(--neon-green);
            font-size: 0.85em;
            animation: handsFreeGlow 2s ease-in-out infinite;
        }
        
        .hands-free-indicator.active {
            display: flex;
        }
        
        @keyframes handsFreeGlow {
            0%, 100% { box-shadow: 0 0 10px rgba(0,255,136,0.3); }
            50% { box-shadow: 0 0 25px rgba(0,255,136,0.5); }
        }
        
        /* Control Info Boxes */
        .controls-container {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }
        
        .control-item {
            display: flex;
            flex-direction: column;
            gap: 4px;
        }
        
        .control-item .control-btn {
            width: 100%;
            justify-content: flex-start;
        }
        
        .control-info {
            display: none;
            padding: 10px 12px;
            background: rgba(0,0,0,0.6);
            border: 1px solid var(--glass-border);
            border-radius: 10px;
            font-size: 0.85em;
            color: rgba(255,255,255,0.8);
            line-height: 1.5;
            animation: fadeIn 0.3s ease;
        }
        
        .control-info.visible {
            display: block;
        }
        
        .control-info strong {
            color: var(--neon-cyan);
        }
        
        .control-info .info-title {
            color: var(--neon-cyan);
            font-weight: 600;
            margin-bottom: 5px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .control-info .info-steps {
            margin-top: 8px;
            padding-left: 15px;
        }
        
        .control-info .info-steps li {
            margin-bottom: 4px;
        }
        
        .info-toggle {
            background: transparent;
            border: none;
            color: rgba(255,255,255,0.5);
            font-size: 0.75em;
            cursor: pointer;
            padding: 2px 8px;
            border-radius: 10px;
            transition: all 0.2s;
        }
        
        .info-toggle:hover {
            color: var(--neon-cyan);
            background: rgba(0,245,255,0.1);
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(-5px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .controls-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
            gap: 10px;
            margin-bottom: 10px;
        }
        
        .control-card {
            background: rgba(0,0,0,0.3);
            border: 1px solid var(--glass-border);
            border-radius: 12px;
            padding: 10px;
            transition: all 0.3s ease;
        }
        
        .control-card:hover {
            border-color: var(--neon-cyan);
            background: rgba(0,245,255,0.05);
        }
        
        .control-card .card-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 8px;
        }
        
        .control-card .card-btn {
            display: flex;
            align-items: center;
            gap: 8px;
            background: transparent;
            border: none;
            color: #fff;
            font-family: 'Rajdhani', sans-serif;
            font-size: 0.95em;
            cursor: pointer;
            padding: 0;
        }
        
        .control-card .card-btn .icon {
            font-size: 1.3em;
        }
        
        .control-card.active {
            border-color: var(--neon-green);
            background: rgba(0,255,136,0.1);
        }
        
        .control-card.recording {
            border-color: var(--neon-red);
            background: rgba(255,51,102,0.1);
            animation: recordPulse 1s ease-in-out infinite;
        }
        
        /* GIDEON Speaking Indicator */
        body.gideon-speaking::after {
            content: 'ðŸ”Š GIDEON sta parlando...';
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: linear-gradient(135deg, rgba(0,245,255,0.9), rgba(138,43,226,0.9));
            color: #fff;
            padding: 10px 25px;
            border-radius: 25px;
            font-family: 'Orbitron', monospace;
            font-size: 0.9em;
            z-index: 99998;
            animation: speakingPulse 1.5s ease-in-out infinite;
            box-shadow: 0 0 30px rgba(0,245,255,0.5);
        }
        
        @keyframes speakingPulse {
            0%, 100% { opacity: 1; transform: translateX(-50%) scale(1); }
            50% { opacity: 0.8; transform: translateX(-50%) scale(1.05); }
        }
        
        .card-info {
            display: none;
            font-size: 0.8em;
            color: rgba(255,255,255,0.7);
            line-height: 1.4;
            padding-top: 8px;
            border-top: 1px solid rgba(255,255,255,0.1);
        }
        
        .card-info.visible {
            display: block;
        }
        
        .card-info ul {
            margin: 5px 0 0 15px;
            padding: 0;
        }
        
        .card-info li {
            margin-bottom: 3px;
        }
        
        .input-wrapper {
            display: flex;
            gap: 12px;
            align-items: flex-end;
        }
        
        .chat-textarea {
            flex: 1;
            background: rgba(0,0,0,0.5);
            border: 1px solid var(--glass-border);
            border-radius: 12px;
            padding: 15px;
            color: #fff;
            font-family: 'Rajdhani', sans-serif;
            font-size: 1em;
            resize: none;
            min-height: 50px;
            max-height: 150px;
        }
        
        .chat-textarea:focus {
            outline: none;
            border-color: var(--neon-cyan);
            box-shadow: 0 0 20px rgba(0,245,255,0.2);
        }
        
        .send-btn {
            width: 50px;
            height: 50px;
            border-radius: 12px;
            border: none;
            background: linear-gradient(135deg, var(--neon-cyan), var(--neon-blue));
            color: #000;
            font-size: 1.3em;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .send-btn:hover {
            transform: scale(1.05);
            box-shadow: 0 0 25px rgba(0,245,255,0.5);
        }
        
        /* ============ WORKFLOW TAB ============ */
        .workflow-area {
            flex: 1;
            display: flex;
            background: rgba(5,5,10,0.9);
        }
        
        .workflow-canvas {
            flex: 1;
            position: relative;
            overflow: auto;
            background: 
                radial-gradient(circle at 50% 50%, rgba(0,245,255,0.03) 0%, transparent 50%),
                linear-gradient(90deg, rgba(255,255,255,0.02) 1px, transparent 1px),
                linear-gradient(rgba(255,255,255,0.02) 1px, transparent 1px);
            background-size: 100% 100%, 30px 30px, 30px 30px;
        }
        
        .workflow-node {
            position: absolute;
            min-width: 180px;
            background: var(--dark-card);
            border: 2px solid var(--glass-border);
            border-radius: 12px;
            cursor: move;
            z-index: 10;
            transition: box-shadow 0.3s ease;
        }
        
        .workflow-node:hover {
            box-shadow: 0 0 30px rgba(0,245,255,0.3);
        }
        
        .workflow-node.selected {
            border-color: var(--neon-cyan);
            box-shadow: 0 0 40px rgba(0,245,255,0.5);
        }
        
        .node-header {
            padding: 12px 15px;
            background: linear-gradient(135deg, rgba(0,245,255,0.2), rgba(128,0,255,0.1));
            border-radius: 10px 10px 0 0;
            display: flex;
            align-items: center;
            gap: 10px;
            font-family: 'Orbitron', monospace;
            font-size: 0.8em;
            font-weight: 600;
        }
        
        .node-body {
            padding: 12px 15px;
        }
        
        .node-port {
            width: 14px;
            height: 14px;
            border-radius: 50%;
            background: var(--neon-cyan);
            border: 2px solid #fff;
            position: absolute;
            cursor: crosshair;
        }
        
        .node-port.input { left: -7px; top: 50%; transform: translateY(-50%); }
        .node-port.output { right: -7px; top: 50%; transform: translateY(-50%); }
        
        /* Workflow Toolbar */
        .workflow-toolbar {
            position: absolute;
            top: 15px;
            left: 15px;
            display: flex;
            gap: 10px;
            z-index: 20;
        }
        
        .toolbar-btn {
            padding: 10px 15px;
            background: var(--dark-card);
            border: 1px solid var(--glass-border);
            border-radius: 8px;
            color: #fff;
            font-family: 'Orbitron', monospace;
            font-size: 0.75em;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .toolbar-btn:hover {
            border-color: var(--neon-cyan);
            background: rgba(0,245,255,0.1);
        }
        
        /* ============ RIGHT SIDEBAR - AI SERVICES ============ */
        .right-sidebar {
            background: linear-gradient(180deg, rgba(10,10,20,0.98) 0%, rgba(5,5,15,0.98) 100%);
            border-left: 1px solid rgba(255,0,255,0.15);
            overflow-y: auto;
            padding: 15px;
            backdrop-filter: blur(20px);
            position: relative;
        }
        
        .right-sidebar::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 1px;
            height: 100%;
            background: linear-gradient(180deg, 
                transparent 0%, 
                var(--neon-magenta) 20%,
                var(--neon-cyan) 50%,
                var(--neon-magenta) 80%,
                transparent 100%);
            animation: sidebarGlow 3s ease-in-out infinite;
        }
        
        @keyframes sidebarGlow {
            0%, 100% { opacity: 0.3; }
            50% { opacity: 1; }
        }
        
        .right-sidebar .section-title {
            font-family: 'Orbitron', monospace;
            font-size: 0.85em;
            color: var(--neon-magenta);
            text-transform: uppercase;
            letter-spacing: 2px;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
            text-shadow: 0 0 10px var(--glow-purple);
        }
        
        .right-sidebar .section-title::before {
            content: 'â—ˆ';
            color: var(--neon-magenta);
            animation: pulse 2s ease-in-out infinite;
        }
        
        .service-card {
            background: linear-gradient(135deg, rgba(20,20,30,0.9) 0%, rgba(15,15,25,0.9) 100%);
            border: 1px solid rgba(255,255,255,0.1);
            border-radius: 12px;
            padding: 15px;
            margin-bottom: 12px;
            cursor: pointer;
            transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            position: relative;
            overflow: hidden;
        }
        
        .service-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, 
                transparent, 
                rgba(255,0,255,0.1),
                rgba(0,245,255,0.1),
                transparent);
            transition: left 0.5s ease;
        }
        
        .service-card:hover::before {
            left: 100%;
        }
        
        .service-card:hover {
            border-color: var(--neon-magenta);
            transform: translateX(-5px) scale(1.02);
            box-shadow: 
                0 0 20px rgba(255,0,255,0.3),
                0 0 40px rgba(255,0,255,0.1),
                inset 0 0 20px rgba(255,0,255,0.05);
        }
        
        .service-card::after {
            content: '';
            position: absolute;
            top: 0;
            right: 0;
            width: 3px;
            height: 0;
            background: linear-gradient(180deg, var(--neon-magenta), var(--neon-cyan));
            transition: height 0.3s ease;
            border-radius: 0 12px 12px 0;
        }
        
        .service-card:hover::after {
            height: 100%;
        }
        
        .service-header {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 8px;
            position: relative;
            z-index: 1;
        }
        
        .service-badge {
            padding: 4px 10px;
            border-radius: 6px;
            font-size: 0.6em;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 1px;
            position: relative;
            overflow: hidden;
        }
        
        .service-badge::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
            animation: badgeShine 2s ease-in-out infinite;
        }
        
        @keyframes badgeShine {
            0% { left: -100%; }
            50%, 100% { left: 100%; }
        }
        
        .service-badge.video { 
            background: linear-gradient(135deg, var(--neon-magenta), #ff66ff); 
            color: #000; 
            box-shadow: 0 0 10px rgba(255,0,255,0.5);
        }
        .service-badge.image { 
            background: linear-gradient(135deg, var(--neon-yellow), #ffee66); 
            color: #000; 
            box-shadow: 0 0 10px rgba(255,238,0,0.5);
        }
        .service-badge.audio { 
            background: linear-gradient(135deg, var(--neon-green), #66ff99); 
            color: #000; 
            box-shadow: 0 0 10px rgba(0,255,136,0.5);
        }
        .service-badge.text { 
            background: linear-gradient(135deg, var(--neon-cyan), #66ffff); 
            color: #000; 
            box-shadow: 0 0 10px rgba(0,245,255,0.5);
        }
        
        .service-name {
            font-family: 'Orbitron', monospace;
            font-size: 0.9em;
            font-weight: 600;
            background: linear-gradient(90deg, #fff, rgba(255,255,255,0.8));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        .service-desc {
            font-size: 0.75em;
            color: rgba(255,255,255,0.5);
            margin-bottom: 10px;
            position: relative;
            z-index: 1;
            line-height: 1.4;
        }
        
        .service-actions {
            display: flex;
            gap: 8px;
            position: relative;
            z-index: 1;
        }
        
        .service-btn {
            flex: 1;
            padding: 10px 12px;
            border: 1px solid rgba(255,255,255,0.2);
            border-radius: 8px;
            background: rgba(255,255,255,0.05);
            color: #fff;
            font-size: 0.75em;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }
        
        .service-btn::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            background: radial-gradient(circle, rgba(0,245,255,0.3), transparent);
            transform: translate(-50%, -50%);
            transition: all 0.4s ease;
            border-radius: 50%;
        }
        
        .service-btn:hover::before {
            width: 200%;
            height: 200%;
        }
        
        .service-btn:hover {
            border-color: var(--neon-cyan);
            background: rgba(0,245,255,0.15);
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,245,255,0.2);
        }
        
        .service-btn.primary {
            background: linear-gradient(135deg, var(--neon-cyan), var(--neon-blue));
            border: none;
            color: #000;
            font-weight: 700;
            box-shadow: 0 0 15px rgba(0,245,255,0.4);
        }
        
        .service-btn.primary:hover {
            transform: translateY(-2px) scale(1.02);
            box-shadow: 0 0 25px rgba(0,245,255,0.6);
        }
        
        /* ============ SPECIALIZED PANELS ============ */
        .panel-overlay {
            position: fixed;
            top: 0; left: 0;
            width: 100%; height: 100%;
            background: rgba(0,0,0,0.85);
            backdrop-filter: blur(10px);
            display: none;
            z-index: 1000;
            animation: fadeIn 0.3s ease;
        }
        
        .panel-overlay.active {
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        .spec-panel {
            width: 90%;
            max-width: 1200px;
            max-height: 90vh;
            background: linear-gradient(135deg, rgba(15,15,25,0.98) 0%, rgba(10,10,20,0.98) 100%);
            border: 1px solid rgba(0,245,255,0.2);
            border-radius: 20px;
            overflow: hidden;
            animation: panelIn 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            box-shadow: 
                0 0 50px rgba(0,245,255,0.2),
                0 0 100px rgba(128,0,255,0.1),
                inset 0 1px 0 rgba(255,255,255,0.1);
            position: relative;
        }
        
        .spec-panel::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 2px;
            background: linear-gradient(90deg, 
                transparent, 
                var(--neon-cyan), 
                var(--neon-magenta), 
                var(--neon-cyan), 
                transparent);
            animation: panelBorderGlow 3s linear infinite;
        }
        
        @keyframes panelBorderGlow {
            0% { opacity: 0.5; }
            50% { opacity: 1; }
            100% { opacity: 0.5; }
        }
        
        @keyframes panelIn {
            from { transform: scale(0.9) translateY(20px); opacity: 0; }
            to { transform: scale(1) translateY(0); opacity: 1; }
        }
        
        .panel-header {
            padding: 20px 25px;
            background: linear-gradient(135deg, rgba(0,245,255,0.15), rgba(128,0,255,0.08));
            border-bottom: 1px solid rgba(0,245,255,0.2);
            display: flex;
            align-items: center;
            justify-content: space-between;
            position: relative;
        }
        
        .panel-header::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 1px;
            background: linear-gradient(90deg, 
                transparent, 
                var(--neon-cyan), 
                transparent);
        }
        
        .panel-title {
            font-family: 'Orbitron', monospace;
            font-size: 1.3em;
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: 12px;
            text-shadow: 0 0 20px var(--glow-cyan);
        }
        
        .panel-title i {
            color: var(--neon-cyan);
            filter: drop-shadow(0 0 10px var(--glow-cyan));
        }
        
        .panel-close {
            width: 40px;
            height: 40px;
            border-radius: 10px;
            border: 1px solid rgba(255,255,255,0.2);
            background: rgba(255,255,255,0.05);
            color: #fff;
            font-size: 1.5em;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .panel-close:hover {
            border-color: var(--neon-red);
            color: var(--neon-red);
            background: rgba(255,0,68,0.1);
            box-shadow: 0 0 20px rgba(255,0,68,0.3);
            transform: rotate(90deg);
        }
        
        .panel-body {
            padding: 25px;
            max-height: calc(90vh - 100px);
            overflow-y: auto;
            background: linear-gradient(180deg, transparent, rgba(0,245,255,0.02));
        }
        
        /* Custom scrollbar for panels */
        .panel-body::-webkit-scrollbar {
            width: 8px;
        }
        
        .panel-body::-webkit-scrollbar-track {
            background: rgba(0,0,0,0.3);
            border-radius: 4px;
        }
        
        .panel-body::-webkit-scrollbar-thumb {
            background: linear-gradient(180deg, var(--neon-cyan), var(--neon-magenta));
            border-radius: 4px;
        }
        
        /* ============ CAM PANEL STYLES ============ */
        .cam-panel-special {
            border-color: rgba(255,51,102,0.5);
        }
        
        .cam-dashboard {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 25px;
        }
        
        .cam-status-card {
            background: linear-gradient(135deg, rgba(255,51,102,0.1), rgba(255,136,0,0.05));
            border: 1px solid rgba(255,51,102,0.3);
            border-radius: 15px;
            padding: 20px;
        }
        
        .cam-status-header {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 15px;
        }
        
        .cam-status-icon {
            font-size: 1.5em;
        }
        
        .cam-status-text {
            font-family: 'Orbitron', monospace;
            font-size: 1.2em;
            font-weight: 600;
            color: var(--neon-green);
        }
        
        .cam-status-details {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }
        
        .cam-detail-row {
            display: flex;
            justify-content: space-between;
            font-size: 0.9em;
            color: rgba(255,255,255,0.7);
        }
        
        .cam-value {
            font-family: 'JetBrains Mono', monospace;
            color: var(--neon-cyan);
        }
        
        .cam-philosophy {
            background: rgba(0,0,0,0.3);
            border-radius: 15px;
            padding: 15px;
            display: flex;
            flex-direction: column;
            gap: 8px;
        }
        
        .philosophy-item {
            font-size: 0.85em;
            color: rgba(255,255,255,0.8);
            padding: 5px 10px;
            background: rgba(255,255,255,0.05);
            border-radius: 5px;
        }
        
        .cam-layers-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
            margin-bottom: 20px;
        }
        
        .cam-layer-card {
            background: rgba(10,10,18,0.8);
            border: 1px solid rgba(0,245,255,0.2);
            border-radius: 12px;
            padding: 15px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .cam-layer-card:hover {
            border-color: var(--neon-cyan);
            transform: translateY(-3px);
            box-shadow: 0 5px 20px rgba(0,245,255,0.2);
        }
        
        .layer-icon {
            font-size: 1.8em;
            margin-bottom: 8px;
        }
        
        .layer-name {
            font-family: 'Orbitron', monospace;
            font-size: 0.75em;
            font-weight: 600;
            margin-bottom: 5px;
        }
        
        .layer-desc {
            font-size: 0.7em;
            color: rgba(255,255,255,0.5);
            margin-bottom: 8px;
        }
        
        .layer-status {
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.65em;
            padding: 3px 8px;
            background: rgba(0,255,136,0.2);
            border: 1px solid rgba(0,255,136,0.3);
            border-radius: 4px;
            color: var(--neon-green);
            display: inline-block;
        }
        
        .cam-rules {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-bottom: 20px;
            justify-content: center;
        }
        
        .cam-rule {
            font-size: 0.8em;
            padding: 6px 12px;
            border-radius: 20px;
            font-family: 'JetBrains Mono', monospace;
        }
        
        .cam-rule.good {
            background: rgba(0,255,136,0.15);
            border: 1px solid rgba(0,255,136,0.3);
            color: var(--neon-green);
        }
        
        .cam-rule.bad {
            background: rgba(255,51,102,0.15);
            border: 1px solid rgba(255,51,102,0.3);
            color: var(--neon-red);
        }
        
        .cam-actions {
            display: flex;
            gap: 15px;
            justify-content: center;
        }
        
        .cam-action-btn {
            padding: 12px 24px;
            border-radius: 10px;
            border: 1px solid rgba(0,245,255,0.3);
            background: rgba(0,245,255,0.1);
            color: var(--neon-cyan);
            font-family: 'Orbitron', monospace;
            font-size: 0.85em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .cam-action-btn:hover {
            border-color: var(--neon-cyan);
            box-shadow: 0 0 20px rgba(0,245,255,0.3);
            transform: translateY(-2px);
        }
        
        .cam-action-btn.emergency {
            background: rgba(255,0,0,0.2);
            border-color: rgba(255,0,0,0.5);
            color: #ff3333;
        }
        
        .cam-action-btn.emergency:hover {
            background: rgba(255,0,0,0.3);
            border-color: #ff0000;
            box-shadow: 0 0 30px rgba(255,0,0,0.5);
        }
        
        /* ============ SCIENCE MODULE ============ */
        .science-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
        }
        
        .science-tool {
            background: linear-gradient(135deg, rgba(0,255,136,0.08) 0%, rgba(0,170,85,0.05) 100%);
            border: 1px solid rgba(0,255,136,0.3);
            border-radius: 15px;
            padding: 20px;
            transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            position: relative;
            overflow: hidden;
        }
        
        .science-tool::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: conic-gradient(from 0deg, transparent, rgba(0,255,136,0.1), transparent);
            animation: toolRotate 10s linear infinite;
            opacity: 0;
            transition: opacity 0.3s ease;
        }
        
        .science-tool:hover::before {
            opacity: 1;
        }
        
        @keyframes toolRotate {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }
        
        .science-tool:hover {
            border-color: var(--science-color);
            box-shadow: 
                0 0 30px rgba(0,255,136,0.3),
                0 0 60px rgba(0,255,136,0.1),
                inset 0 0 30px rgba(0,255,136,0.05);
            transform: translateY(-8px) scale(1.02);
        }
        
        .tool-icon {
            width: 60px;
            height: 60px;
            border-radius: 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.8em;
            margin-bottom: 15px;
            position: relative;
            z-index: 1;
            box-shadow: 0 0 20px rgba(0,0,0,0.3);
        }
        
        .tool-icon::after {
            content: '';
            position: absolute;
            inset: -3px;
            border-radius: 18px;
            background: linear-gradient(135deg, rgba(255,255,255,0.3), transparent);
            z-index: -1;
            opacity: 0;
            transition: opacity 0.3s ease;
        }
        
        .science-tool:hover .tool-icon::after {
            opacity: 1;
        }
        
        .tool-icon.science { 
            background: linear-gradient(135deg, var(--science-color), #00aa55); 
            box-shadow: 0 0 25px rgba(0,255,136,0.4);
        }
        .tool-icon.medical { 
            background: linear-gradient(135deg, var(--medical-color), #aa0033); 
            box-shadow: 0 0 25px rgba(255,51,102,0.4);
        }
        .tool-icon.security { 
            background: linear-gradient(135deg, var(--security-color), #aa8800); 
            box-shadow: 0 0 25px rgba(255,204,0,0.4);
        }
        .tool-icon.military { 
            background: linear-gradient(135deg, var(--military-color), #cc4400); 
            box-shadow: 0 0 25px rgba(255,102,0,0.4);
        }
        
        .tool-name {
            font-family: 'Orbitron', monospace;
            font-size: 1em;
            font-weight: 600;
            margin-bottom: 8px;
        }
        
        .tool-desc {
            font-size: 0.85em;
            color: rgba(255,255,255,0.6);
            line-height: 1.5;
            margin-bottom: 15px;
        }
        
        .tool-btn {
            width: 100%;
            padding: 12px;
            border: none;
            border-radius: 8px;
            background: linear-gradient(135deg, var(--science-color), #00aa55);
            color: #000;
            font-family: 'Orbitron', monospace;
            font-size: 0.8em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .tool-btn:hover {
            transform: scale(1.02);
            box-shadow: 0 0 20px rgba(0,255,136,0.5);
        }
        
        .tool-btn.medical { background: linear-gradient(135deg, var(--medical-color), #aa0033); }
        .tool-btn.security { background: linear-gradient(135deg, var(--security-color), #aa8800); color: #000; }
        .tool-btn.military { background: linear-gradient(135deg, var(--military-color), #cc4400); }
        
        /* ============ TYPING INDICATOR ============ */
        .typing-indicator {
            display: none;
            padding: 15px;
            background: var(--dark-card);
            border-radius: 15px;
            margin: 10px 20px;
            max-width: 120px;
            border: 1px solid var(--glass-border);
        }
        
        .typing-indicator.active {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .typing-dots span {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: var(--neon-cyan);
            animation: typingBounce 1.4s ease-in-out infinite;
        }
        
        .typing-dots span:nth-child(2) { animation-delay: 0.2s; }
        .typing-dots span:nth-child(3) { animation-delay: 0.4s; }
        
        @keyframes typingBounce {
            0%, 60%, 100% { transform: translateY(0); }
            30% { transform: translateY(-8px); }
        }
        
        /* ============ SYSTEM MONITOR ============ */
        .monitor-dashboard {
            padding: 20px;
            display: flex;
            flex-direction: column;
            gap: 20px;
            height: 100%;
            overflow-y: auto;
            background: linear-gradient(180deg, rgba(5,5,15,0.5) 0%, transparent 100%);
        }
        
        .monitor-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding-bottom: 15px;
            border-bottom: 1px solid rgba(0,245,255,0.2);
            position: relative;
        }
        
        .monitor-header::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 1px;
            background: linear-gradient(90deg, 
                transparent, 
                var(--neon-cyan), 
                transparent);
        }
        
        .monitor-title {
            font-family: 'Orbitron', monospace;
            font-size: 1.4em;
            color: var(--neon-cyan);
            display: flex;
            align-items: center;
            gap: 10px;
            text-shadow: 0 0 20px var(--glow-cyan);
        }
        
        .monitor-title i {
            animation: pulse 2s ease-in-out infinite;
            filter: drop-shadow(0 0 10px var(--glow-cyan));
        }
        
        .monitor-status {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 8px 15px;
            background: rgba(0,255,136,0.1);
            border: 1px solid var(--neon-green);
            border-radius: 20px;
            font-size: 0.85em;
            color: var(--neon-green);
            box-shadow: 0 0 15px rgba(0,255,136,0.2);
            animation: statusGlow 2s ease-in-out infinite;
        }
        
        @keyframes statusGlow {
            0%, 100% { box-shadow: 0 0 15px rgba(0,255,136,0.2); }
            50% { box-shadow: 0 0 25px rgba(0,255,136,0.4); }
        }
        
        .status-dot {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            background: var(--neon-green);
            animation: statusPulse 2s ease-in-out infinite;
            box-shadow: 0 0 10px var(--neon-green);
        }
        
        @keyframes statusPulse {
            0%, 100% { opacity: 1; transform: scale(1); }
            50% { opacity: 0.5; transform: scale(0.8); }
        }
        
        .monitor-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 15px;
        }
        
        .monitor-card {
            background: linear-gradient(135deg, rgba(15,15,25,0.9) 0%, rgba(10,10,20,0.9) 100%);
            border: 1px solid rgba(255,255,255,0.1);
            border-radius: 15px;
            padding: 20px;
            transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            position: relative;
            overflow: hidden;
        }
        
        .monitor-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 3px;
            background: linear-gradient(90deg, var(--neon-cyan), var(--neon-magenta), var(--neon-cyan));
            transform: scaleX(0);
            transition: transform 0.3s ease;
        }
        
        .monitor-card:hover::before {
            transform: scaleX(1);
        }
        
        .monitor-card:hover {
            border-color: var(--neon-cyan);
            background: linear-gradient(135deg, rgba(0,245,255,0.08) 0%, rgba(128,0,255,0.05) 100%);
            transform: translateY(-5px);
            box-shadow: 
                0 10px 30px rgba(0,0,0,0.3),
                0 0 20px rgba(0,245,255,0.2);
        }
        
        .card-title {
            font-family: 'Orbitron', monospace;
            font-size: 0.9em;
            color: rgba(255,255,255,0.7);
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 8px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        
        .card-title i {
            color: var(--neon-cyan);
            filter: drop-shadow(0 0 5px var(--glow-cyan));
        }
        
        .metric-value {
            font-family: 'Orbitron', monospace;
            font-size: 2.5em;
            font-weight: 700;
            background: linear-gradient(135deg, var(--neon-cyan), var(--neon-blue));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            text-shadow: none;
            filter: drop-shadow(0 0 20px var(--glow-cyan));
        }
        
        .metric-unit {
            font-size: 0.9em;
            color: rgba(255,255,255,0.5);
            margin-left: 5px;
        }
        
        .metric-bar {
            margin-top: 15px;
            height: 10px;
            background: rgba(255,255,255,0.1);
            border-radius: 5px;
            overflow: hidden;
            position: relative;
        }
        
        .metric-bar::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, 
                transparent, 
                rgba(255,255,255,0.2), 
                transparent);
            animation: shimmer 2s infinite;
        }
        
        @keyframes shimmer {
            0% { transform: translateX(-100%); }
            100% { transform: translateX(100%); }
        }
        
        .metric-fill {
            height: 100%;
            border-radius: 5px;
            transition: width 0.5s ease;
            position: relative;
            box-shadow: 0 0 10px currentColor;
        }
        
        .metric-fill.cpu { 
            background: linear-gradient(90deg, var(--neon-cyan), var(--neon-blue)); 
            box-shadow: 0 0 15px var(--glow-cyan);
        }
        .metric-fill.ram { 
            background: linear-gradient(90deg, var(--neon-purple), var(--neon-magenta)); 
            box-shadow: 0 0 15px var(--glow-purple);
        }
        .metric-fill.disk { 
            background: linear-gradient(90deg, var(--neon-green), var(--neon-cyan)); 
            box-shadow: 0 0 15px var(--glow-green);
        }
        .metric-fill.network { 
            background: linear-gradient(90deg, var(--neon-yellow), var(--neon-orange)); 
            box-shadow: 0 0 15px rgba(255,204,0,0.5);
        }
        
        .metric-details {
            margin-top: 12px;
            font-size: 0.8em;
            color: rgba(255,255,255,0.5);
            display: flex;
            justify-content: space-between;
        }
        
        .services-list {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        
        .service-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 15px;
            background: rgba(0,0,0,0.3);
            border-radius: 10px;
            border: 1px solid rgba(255,255,255,0.05);
            transition: all 0.3s ease;
        }
        
        .service-item:hover {
            background: rgba(0,245,255,0.05);
            border-color: rgba(0,245,255,0.2);
            transform: translateX(5px);
        }
        
        .service-name {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .service-icon {
            width: 32px;
            height: 32px;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2em;
            background: rgba(0,245,255,0.1);
            color: var(--neon-cyan);
        }
        
        .service-status {
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 0.75em;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .service-status.online {
            background: rgba(0,255,136,0.2);
            color: var(--neon-green);
            box-shadow: 0 0 10px rgba(0,255,136,0.3);
            animation: statusGlow 2s ease-in-out infinite;
        }
        
        .service-status.offline {
            background: rgba(255,51,102,0.2);
            color: var(--neon-red);
            box-shadow: 0 0 10px rgba(255,51,102,0.3);
        }
        
        .service-status.warning {
            background: rgba(255,204,0,0.2);
            color: var(--neon-yellow);
            box-shadow: 0 0 10px rgba(255,204,0,0.3);
            animation: warningPulse 1s ease-in-out infinite;
        }
        
        @keyframes warningPulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.6; }
        }
        
        .activity-feed {
            max-height: 200px;
            overflow-y: auto;
        }
        
        .activity-item {
            display: flex;
            gap: 12px;
            padding: 12px 10px;
            border-bottom: 1px solid rgba(255,255,255,0.05);
            font-size: 0.85em;
            transition: all 0.3s ease;
            border-radius: 8px;
            margin-bottom: 2px;
        }
        
        .activity-item:hover {
            background: rgba(0,245,255,0.05);
            border-bottom-color: transparent;
            transform: translateX(5px);
        }
        
        .activity-item:last-child {
            border-bottom: none;
        }
        
        .activity-time {
            color: var(--neon-cyan);
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.85em;
            min-width: 50px;
            opacity: 0.8;
        }
        
        .activity-text {
            color: rgba(255,255,255,0.8);
        }
        
        .chart-container {
            position: relative;
            height: 120px;
            margin-top: 15px;
            background: rgba(0,0,0,0.2);
            border-radius: 10px;
            padding: 10px;
        }
        
        .chart-canvas {
            width: 100%;
            height: 100%;
        }
        
        /* ============ LOADING ANIMATION ============ */
        .loading-dots {
            display: inline-flex;
            gap: 4px;
        }
        
        .loading-dots span {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: var(--neon-cyan);
            animation: loadingBounce 1.4s ease-in-out infinite;
        }
        
        .loading-dots span:nth-child(1) { animation-delay: -0.32s; }
        .loading-dots span:nth-child(2) { animation-delay: -0.16s; }
        .loading-dots span:nth-child(3) { animation-delay: 0s; }
        
        @keyframes loadingBounce {
            0%, 80%, 100% { transform: scale(0); opacity: 0.5; }
            40% { transform: scale(1); opacity: 1; }
        }
        
        /* ============ GLOW EFFECTS ============ */
        .glow-text {
            text-shadow: 0 0 10px currentColor, 0 0 20px currentColor;
        }
        
        .glow-box {
            box-shadow: 0 0 20px currentColor, inset 0 0 20px rgba(255,255,255,0.05);
        }
        
        /* ============ SCROLLBAR ============ */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }
        
        ::-webkit-scrollbar-track {
            background: rgba(0,0,0,0.3);
            border-radius: 4px;
        }
        
        ::-webkit-scrollbar-thumb {
            background: linear-gradient(180deg, var(--neon-cyan), var(--neon-magenta));
            border-radius: 4px;
        }
        
        ::-webkit-scrollbar-thumb:hover {
            background: linear-gradient(180deg, var(--neon-magenta), var(--neon-cyan));
            box-shadow: 0 0 10px var(--glow-cyan);
        }
        
        /* ============ HOVER GLOW UTILITY ============ */
        .hover-glow {
            transition: all 0.3s ease;
        }
        
        .hover-glow:hover {
            filter: brightness(1.2);
            text-shadow: 0 0 20px currentColor;
        }
        
        /* ============ RESPONSIVE ============ */
        @media (max-width: 1200px) {
            .main-container {
                grid-template-columns: 250px 1fr 280px;
            }
            
            .particles-container {
                display: none;
            }
        }
        
        @media (max-width: 992px) {
            .main-container {
                grid-template-columns: 1fr;
                grid-template-rows: 60px 1fr;
            }
            
            .left-sidebar, .right-sidebar {
                display: none;
            }
            
            .scanlines, .corner-decoration {
                display: none;
            }
        }
        
        /* ============ AUTOMATION PANEL ============ */
        .automation-panel {
            position: fixed;
            right: -420px;
            top: 0;
            width: 400px;
            height: 100vh;
            background: rgba(10, 10, 25, 0.98);
            border-left: 2px solid var(--neon-cyan);
            box-shadow: -10px 0 50px rgba(0, 245, 255, 0.2);
            z-index: 1000;
            transition: right 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            display: flex;
            flex-direction: column;
            overflow: hidden;
            backdrop-filter: blur(20px);
        }
        
        .automation-panel.active {
            right: 0;
        }
        
        .automation-panel .panel-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px;
            background: linear-gradient(180deg, rgba(0, 245, 255, 0.15), transparent);
            border-bottom: 1px solid rgba(0,245,255,0.2);
        }
        
        .automation-panel .panel-header h3 {
            font-family: 'Orbitron', monospace;
            color: var(--neon-cyan);
            letter-spacing: 2px;
            font-size: 1.1em;
            text-shadow: 0 0 10px rgba(0,245,255,0.5);
        }
        
        .close-panel-btn {
            width: 35px;
            height: 35px;
            border: none;
            border-radius: 50%;
            background: rgba(255, 100, 100, 0.2);
            color: #ff6666;
            font-size: 1.2em;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .close-panel-btn:hover {
            background: rgba(255, 100, 100, 0.4);
            transform: rotate(90deg);
        }
        
        .automation-panel .panel-content {
            flex: 1;
            overflow-y: auto;
            padding: 15px;
        }
        
        .automation-panel .panel-section {
            margin-bottom: 20px;
            padding: 15px;
            background: rgba(0, 245, 255, 0.03);
            border: 1px solid rgba(0, 245, 255, 0.15);
            border-radius: 12px;
        }
        
        .automation-panel .panel-section h4 {
            font-family: 'Rajdhani', sans-serif;
            color: var(--neon-cyan);
            margin-bottom: 12px;
            font-size: 0.95em;
            letter-spacing: 1px;
        }
        
        .automation-panel .panel-buttons {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 8px;
        }
        
        .automation-panel .panel-btn {
            padding: 10px 12px;
            background: rgba(0, 245, 255, 0.08);
            border: 1px solid rgba(0, 245, 255, 0.2);
            border-radius: 8px;
            color: #fff;
            font-family: 'Rajdhani', sans-serif;
            font-size: 0.85em;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: left;
        }
        
        .automation-panel .panel-btn:hover {
            background: rgba(0, 245, 255, 0.2);
            border-color: var(--neon-cyan);
            transform: translateX(3px);
            box-shadow: 0 0 15px rgba(0,245,255,0.3);
        }
        
        .automation-panel .emergency-section {
            background: rgba(255, 50, 50, 0.08);
            border-color: rgba(255, 50, 50, 0.3);
        }
        
        .automation-panel .emergency-section h4 {
            color: #ff6666;
        }
        
        .automation-panel .emergency-btn {
            background: rgba(255, 50, 50, 0.15);
            border-color: rgba(255, 50, 50, 0.3);
            color: #ff6666;
        }
        
        .automation-panel .emergency-btn:hover {
            background: rgba(255, 50, 50, 0.3);
            border-color: #ff6666;
        }
        
        .automation-panel .success-btn {
            background: rgba(0, 255, 136, 0.15);
            border-color: rgba(0, 255, 136, 0.3);
            color: var(--neon-green);
        }
        
        .automation-panel .success-btn:hover {
            background: rgba(0, 255, 136, 0.3);
            border-color: var(--neon-green);
        }
        
        .automation-panel .ai-section {
            background: rgba(128, 0, 255, 0.08);
            border-color: rgba(128, 0, 255, 0.3);
        }
        
        .automation-panel .ai-section h4 {
            color: var(--neon-purple);
        }
        
        .automation-panel .ai-btn {
            background: linear-gradient(135deg, rgba(128, 0, 255, 0.15), rgba(0, 245, 255, 0.15));
            border-color: rgba(128, 0, 255, 0.3);
        }
        
        .automation-panel .ai-btn:hover {
            background: linear-gradient(135deg, rgba(128, 0, 255, 0.3), rgba(0, 245, 255, 0.3));
            border-color: var(--neon-purple);
        }
        
        /* Automation Toggle Button */
        .automation-toggle-btn {
            position: fixed;
            right: 20px;
            bottom: 100px;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--neon-cyan), var(--neon-purple));
            border: none;
            color: #000;
            font-size: 1.5em;
            cursor: pointer;
            z-index: 999;
            box-shadow: 0 0 20px rgba(0,245,255,0.4);
            transition: all 0.3s ease;
        }
        
        .automation-toggle-btn:hover {
            transform: scale(1.1);
            box-shadow: 0 0 30px rgba(0,245,255,0.6);
        }
        
        /* ============ PILOT DIALOG ============ */
        .pilot-dialog {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.9);
            z-index: 2000;
            align-items: center;
            justify-content: center;
            animation: fadeIn 0.3s ease;
        }
        
        .pilot-dialog.active {
            display: flex;
        }
        
        .pilot-dialog-content {
            background: rgba(10, 15, 25, 0.98);
            border: 2px solid var(--neon-green);
            border-radius: 20px;
            padding: 40px;
            max-width: 450px;
            width: 90%;
            text-align: center;
            box-shadow: 0 0 60px rgba(0, 255, 136, 0.3);
            animation: dialogSlide 0.4s ease;
        }
        
        @keyframes dialogSlide {
            from { transform: translateY(-50px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }
        
        .pilot-dialog-content h3 {
            font-family: 'Orbitron', monospace;
            color: var(--neon-green);
            margin-bottom: 15px;
            letter-spacing: 2px;
        }
        
        .pilot-dialog-content p {
            color: rgba(255, 255, 255, 0.7);
            margin-bottom: 20px;
            font-size: 0.95em;
        }
        
        .pilot-dialog-content input {
            width: 100%;
            padding: 15px 20px;
            background: rgba(0, 255, 136, 0.05);
            border: 2px solid rgba(0, 255, 136, 0.3);
            border-radius: 12px;
            color: #fff;
            font-family: 'Rajdhani', sans-serif;
            font-size: 1em;
            outline: none;
            margin-bottom: 20px;
            text-align: center;
            letter-spacing: 1px;
        }
        
        .pilot-dialog-content input:focus {
            border-color: var(--neon-green);
            box-shadow: 0 0 20px rgba(0, 255, 136, 0.2);
        }
        
        .pilot-dialog-buttons {
            display: flex;
            gap: 15px;
            justify-content: center;
        }
        
        .pilot-cancel, .pilot-confirm {
            padding: 12px 30px;
            border-radius: 25px;
            font-family: 'Rajdhani', sans-serif;
            font-weight: 600;
            font-size: 0.95em;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 2px solid;
        }
        
        .pilot-cancel {
            background: transparent;
            border-color: rgba(255, 255, 255, 0.3);
            color: rgba(255, 255, 255, 0.7);
        }
        
        .pilot-cancel:hover {
            background: rgba(255, 255, 255, 0.1);
            border-color: #fff;
            color: #fff;
        }
        
        .pilot-confirm {
            background: var(--neon-green);
            border-color: var(--neon-green);
            color: #000;
        }
        
        .pilot-confirm:hover {
            background: transparent;
            color: var(--neon-green);
            box-shadow: 0 0 25px rgba(0, 255, 136, 0.5);
        }
        
        .pilot-hint {
            margin-top: 15px;
            font-size: 0.8em;
            color: rgba(255, 255, 255, 0.4);
        }
    </style>
</head>
<body>
    <!-- Futuristic Effects -->
    <div class="scanlines"></div>
    <div class="corner-decoration top-left"></div>
    <div class="corner-decoration top-right"></div>
    <div class="corner-decoration bottom-left"></div>
    <div class="corner-decoration bottom-right"></div>
    <div class="particles-container" id="particles"></div>
    
    <!-- Avatar 3D Holographic -->
    <div class="avatar-container" id="avatarContainer" data-mode="copilot" data-state="idle" data-speaking="false">
        <button class="avatar-toggle" onclick="toggleAvatarSize()">â—€</button>
        <div class="avatar-hologram">
            <div class="avatar-glow"></div>
            <div class="avatar-ring"></div>
            <div class="avatar-ring-secondary"></div>
            
            <!-- Neural network background -->
            <div class="avatar-neural">
                <div class="neural-particle"></div>
                <div class="neural-particle"></div>
                <div class="neural-particle"></div>
                <div class="neural-particle"></div>
                <div class="neural-particle"></div>
                <div class="neural-particle"></div>
                <div class="neural-connection"></div>
                <div class="neural-connection"></div>
                <div class="neural-connection"></div>
            </div>
            
            <div class="avatar-face">
                <div class="avatar-eyes">
                    <div class="avatar-eye" id="leftEye"></div>
                    <div class="avatar-eye" id="rightEye"></div>
                </div>
                <div class="avatar-mouth" id="avatarMouth"></div>
            </div>
            
            <!-- Sound wave visualizer -->
            <div class="avatar-soundwave" id="avatarSoundwave">
                <div class="soundwave-bar"></div>
                <div class="soundwave-bar"></div>
                <div class="soundwave-bar"></div>
                <div class="soundwave-bar"></div>
                <div class="soundwave-bar"></div>
                <div class="soundwave-bar"></div>
                <div class="soundwave-bar"></div>
            </div>
            
            <div class="avatar-data-stream">
                <div class="data-particle" style="animation-delay: 0s;"></div>
                <div class="data-particle" style="animation-delay: 0.25s;"></div>
                <div class="data-particle" style="animation-delay: 0.5s;"></div>
                <div class="data-particle" style="animation-delay: 0.75s;"></div>
                <div class="data-particle" style="animation-delay: 1s;"></div>
            </div>
            <div class="avatar-hud" id="avatarHUD">
                <div class="hud-item"><span>CPU</span><span id="hudCpu">---%</span></div>
                <div class="hud-item"><span>MEM</span><span id="hudMem">---%</span></div>
                <div class="hud-item"><span>NET</span><span id="hudNet">OK</span></div>
            </div>
            <div class="avatar-status" id="avatarStatus">READY</div>
        </div>
    </div>
    
    <div class="main-container">
        <!-- Top Bar -->
        <div class="top-bar">
            <div class="logo-section">
                <div class="logo">G</div>
                <div class="logo-text">
                    <h1>GIDEON 4.0</h1>
                    <span>UNIFIED INTELLIGENCE PLATFORM</span>
                </div>
            </div>
            
            <div class="mode-selector">
                <button class="mode-btn" data-mode="passive">PASSIVE</button>
                <button class="mode-btn active" data-mode="copilot">COPILOT</button>
                <button class="mode-btn" data-mode="pilot">PILOT</button>
                <button class="mode-btn" data-mode="executive">EXECUTIVE</button>
            </div>
            
            <div class="status-section">
                <div class="status-item" id="connection-status">
                    <span class="status-dot" id="status-dot"></span>
                    <span id="status-text">CONNESSIONE...</span>
                </div>
                <div class="status-item">
                    <span>ðŸ“…</span>
                    <span id="current-date">--/--/----</span>
                </div>
                <div class="status-item">
                    <span>ðŸ•</span>
                    <span id="current-time">--:--:--</span>
                </div>
                <div class="status-item">
                    <span>ðŸ”Š</span>
                    <span id="tts-status">TTS ON</span>
                </div>
                <div class="status-item">
                    <span>â±ï¸</span>
                    <span id="session-time">0:00</span>
                </div>
                <button class="debug-btn" id="debug-toggle" onclick="toggleDebugMode()" title="ModalitÃ  Debug">
                    <span class="debug-icon">ðŸ›</span>
                    <span class="debug-label">DEBUG</span>
                </button>
            </div>
        </div>
        
        <!-- Left Sidebar - Modules -->
        <div class="left-sidebar">
            <div class="sidebar-section">
                <div class="section-title">ðŸ”¬ MODULI SPECIALIZZATI</div>
                
                <div class="module-card" onclick="openModule('science')">
                    <div class="module-header">
                        <div class="module-icon science">ðŸ”¬</div>
                        <div class="module-name">SCIENTIFICO</div>
                    </div>
                    <div class="module-desc">Analisi dati, simulazioni, ricerca avanzata, machine learning</div>
                </div>
                
                <div class="module-card" onclick="openModule('medical')">
                    <div class="module-header">
                        <div class="module-icon medical">ðŸ¥</div>
                        <div class="module-name">MEDICO</div>
                    </div>
                    <div class="module-desc">Diagnostica, biometria, analisi cliniche, telemedicina</div>
                </div>
                
                <div class="module-card" onclick="openModule('security')">
                    <div class="module-header">
                        <div class="module-icon security">ðŸ›¡ï¸</div>
                        <div class="module-name">SICUREZZA CIVILE</div>
                    </div>
                    <div class="module-desc">Sorveglianza, threat detection, emergenze, protezione civile</div>
                </div>
                
                <div class="module-card" onclick="openModule('military')">
                    <div class="module-header">
                        <div class="module-icon military">âš”ï¸</div>
                        <div class="module-name">DIFESA</div>
                    </div>
                    <div class="module-desc">Intelligence, analisi strategica, cybersecurity, C4ISR</div>
                </div>
            </div>
            
            <div class="sidebar-section">
                <div class="section-title">ðŸ¤– AUTOMAZIONI</div>
                
                <div class="module-card" onclick="openModule('workflows')">
                    <div class="module-header">
                        <div class="module-icon ai">âš™ï¸</div>
                        <div class="module-name">WORKFLOW ENGINE</div>
                    </div>
                    <div class="module-desc">Crea e gestisci automazioni complesse con drag & drop</div>
                </div>
                
                <div class="module-card" onclick="openModule('scheduler')">
                    <div class="module-header">
                        <div class="module-icon ai">ðŸ“…</div>
                        <div class="module-name">SCHEDULER</div>
                    </div>
                    <div class="module-desc">Pianifica task e automazioni programmate</div>
                </div>
            </div>
            
            <div class="sidebar-section">
                <div class="section-title">ðŸš¨ CRISIS MODE</div>
                
                <div class="module-card cam-module" onclick="openCAMPanel()" id="cam-card">
                    <div class="module-header">
                        <div class="module-icon cam">ðŸŽ¯</div>
                        <div class="module-name">CAM</div>
                        <div class="cam-status-indicator" id="cam-status-dot"></div>
                    </div>
                    <div class="module-desc">Crisis Automation Mode - Gestione crisi intelligente</div>
                    <div class="cam-level" id="cam-level-display">MONITORING</div>
                </div>
                
                <div class="module-card" onclick="triggerEmergencyStop()">
                    <div class="module-header">
                        <div class="module-icon emergency">ðŸ›‘</div>
                        <div class="module-name">EMERGENCY STOP</div>
                    </div>
                    <div class="module-desc">Ferma tutte le automazioni immediatamente</div>
                </div>
            </div>
            
            <div class="sidebar-section">
                <div class="section-title">âš¡ QUICK ACTIONS</div>
                <div class="module-card" onclick="executeQuickAction('screenshot')">
                    <div class="module-header">
                        <div class="module-icon ai">ðŸ“¸</div>
                        <div class="module-name">ANALIZZA SCHERMO</div>
                    </div>
                </div>
                <div class="module-card" onclick="executeQuickAction('camera')">
                    <div class="module-header">
                        <div class="module-icon ai">ðŸ“·</div>
                        <div class="module-name">VISION CAMERA</div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Main Area -->
        <div class="main-area">
            <div class="tab-nav">
                <button class="tab-btn active" onclick="switchTab('chat')">ðŸ’¬ CHAT</button>
                <button class="tab-btn" onclick="switchTab('workflow')">ðŸ”„ WORKFLOW</button>
                <button class="tab-btn" onclick="switchTab('monitor')">ðŸ“Š MONITOR</button>
                <button class="tab-btn" onclick="switchTab('logs')">ðŸ“‹ LOGS</button>
            </div>
            
            <!-- Chat Tab -->
            <div id="tab-chat" class="tab-content active">
                <div class="chat-messages" id="chat-messages">
                    <div class="message assistant">
                        <div class="message-content">
                            ðŸ‘‹ <strong>Benvenuto in GIDEON 4.0 - Unified Intelligence Platform</strong><br><br>
                            Sono il tuo assistente AI avanzato per applicazioni scientifiche, mediche e di sicurezza.
                            Seleziona un modulo dalla sidebar o inizia a chattare per esplorare le funzionalitÃ .
                        </div>
                        <div class="message-meta">GIDEON â€¢ Ora</div>
                    </div>
                </div>
                
                <div class="typing-indicator" id="typing-indicator">
                    <div class="typing-dots">
                        <span></span>
                        <span></span>
                        <span></span>
                    </div>
                </div>
                
                <!-- Reasoning Preview -->
                <div class="reasoning-preview" id="reasoning-preview">
                    ðŸ§  Analizzando...
                </div>
                
                <div class="chat-input-area">
                    <!-- Voice Controls Grid -->
                    <div class="controls-grid">
                        <!-- Microfono -->
                        <div class="control-card" id="mic-card">
                            <div class="card-header">
                                <button class="card-btn" id="mic-btn">
                                    <span class="icon">ðŸŽ¤</span>
                                    <span class="label">Microfono</span>
                                </button>
                                <button class="info-toggle" onclick="toggleCardInfo('mic-card')">â„¹ï¸</button>
                            </div>
                            <div class="card-info" id="mic-info">
                                <strong>ðŸŽ¤ Riconoscimento Vocale</strong><br>
                                Parla e GIDEON trascriverÃ  automaticamente.
                                <ul>
                                    <li>Clicca per attivare il microfono</li>
                                    <li>Parla chiaramente in italiano</li>
                                    <li>Il messaggio viene inviato automaticamente</li>
                                </ul>
                            </div>
                        </div>
                        
                        <!-- Voce GIDEON - ATTIVO DI DEFAULT -->
                        <div class="control-card active" id="tts-card">
                            <div class="card-header">
                                <button class="card-btn active" id="tts-btn">
                                    <span class="icon">ðŸ”Š</span>
                                    <span class="label">Voce</span>
                                </button>
                                <button class="info-toggle" onclick="toggleCardInfo('tts-card')">â„¹ï¸</button>
                            </div>
                            <div class="card-info" id="tts-info">
                                <strong>ðŸ”Š Voce di GIDEON (ATTIVA)</strong><br>
                                GIDEON parlerÃ  le risposte ad alta voce.
                                <ul>
                                    <li>Usa voce neurale italiana (Giuseppe)</li>
                                    <li>Attiva/disattiva con un click</li>
                                    <li>Perfetto per multitasking</li>
                                </ul>
                            </div>
                        </div>
                        
                        <!-- Hands-Free -->
                        <div class="control-card" id="handsfree-card">
                            <div class="card-header">
                                <button class="card-btn" id="handsfree-btn">
                                    <span class="icon">ðŸ™Œ</span>
                                    <span class="label">Hands-Free</span>
                                </button>
                                <button class="info-toggle" onclick="toggleCardInfo('handsfree-card')">â„¹ï¸</button>
                            </div>
                            <div class="card-info" id="handsfree-info">
                                <strong>ðŸ™Œ ModalitÃ  Vivavoce</strong><br>
                                Conversazione continua senza toccare nulla.
                                <ul>
                                    <li>Attiva microfono + voce insieme</li>
                                    <li>GIDEON ascolta sempre</li>
                                    <li>Dopo ogni risposta, riprende ad ascoltare</li>
                                    <li>Ideale mentre lavori o guidi</li>
                                </ul>
                            </div>
                        </div>
                        
                        <!-- Camera -->
                        <div class="control-card" id="camera-card">
                            <div class="card-header">
                                <button class="card-btn" id="camera-btn">
                                    <span class="icon">ðŸ“·</span>
                                    <span class="label">Camera</span>
                                </button>
                                <button class="info-toggle" onclick="toggleCardInfo('camera-card')">â„¹ï¸</button>
                            </div>
                            <div class="card-info" id="camera-info">
                                <strong>ðŸ“· Fotocamera AI</strong><br>
                                Scatta foto e GIDEON le analizza con AI.
                                <ul>
                                    <li>Apre anteprima webcam</li>
                                    <li>Scrivi una domanda sull'immagine</li>
                                    <li>Scatta e ricevi analisi istantanea</li>
                                    <li>Riconosce oggetti, testo, documenti</li>
                                </ul>
                            </div>
                        </div>
                        
                        <!-- Screenshot -->
                        <div class="control-card" id="screenshot-card">
                            <div class="card-header">
                                <button class="card-btn" id="screenshot-btn">
                                    <span class="icon">ðŸ–¼ï¸</span>
                                    <span class="label">Screenshot</span>
                                </button>
                                <button class="info-toggle" onclick="toggleCardInfo('screenshot-card')">â„¹ï¸</button>
                            </div>
                            <div class="card-info" id="screenshot-info">
                                <strong>ðŸ–¼ï¸ Screenshot + Analisi AI</strong><br>
                                Cattura lo schermo e GIDEON lo analizza.
                                <ul>
                                    <li>Cattura istantanea dello schermo</li>
                                    <li>AI Vision analizza il contenuto</li>
                                    <li>Legge testo, descrive grafici</li>
                                    <li>Utile per debug o spiegazioni</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Hands-Free Indicator -->
                    <div class="hands-free-indicator" id="handsfree-indicator">
                        <span class="icon">ðŸŽ§</span>
                        <span>HANDS-FREE ATTIVO - Parla quando vuoi!</span>
                    </div>
                    
                    <!-- Response Mode Selector -->
                    <div class="response-mode-selector">
                        <button class="response-mode-btn eco" data-mode="eco" title="Risposte brevi e veloci">
                            <span class="mode-indicator">ðŸ’š</span> ECO
                        </button>
                        <button class="response-mode-btn fast active" data-mode="fast" title="Bilanciato velocitÃ /qualitÃ ">
                            <span class="mode-indicator">âš¡</span> FAST
                        </button>
                        <button class="response-mode-btn deep" data-mode="deep" title="Risposte approfondite">
                            <span class="mode-indicator">ðŸ§ </span> DEEP
                        </button>
                    </div>
                    
                    <!-- Quick Actions -->
                    <div class="quick-actions">
                        <button class="quick-action" data-message="Che ore sono?">ðŸ• ORA</button>
                        <button class="quick-action" data-message="Che giorno Ã¨ oggi?">ðŸ“… DATA</button>
                        <button class="quick-action" data-message="Com'Ã¨ il meteo oggi?">ðŸŒ¤ï¸ METEO</button>
                        <button class="quick-action" data-action="open_app" data-params='{"name":"chrome"}'>ðŸŒ CHROME</button>
                        <button class="quick-action" data-action="open_url" data-params='{"url":"https://youtube.com"}'>â–¶ï¸ YOUTUBE</button>
                        <button class="quick-action" data-message="Mostra lo stato del sistema">ðŸ“Š SISTEMA</button>
                        <button class="quick-action" data-message="Quanto fa 100 * 25?">ðŸ§® CALCOLA</button>
                        <button class="quick-action" data-message="Fai uno screenshot">ðŸ“¸ SCREENSHOT</button>
                        <button class="quick-action" data-action="open_app" data-params='{"name":"calculator"}'>ðŸ”¢ CALC</button>
                        <button class="quick-action" data-message="Quali comandi supporti?">â“ AIUTO</button>
                    </div>
                    
                    <!-- Hidden file input for image upload -->
                    <input type="file" id="image-upload" accept="image/*" style="display: none;" onchange="handleImageUpload(event)">
                    
                    <!-- Image Preview Container -->
                    <div id="image-preview-container" style="display: none; padding: 10px 15px; background: rgba(0,0,0,0.3); border-radius: 10px; margin-bottom: 10px;">
                        <div style="position: relative; display: inline-block;">
                            <img id="image-preview" style="max-width: 200px; max-height: 150px; border-radius: 8px; border: 2px solid var(--neon-cyan);">
                            <button onclick="removeImagePreview()" style="position: absolute; top: -8px; right: -8px; width: 24px; height: 24px; border-radius: 50%; background: #ff4444; border: none; color: white; cursor: pointer; font-size: 14px;">âœ•</button>
                        </div>
                        <input type="text" id="image-question" placeholder="Fai una domanda sull'immagine..." style="width: 100%; margin-top: 10px; padding: 10px; background: rgba(0,0,0,0.4); border: 1px solid var(--neon-cyan); border-radius: 8px; color: white; font-family: inherit;">
                        <button onclick="sendImageQuestion()" style="margin-top: 8px; padding: 8px 16px; background: var(--neon-cyan); border: none; border-radius: 8px; color: #000; cursor: pointer; font-weight: 600;">ðŸ“¤ Analizza Immagine</button>
                    </div>
                    
                    <!-- Input Area -->
                    <div class="input-wrapper">
                        <div style="display: flex; gap: 8px; margin-right: 10px;">
                            <button class="quick-action" onclick="document.getElementById('image-upload').click()" title="Carica immagine">ðŸ“·</button>
                            <button class="quick-action" onclick="openCamera()" title="Apri fotocamera">ðŸ“¸</button>
                            <button class="quick-action" onclick="captureScreenshot()" title="Screenshot">ðŸ–¼ï¸</button>
                        </div>
                        <textarea class="chat-textarea" id="chat-input" placeholder="Scrivi un messaggio o usa il microfono per parlare con GIDEON..." rows="1"></textarea>
                        <button class="send-btn" id="send-btn" title="Invia messaggio">âž¤</button>
                    </div>
                </div>
            </div>
            
            <!-- Workflow Tab -->
            <div id="tab-workflow" class="tab-content">
                <div class="workflow-area">
                    <div class="workflow-toolbar">
                        <button class="toolbar-btn" onclick="addWorkflowNode('trigger')">âž• Trigger</button>
                        <button class="toolbar-btn" onclick="addWorkflowNode('action')">âš¡ Action</button>
                        <button class="toolbar-btn" onclick="addWorkflowNode('condition')">ðŸ”€ Condition</button>
                        <button class="toolbar-btn" onclick="addWorkflowNode('ai')">ðŸ¤– AI Node</button>
                        <button class="toolbar-btn" onclick="saveWorkflow()">ðŸ’¾ Save</button>
                        <button class="toolbar-btn" onclick="runWorkflow()">â–¶ï¸ Run</button>
                    </div>
                    <div class="workflow-canvas" id="workflow-canvas">
                        <!-- Nodes will be added here -->
                    </div>
                </div>
            </div>
            
            <!-- Monitor Tab -->
            <div id="tab-monitor" class="tab-content">
                <div class="monitor-dashboard">
                    <!-- Header -->
                    <div class="monitor-header">
                        <div class="monitor-title">
                            <span>ðŸ“Š</span> SYSTEM MONITOR
                        </div>
                        <div class="monitor-status">
                            <span class="status-dot"></span>
                            <span>LIVE</span>
                            <span id="monitor-time">00:00:00</span>
                        </div>
                    </div>
                    
                    <!-- Metrics Grid -->
                    <div class="monitor-grid">
                        <!-- CPU -->
                        <div class="monitor-card">
                            <div class="card-title">
                                <span>ðŸ§ </span> CPU USAGE
                            </div>
                            <div class="metric-value" id="cpu-value">0<span class="metric-unit">%</span></div>
                            <div class="metric-bar">
                                <div class="metric-fill cpu" id="cpu-bar" style="width: 0%"></div>
                            </div>
                            <div class="metric-details">
                                <span id="cpu-cores">Cores: -</span>
                                <span id="cpu-speed">Speed: -</span>
                            </div>
                        </div>
                        
                        <!-- RAM -->
                        <div class="monitor-card">
                            <div class="card-title">
                                <span>ðŸ’¾</span> MEMORY (RAM)
                            </div>
                            <div class="metric-value" id="ram-value">0<span class="metric-unit">%</span></div>
                            <div class="metric-bar">
                                <div class="metric-fill ram" id="ram-bar" style="width: 0%"></div>
                            </div>
                            <div class="metric-details">
                                <span id="ram-used">Used: -</span>
                                <span id="ram-total">Total: -</span>
                            </div>
                        </div>
                        
                        <!-- Disk -->
                        <div class="monitor-card">
                            <div class="card-title">
                                <span>ðŸ’½</span> DISK USAGE
                            </div>
                            <div class="metric-value" id="disk-value">0<span class="metric-unit">%</span></div>
                            <div class="metric-bar">
                                <div class="metric-fill disk" id="disk-bar" style="width: 0%"></div>
                            </div>
                            <div class="metric-details">
                                <span id="disk-used">Used: -</span>
                                <span id="disk-total">Total: -</span>
                            </div>
                        </div>
                        
                        <!-- Network -->
                        <div class="monitor-card">
                            <div class="card-title">
                                <span>ðŸŒ</span> NETWORK
                            </div>
                            <div class="metric-value" id="network-value">0<span class="metric-unit">KB/s</span></div>
                            <div class="metric-bar">
                                <div class="metric-fill network" id="network-bar" style="width: 0%"></div>
                            </div>
                            <div class="metric-details">
                                <span id="network-down">â†“ 0 KB/s</span>
                                <span id="network-up">â†‘ 0 KB/s</span>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Services & Activity -->
                    <div class="monitor-grid">
                        <!-- Services Status -->
                        <div class="monitor-card">
                            <div class="card-title">
                                <span>âš™ï¸</span> SERVICES STATUS
                            </div>
                            <div class="services-list" id="services-list">
                                <div class="service-item">
                                    <div class="service-name">
                                        <div class="service-icon" style="background: rgba(0,245,255,0.2);">ðŸ¤–</div>
                                        <div>
                                            <div style="font-weight: 600;">Backend API</div>
                                            <div style="font-size: 0.8em; color: rgba(255,255,255,0.5);">Port 8001</div>
                                        </div>
                                    </div>
                                    <span class="service-status online" id="backend-status">ONLINE</span>
                                </div>
                                <div class="service-item">
                                    <div class="service-name">
                                        <div class="service-icon" style="background: rgba(128,0,255,0.2);">ðŸŒ</div>
                                        <div>
                                            <div style="font-weight: 600;">Frontend Server</div>
                                            <div style="font-size: 0.8em; color: rgba(255,255,255,0.5);">Port 3000</div>
                                        </div>
                                    </div>
                                    <span class="service-status online" id="frontend-status">ONLINE</span>
                                </div>
                                <div class="service-item">
                                    <div class="service-name">
                                        <div class="service-icon" style="background: rgba(0,255,136,0.2);">ðŸ”Š</div>
                                        <div>
                                            <div style="font-weight: 600;">TTS Engine</div>
                                            <div style="font-size: 0.8em; color: rgba(255,255,255,0.5);">Edge Neural</div>
                                        </div>
                                    </div>
                                    <span class="service-status online" id="tts-service-status">ONLINE</span>
                                </div>
                                <div class="service-item">
                                    <div class="service-name">
                                        <div class="service-icon" style="background: rgba(255,136,0,0.2);">ðŸ§ </div>
                                        <div>
                                            <div style="font-weight: 600;">AI Provider</div>
                                            <div style="font-size: 0.8em; color: rgba(255,255,255,0.5);">OpenRouter</div>
                                        </div>
                                    </div>
                                    <span class="service-status online" id="ai-status">ONLINE</span>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Activity Feed -->
                        <div class="monitor-card">
                            <div class="card-title">
                                <span>ðŸ“</span> RECENT ACTIVITY
                            </div>
                            <div class="activity-feed" id="activity-feed">
                                <div class="activity-item">
                                    <span class="activity-time">NOW</span>
                                    <span class="activity-text">ðŸŸ¢ System Monitor initialized</span>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- GIDEON Stats -->
                    <div class="monitor-grid">
                        <div class="monitor-card">
                            <div class="card-title">
                                <span>ðŸ’¬</span> SESSION STATS
                            </div>
                            <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 15px; text-align: center;">
                                <div>
                                    <div class="metric-value" style="font-size: 1.8em;" id="stat-messages">0</div>
                                    <div style="font-size: 0.8em; color: rgba(255,255,255,0.5);">Messages</div>
                                </div>
                                <div>
                                    <div class="metric-value" style="font-size: 1.8em;" id="stat-actions">0</div>
                                    <div style="font-size: 0.8em; color: rgba(255,255,255,0.5);">Actions</div>
                                </div>
                                <div>
                                    <div class="metric-value" style="font-size: 1.8em;" id="stat-uptime">0m</div>
                                    <div style="font-size: 0.8em; color: rgba(255,255,255,0.5);">Uptime</div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="monitor-card">
                            <div class="card-title">
                                <span>ðŸŽ¯</span> CURRENT MODE
                            </div>
                            <div style="display: flex; align-items: center; gap: 15px;">
                                <div class="metric-value" style="font-size: 1.5em;" id="current-mode-display">COPILOT</div>
                                <div style="flex: 1;">
                                    <div style="font-size: 0.85em; color: rgba(255,255,255,0.6);" id="mode-description">Assistenza attiva con conferma utente</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Logs Tab -->
            <div id="tab-logs" class="tab-content">
                <div style="padding: 20px; font-family: 'JetBrains Mono', monospace; font-size: 0.85em; color: var(--neon-green);" id="logs-container">
                    [SYSTEM] GIDEON 4.0 initialized<br>
                    [INFO] All modules loaded successfully<br>
                    [INFO] AI Services connected<br>
                    [INFO] Waiting for user input...
                </div>
            </div>
        </div>
        
        <!-- Right Sidebar - AI Services -->
        <div class="right-sidebar">
            <div class="section-title">ðŸš€ AI SERVICES</div>
            
            <!-- Video AI -->
            <div class="service-card" onclick="openAIService('veo')">
                <div class="service-header">
                    <span class="service-badge video">VIDEO</span>
                    <span class="service-name">Veo 3.1</span>
                </div>
                <div class="service-desc">Google DeepMind - Video generation</div>
                <div class="service-actions">
                    <button class="service-btn">Info</button>
                    <button class="service-btn primary">Genera</button>
                </div>
            </div>
            
            <div class="service-card" onclick="openAIService('sora')">
                <div class="service-header">
                    <span class="service-badge video">VIDEO</span>
                    <span class="service-name">Sora 2</span>
                </div>
                <div class="service-desc">OpenAI - Text to video AI</div>
                <div class="service-actions">
                    <button class="service-btn">Info</button>
                    <button class="service-btn primary">Genera</button>
                </div>
            </div>
            
            <div class="service-card" onclick="openAIService('luma')">
                <div class="service-header">
                    <span class="service-badge video">VIDEO</span>
                    <span class="service-name">Luma Dream</span>
                </div>
                <div class="service-desc">Luma AI - Creative video generation</div>
                <div class="service-actions">
                    <button class="service-btn">Info</button>
                    <button class="service-btn primary">Genera</button>
                </div>
            </div>
            
            <!-- Image AI -->
            <div class="service-card" onclick="openAIService('seedream')">
                <div class="service-header">
                    <span class="service-badge image">IMAGE</span>
                    <span class="service-name">Seedream 3.0</span>
                </div>
                <div class="service-desc">ByteDance - Photorealistic images</div>
                <div class="service-actions">
                    <button class="service-btn">Info</button>
                    <button class="service-btn primary">Genera</button>
                </div>
            </div>
            
            <div class="service-card" onclick="openAIService('seedvr')">
                <div class="service-header">
                    <span class="service-badge image">IMAGE</span>
                    <span class="service-name">SeedVR</span>
                </div>
                <div class="service-desc">360Â° panoramic VR images</div>
                <div class="service-actions">
                    <button class="service-btn">Info</button>
                    <button class="service-btn primary">Genera</button>
                </div>
            </div>
            
            <div class="service-card" onclick="openAIService('dalle')">
                <div class="service-header">
                    <span class="service-badge image">IMAGE</span>
                    <span class="service-name">DALL-E 3</span>
                </div>
                <div class="service-desc">OpenAI - Image generation</div>
                <div class="service-actions">
                    <button class="service-btn">Info</button>
                    <button class="service-btn primary">Genera</button>
                </div>
            </div>
            
            <!-- Audio AI -->
            <div class="service-card" onclick="openAIService('suno')">
                <div class="service-header">
                    <span class="service-badge audio">AUDIO</span>
                    <span class="service-name">Suno AI</span>
                </div>
                <div class="service-desc">AI music generation</div>
                <div class="service-actions">
                    <button class="service-btn">Info</button>
                    <button class="service-btn primary">Genera</button>
                </div>
            </div>
            
            <div class="service-card" onclick="openAIService('udio')">
                <div class="service-header">
                    <span class="service-badge audio">AUDIO</span>
                    <span class="service-name">Udio</span>
                </div>
                <div class="service-desc">AI music & voice generation</div>
                <div class="service-actions">
                    <button class="service-btn">Info</button>
                    <button class="service-btn primary">Genera</button>
                </div>
            </div>
            
            <!-- Text AI -->
            <div class="service-card" onclick="openAIService('openrouter')">
                <div class="service-header">
                    <span class="service-badge text">TEXT</span>
                    <span class="service-name">OpenRouter</span>
                </div>
                <div class="service-desc">Multi-model AI gateway</div>
                <div class="service-actions">
                    <button class="service-btn">Info</button>
                    <button class="service-btn primary">Usa</button>
                </div>
            </div>
            
            <!-- GitHub Integration -->
            <div class="section-title" style="margin-top: 20px;">ðŸ™ GITHUB</div>
            <div class="service-card" onclick="openGitHubPanel()" style="border-color: rgba(110,84,148,0.5); background: rgba(110,84,148,0.1);">
                <div class="service-header">
                    <span class="service-badge" style="background: linear-gradient(135deg, #6e5494, #8b5cf6);">DEV</span>
                    <span class="service-name">GitHub Hub</span>
                </div>
                <div class="service-desc">Repos, Issues, Gists, PRs</div>
                <div class="service-actions">
                    <button class="service-btn" onclick="event.stopPropagation(); checkGitHubStatus()">Status</button>
                    <button class="service-btn primary" style="background: linear-gradient(135deg, #6e5494, #8b5cf6);">Apri</button>
                </div>
            </div>
            <div id="github-status-indicator" style="font-size: 0.75em; padding: 5px 10px; color: rgba(255,255,255,0.5); display: none;">
                <span id="github-status-text">Verificando...</span>
            </div>
        </div>
    </div>
    
    <!-- Module Panels -->
    <div class="panel-overlay" id="science-panel">
        <div class="spec-panel">
            <div class="panel-header" style="border-color: var(--science-color);">
                <div class="panel-title" style="color: var(--science-color);">
                    ðŸ”¬ MODULO SCIENTIFICO
                </div>
                <button class="panel-close" onclick="closePanel('science-panel')">Ã—</button>
            </div>
            <div class="panel-body">
                <div class="science-grid">
                    <div class="science-tool">
                        <div class="tool-icon science">ðŸ“Š</div>
                        <div class="tool-name">Data Analysis</div>
                        <div class="tool-desc">Analisi avanzata di dataset con ML e deep learning. Supporta CSV, JSON, Excel.</div>
                        <button class="tool-btn" onclick="runScienceTool('data_analysis')">AVVIA ANALISI</button>
                    </div>
                    <div class="science-tool">
                        <div class="tool-icon science">ðŸ§¬</div>
                        <div class="tool-name">Genomics Lab</div>
                        <div class="tool-desc">Analisi sequenze genetiche, allineamento, mutazioni, CRISPR design.</div>
                        <button class="tool-btn" onclick="runScienceTool('genomics')">AVVIA LAB</button>
                    </div>
                    <div class="science-tool">
                        <div class="tool-icon science">ðŸŒ¡ï¸</div>
                        <div class="tool-name">Climate Modeling</div>
                        <div class="tool-desc">Simulazioni climatiche, previsioni meteo avanzate, analisi satellitare.</div>
                        <button class="tool-btn" onclick="runScienceTool('climate')">SIMULA</button>
                    </div>
                    <div class="science-tool">
                        <div class="tool-icon science">âš›ï¸</div>
                        <div class="tool-name">Physics Simulator</div>
                        <div class="tool-desc">Simulazioni fisiche, meccanica quantistica, dinamica dei fluidi.</div>
                        <button class="tool-btn" onclick="runScienceTool('physics')">SIMULA</button>
                    </div>
                    <div class="science-tool">
                        <div class="tool-icon science">ðŸ”­</div>
                        <div class="tool-name">Astronomy Tools</div>
                        <div class="tool-desc">Calcoli orbitali, analisi spettrale, tracking oggetti celesti.</div>
                        <button class="tool-btn" onclick="runScienceTool('astronomy')">ESPLORA</button>
                    </div>
                    <div class="science-tool">
                        <div class="tool-icon science">ðŸ§ª</div>
                        <div class="tool-name">Chemistry Lab</div>
                        <div class="tool-desc">Molecole 3D, reazioni chimiche, calcolo proprietÃ  molecolari.</div>
                        <button class="tool-btn" onclick="runScienceTool('chemistry')">AVVIA LAB</button>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <div class="panel-overlay" id="medical-panel">
        <div class="spec-panel">
            <div class="panel-header" style="border-color: var(--medical-color);">
                <div class="panel-title" style="color: var(--medical-color);">
                    ðŸ¥ MODULO MEDICO
                </div>
                <button class="panel-close" onclick="closePanel('medical-panel')">Ã—</button>
            </div>
            <div class="panel-body">
                <div class="science-grid">
                    <div class="science-tool" style="border-color: rgba(255,51,102,0.3); background: rgba(255,51,102,0.05);">
                        <div class="tool-icon medical">ðŸ©º</div>
                        <div class="tool-name">Diagnostica AI</div>
                        <div class="tool-desc">Analisi sintomi, supporto diagnostico, suggerimenti terapeutici.</div>
                        <button class="tool-btn medical" onclick="runMedicalTool('diagnostics')">ANALIZZA</button>
                    </div>
                    <div class="science-tool" style="border-color: rgba(255,51,102,0.3); background: rgba(255,51,102,0.05);">
                        <div class="tool-icon medical">ðŸ«€</div>
                        <div class="tool-name">Biometria</div>
                        <div class="tool-desc">Monitoraggio vitali, ECG analysis, fitness tracking avanzato.</div>
                        <button class="tool-btn medical" onclick="runMedicalTool('biometry')">MONITORA</button>
                    </div>
                    <div class="science-tool" style="border-color: rgba(255,51,102,0.3); background: rgba(255,51,102,0.05);">
                        <div class="tool-icon medical">ðŸ§ </div>
                        <div class="tool-name">Neuroimaging</div>
                        <div class="tool-desc">Analisi MRI/CT, mapping cerebrale, detection anomalie.</div>
                        <button class="tool-btn medical" onclick="runMedicalTool('neuro')">ANALIZZA</button>
                    </div>
                    <div class="science-tool" style="border-color: rgba(255,51,102,0.3); background: rgba(255,51,102,0.05);">
                        <div class="tool-icon medical">ðŸ’Š</div>
                        <div class="tool-name">Farmacologia</div>
                        <div class="tool-desc">Interazioni farmaci, dosaggi personalizzati, effetti collaterali.</div>
                        <button class="tool-btn medical" onclick="runMedicalTool('pharma')">CONSULTA</button>
                    </div>
                    <div class="science-tool" style="border-color: rgba(255,51,102,0.3); background: rgba(255,51,102,0.05);">
                        <div class="tool-icon medical">ðŸ¦ </div>
                        <div class="tool-name">Epidemiologia</div>
                        <div class="tool-desc">Tracking epidemie, modelli predittivi, analisi outbreak.</div>
                        <button class="tool-btn medical" onclick="runMedicalTool('epidemiology')">TRACCIA</button>
                    </div>
                    <div class="science-tool" style="border-color: rgba(255,51,102,0.3); background: rgba(255,51,102,0.05);">
                        <div class="tool-icon medical">ðŸ“±</div>
                        <div class="tool-name">Telemedicina</div>
                        <div class="tool-desc">Consulti remoti, triage AI, gestione pazienti.</div>
                        <button class="tool-btn medical" onclick="runMedicalTool('telemedicine')">CONNETTI</button>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <div class="panel-overlay" id="security-panel">
        <div class="spec-panel">
            <div class="panel-header" style="border-color: var(--security-color);">
                <div class="panel-title" style="color: var(--security-color);">
                    ðŸ›¡ï¸ SICUREZZA CIVILE
                </div>
                <button class="panel-close" onclick="closePanel('security-panel')">Ã—</button>
            </div>
            <div class="panel-body">
                <div class="science-grid">
                    <div class="science-tool" style="border-color: rgba(255,204,0,0.3); background: rgba(255,204,0,0.05);">
                        <div class="tool-icon security">ðŸ“¹</div>
                        <div class="tool-name">Video Analytics</div>
                        <div class="tool-desc">Analisi CCTV real-time, riconoscimento facciale, object detection.</div>
                        <button class="tool-btn security" onclick="runSecurityTool('video_analytics')">ATTIVA</button>
                    </div>
                    <div class="science-tool" style="border-color: rgba(255,204,0,0.3); background: rgba(255,204,0,0.05);">
                        <div class="tool-icon security">ðŸš¨</div>
                        <div class="tool-name">Threat Detection</div>
                        <div class="tool-desc">Identificazione minacce, anomaly detection, alerting automatico.</div>
                        <button class="tool-btn security" onclick="runSecurityTool('threat_detection')">SCAN</button>
                    </div>
                    <div class="science-tool" style="border-color: rgba(255,204,0,0.3); background: rgba(255,204,0,0.05);">
                        <div class="tool-icon security">ðŸ—ºï¸</div>
                        <div class="tool-name">GeoTracking</div>
                        <div class="tool-desc">Tracking GPS, geofencing, analisi percorsi, heatmaps.</div>
                        <button class="tool-btn security" onclick="runSecurityTool('geo_tracking')">MAPPA</button>
                    </div>
                    <div class="science-tool" style="border-color: rgba(255,204,0,0.3); background: rgba(255,204,0,0.05);">
                        <div class="tool-icon security">ðŸš’</div>
                        <div class="tool-name">Emergency Response</div>
                        <div class="tool-desc">Coordinamento emergenze, dispatch ottimizzato, comunicazioni.</div>
                        <button class="tool-btn security" onclick="runSecurityTool('emergency')">ATTIVA</button>
                    </div>
                    <div class="science-tool" style="border-color: rgba(255,204,0,0.3); background: rgba(255,204,0,0.05);">
                        <div class="tool-icon security">ðŸŒŠ</div>
                        <div class="tool-name">Disaster Prediction</div>
                        <div class="tool-desc">Previsione calamitÃ  naturali, early warning, evacuazioni.</div>
                        <button class="tool-btn security" onclick="runSecurityTool('disaster')">MONITORA</button>
                    </div>
                    <div class="science-tool" style="border-color: rgba(255,204,0,0.3); background: rgba(255,204,0,0.05);">
                        <div class="tool-icon security">ðŸ”</div>
                        <div class="tool-name">Access Control</div>
                        <div class="tool-desc">Gestione accessi, badge virtuali, verifica identitÃ .</div>
                        <button class="tool-btn security" onclick="runSecurityTool('access_control')">GESTISCI</button>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- GitHub Panel -->
    <div class="panel-overlay" id="github-panel">
        <div class="spec-panel" style="max-width: 900px;">
            <div class="panel-header" style="border-color: #6e5494;">
                <div class="panel-title" style="color: #8b5cf6;">
                    ðŸ™ GITHUB HUB - GIDEON
                </div>
                <button class="panel-close" onclick="closePanel('github-panel')">Ã—</button>
            </div>
            <div class="panel-body">
                <!-- GitHub Status -->
                <div id="github-connection-status" style="padding: 15px; background: rgba(0,0,0,0.3); border-radius: 10px; margin-bottom: 20px; display: flex; justify-content: space-between; align-items: center;">
                    <div>
                        <span id="gh-status-icon">â³</span>
                        <span id="gh-status-text">Verifica connessione...</span>
                    </div>
                    <div id="gh-user-info" style="display: none; color: var(--neon-cyan);">
                        ðŸ‘¤ <span id="gh-username"></span>
                    </div>
                </div>
                
                <!-- GitHub Actions Grid -->
                <div class="science-grid" style="grid-template-columns: repeat(3, 1fr);">
                    <!-- Repositories -->
                    <div class="science-tool" style="border-color: rgba(110,84,148,0.3); background: rgba(110,84,148,0.05);">
                        <div class="tool-icon" style="background: linear-gradient(135deg, #6e5494, #8b5cf6);">ðŸ“¦</div>
                        <div class="tool-name">I Miei Repos</div>
                        <div class="tool-desc">Visualizza tutti i tuoi repository GitHub con statistiche.</div>
                        <button class="tool-btn" style="background: linear-gradient(135deg, #6e5494, #8b5cf6);" onclick="gitHubAction('list_repos')">LISTA REPOS</button>
                    </div>
                    
                    <!-- Create Repo -->
                    <div class="science-tool" style="border-color: rgba(110,84,148,0.3); background: rgba(110,84,148,0.05);">
                        <div class="tool-icon" style="background: linear-gradient(135deg, #6e5494, #8b5cf6);">âž•</div>
                        <div class="tool-name">Crea Repository</div>
                        <div class="tool-desc">Crea un nuovo repository su GitHub con opzioni personalizzate.</div>
                        <button class="tool-btn" style="background: linear-gradient(135deg, #6e5494, #8b5cf6);" onclick="gitHubAction('create_repo')">CREA REPO</button>
                    </div>
                    
                    <!-- Issues -->
                    <div class="science-tool" style="border-color: rgba(110,84,148,0.3); background: rgba(110,84,148,0.05);">
                        <div class="tool-icon" style="background: linear-gradient(135deg, #6e5494, #8b5cf6);">ðŸ“‹</div>
                        <div class="tool-name">Issues</div>
                        <div class="tool-desc">Gestisci issues: crea, aggiorna, chiudi e commenta.</div>
                        <button class="tool-btn" style="background: linear-gradient(135deg, #6e5494, #8b5cf6);" onclick="gitHubAction('issues')">GESTISCI</button>
                    </div>
                    
                    <!-- Gists -->
                    <div class="science-tool" style="border-color: rgba(110,84,148,0.3); background: rgba(110,84,148,0.05);">
                        <div class="tool-icon" style="background: linear-gradient(135deg, #6e5494, #8b5cf6);">ðŸ“</div>
                        <div class="tool-name">Gists</div>
                        <div class="tool-desc">Crea e gestisci snippet di codice come Gists pubblici o privati.</div>
                        <button class="tool-btn" style="background: linear-gradient(135deg, #6e5494, #8b5cf6);" onclick="gitHubAction('gists')">CREA GIST</button>
                    </div>
                    
                    <!-- Pull Requests -->
                    <div class="science-tool" style="border-color: rgba(110,84,148,0.3); background: rgba(110,84,148,0.05);">
                        <div class="tool-icon" style="background: linear-gradient(135deg, #6e5494, #8b5cf6);">ðŸ”€</div>
                        <div class="tool-name">Pull Requests</div>
                        <div class="tool-desc">Visualizza e crea Pull Requests sui tuoi repository.</div>
                        <button class="tool-btn" style="background: linear-gradient(135deg, #6e5494, #8b5cf6);" onclick="gitHubAction('pull_requests')">VEDI PRs</button>
                    </div>
                    
                    <!-- Search -->
                    <div class="science-tool" style="border-color: rgba(110,84,148,0.3); background: rgba(110,84,148,0.05);">
                        <div class="tool-icon" style="background: linear-gradient(135deg, #6e5494, #8b5cf6);">ðŸ”</div>
                        <div class="tool-name">Cerca su GitHub</div>
                        <div class="tool-desc">Cerca repository, codice, utenti e organizzazioni.</div>
                        <button class="tool-btn" style="background: linear-gradient(135deg, #6e5494, #8b5cf6);" onclick="gitHubAction('search')">CERCA</button>
                    </div>
                </div>
                
                <!-- Quick Actions -->
                <div style="margin-top: 20px; padding: 15px; background: rgba(0,0,0,0.3); border-radius: 10px;">
                    <div style="font-family: 'Orbitron', monospace; color: #8b5cf6; margin-bottom: 10px;">âš¡ AZIONI RAPIDE</div>
                    <div style="display: flex; gap: 10px; flex-wrap: wrap;">
                        <button class="service-btn" style="background: rgba(110,84,148,0.3); border-color: #6e5494;" onclick="askGideonGitHub('Mostrami i miei repository piÃ¹ recenti')">ðŸ“¦ Repos Recenti</button>
                        <button class="service-btn" style="background: rgba(110,84,148,0.3); border-color: #6e5494;" onclick="askGideonGitHub('Quali issues aperte ho?')">ðŸ“‹ Issues Aperte</button>
                        <button class="service-btn" style="background: rgba(110,84,148,0.3); border-color: #6e5494;" onclick="askGideonGitHub('Mostrami le mie organizzazioni GitHub')">ðŸ¢ Organizzazioni</button>
                        <button class="service-btn" style="background: rgba(110,84,148,0.3); border-color: #6e5494;" onclick="askGideonGitHub('Qual Ã¨ il mio rate limit GitHub attuale?')">â±ï¸ Rate Limit</button>
                    </div>
                </div>
                
                <!-- GitHub Results Area -->
                <div id="github-results" style="margin-top: 20px; display: none;">
                    <div style="font-family: 'Orbitron', monospace; color: #8b5cf6; margin-bottom: 10px;">ðŸ“Š RISULTATI</div>
                    <div id="github-results-content" style="background: rgba(0,0,0,0.5); border-radius: 10px; padding: 15px; max-height: 300px; overflow-y: auto; font-family: 'JetBrains Mono', monospace; font-size: 0.85em;"></div>
                </div>
            </div>
        </div>
    </div>
    
    <div class="panel-overlay" id="military-panel">
        <div class="spec-panel">
            <div class="panel-header" style="border-color: var(--military-color);">
                <div class="panel-title" style="color: var(--military-color);">
                    âš”ï¸ DIFESA & INTELLIGENCE
                </div>
                <button class="panel-close" onclick="closePanel('military-panel')">Ã—</button>
            </div>
            <div class="panel-body">
                <div class="science-grid">
                    <div class="science-tool" style="border-color: rgba(255,136,0,0.3); background: rgba(255,136,0,0.05);">
                        <div class="tool-icon military">ðŸ›°ï¸</div>
                        <div class="tool-name">SIGINT Analysis</div>
                        <div class="tool-desc">Analisi segnali, intercettazioni, crittografia avanzata.</div>
                        <button class="tool-btn military" onclick="runMilitaryTool('sigint')">ANALIZZA</button>
                    </div>
                    <div class="science-tool" style="border-color: rgba(255,136,0,0.3); background: rgba(255,136,0,0.05);">
                        <div class="tool-icon military">ðŸŽ¯</div>
                        <div class="tool-name">Tactical AI</div>
                        <div class="tool-desc">Pianificazione tattica, simulazioni di scenario, decision support.</div>
                        <button class="tool-btn military" onclick="runMilitaryTool('tactical')">PIANIFICA</button>
                    </div>
                    <div class="science-tool" style="border-color: rgba(255,136,0,0.3); background: rgba(255,136,0,0.05);">
                        <div class="tool-icon military">ðŸ–¥ï¸</div>
                        <div class="tool-name">Cyber Defense</div>
                        <div class="tool-desc">Protezione infrastrutture, threat hunting, incident response.</div>
                        <button class="tool-btn military" onclick="runMilitaryTool('cyber')">PROTEGGI</button>
                    </div>
                    <div class="science-tool" style="border-color: rgba(255,136,0,0.3); background: rgba(255,136,0,0.05);">
                        <div class="tool-icon military">ðŸ“¡</div>
                        <div class="tool-name">C4ISR</div>
                        <div class="tool-desc">Command & Control, comunicazioni sicure, battlefield awareness.</div>
                        <button class="tool-btn military" onclick="runMilitaryTool('c4isr')">CONNETTI</button>
                    </div>
                    <div class="science-tool" style="border-color: rgba(255,136,0,0.3); background: rgba(255,136,0,0.05);">
                        <div class="tool-icon military">ðŸ—„ï¸</div>
                        <div class="tool-name">Intelligence Fusion</div>
                        <div class="tool-desc">Aggregazione fonti OSINT/HUMINT/IMINT, pattern analysis.</div>
                        <button class="tool-btn military" onclick="runMilitaryTool('intel_fusion')">FUSA</button>
                    </div>
                    <div class="science-tool" style="border-color: rgba(255,136,0,0.3); background: rgba(255,136,0,0.05);">
                        <div class="tool-icon military">ðŸš€</div>
                        <div class="tool-name">Drone Control</div>
                        <div class="tool-desc">Gestione UAV, waypoint planning, video feed, autonomous ops.</div>
                        <button class="tool-btn military" onclick="runMilitaryTool('drone')">CONTROLLA</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Scheduler Panel -->
    <div class="panel-overlay" id="scheduler-panel">
        <div class="spec-panel">
            <div class="panel-header" style="border-color: var(--accent-cyan);">
                <div class="panel-title" style="color: var(--accent-cyan);">
                    ðŸ“… TASK SCHEDULER
                </div>
                <button class="panel-close" onclick="closePanel('scheduler-panel')">Ã—</button>
            </div>
            <div class="panel-body">
                <div class="scheduler-container">
                    <!-- Quick Schedule -->
                    <div class="scheduler-section">
                        <h3 style="color: var(--accent-cyan); margin-bottom: 15px;">âš¡ Quick Schedule</h3>
                        <div class="schedule-form">
                            <input type="text" id="schedule-task" class="schedule-input" placeholder="Descrivi il task da schedulare...">
                            <div class="schedule-time-row">
                                <input type="datetime-local" id="schedule-datetime" class="schedule-input datetime-input">
                                <select id="schedule-repeat" class="schedule-input">
                                    <option value="once">Una volta</option>
                                    <option value="daily">Giornaliero</option>
                                    <option value="weekly">Settimanale</option>
                                    <option value="monthly">Mensile</option>
                                </select>
                            </div>
                            <button class="tool-btn" style="background: linear-gradient(135deg, var(--accent-cyan), var(--accent-blue)); width: 100%;" onclick="scheduleTask()">ðŸ“… SCHEDULA TASK</button>
                        </div>
                    </div>
                    
                    <!-- Scheduled Tasks List -->
                    <div class="scheduler-section">
                        <h3 style="color: var(--accent-cyan); margin-bottom: 15px;">ðŸ“‹ Task Programmati</h3>
                        <div id="scheduled-tasks-list" class="scheduled-tasks">
                            <div class="empty-scheduler">Nessun task programmato</div>
                        </div>
                    </div>
                    
                    <!-- Automation Rules -->
                    <div class="scheduler-section">
                        <h3 style="color: var(--accent-cyan); margin-bottom: 15px;">ðŸ¤– Automazioni</h3>
                        <div class="automation-grid">
                            <div class="automation-card" onclick="toggleAutomation('daily-report')">
                                <div class="automation-icon">ðŸ“Š</div>
                                <div class="automation-name">Daily Report</div>
                                <div class="automation-status" id="auto-daily-report">OFF</div>
                            </div>
                            <div class="automation-card" onclick="toggleAutomation('backup')">
                                <div class="automation-icon">ðŸ’¾</div>
                                <div class="automation-name">Auto Backup</div>
                                <div class="automation-status" id="auto-backup">OFF</div>
                            </div>
                            <div class="automation-card" onclick="toggleAutomation('monitor')">
                                <div class="automation-icon">ðŸ”</div>
                                <div class="automation-name">System Monitor</div>
                                <div class="automation-status" id="auto-monitor">ON</div>
                            </div>
                            <div class="automation-card" onclick="toggleAutomation('cleanup')">
                                <div class="automation-icon">ðŸ§¹</div>
                                <div class="automation-name">Auto Cleanup</div>
                                <div class="automation-status" id="auto-cleanup">OFF</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- CAM Panel - Crisis Automation Mode -->
    <div class="panel-overlay" id="cam-panel">
        <div class="spec-panel cam-panel-special">
            <div class="panel-header" style="border-color: #ff3366;">
                <div class="panel-title" style="color: #ff3366;">
                    ðŸŽ¯ CRISIS AUTOMATION MODE (CAM)
                </div>
                <button class="panel-close" onclick="closePanel('cam-panel')">Ã—</button>
            </div>
            <div class="panel-body">
                <!-- CAM Status Dashboard -->
                <div class="cam-dashboard">
                    <div class="cam-status-card" id="cam-main-status">
                        <div class="cam-status-header">
                            <span class="cam-status-icon">ðŸŸ¢</span>
                            <span class="cam-status-text">MONITORING</span>
                        </div>
                        <div class="cam-status-details">
                            <div class="cam-detail-row">
                                <span>Crisis Level:</span>
                                <span id="cam-crisis-level" class="cam-value">NONE</span>
                            </div>
                            <div class="cam-detail-row">
                                <span>Autonomy:</span>
                                <span id="cam-autonomy" class="cam-value">100%</span>
                            </div>
                            <div class="cam-detail-row">
                                <span>Control State:</span>
                                <span id="cam-control-state" class="cam-value">NORMAL</span>
                            </div>
                        </div>
                    </div>
                    
                    <!-- CAM Philosophy -->
                    <div class="cam-philosophy">
                        <div class="philosophy-item">ðŸ’¡ Explain > Act</div>
                        <div class="philosophy-item">ðŸ¢ Slow is Smooth, Smooth is Fast</div>
                        <div class="philosophy-item">â“ Uncertainty is a Signal</div>
                        <div class="philosophy-item">ðŸ‘¤ Human-in-the-Loop sempre</div>
                        <div class="philosophy-item">ðŸ›¡ï¸ Safe-State > Wrong-State</div>
                    </div>
                </div>
                
                <!-- CAM 6 Layers -->
                <div class="cam-layers-grid">
                    <div class="cam-layer-card" onclick="showCAMLayer('detection')">
                        <div class="layer-icon">ðŸ”</div>
                        <div class="layer-name">DETECTION</div>
                        <div class="layer-desc">"Siamo in crisi?"</div>
                        <div class="layer-status" id="layer-detection-status">Active</div>
                    </div>
                    
                    <div class="cam-layer-card" onclick="showCAMLayer('control')">
                        <div class="layer-icon">âš™ï¸</div>
                        <div class="layer-name">CONTROL</div>
                        <div class="layer-desc">Governa la potenza</div>
                        <div class="layer-status" id="layer-control-status">Active</div>
                    </div>
                    
                    <div class="cam-layer-card" onclick="showCAMLayer('reasoning')">
                        <div class="layer-icon">ðŸ§ </div>
                        <div class="layer-name">REASONING</div>
                        <div class="layer-desc">Multi-path analysis</div>
                        <div class="layer-status" id="layer-reasoning-status">Ready</div>
                    </div>
                    
                    <div class="cam-layer-card" onclick="showCAMLayer('automation')">
                        <div class="layer-icon">ðŸ¤–</div>
                        <div class="layer-name">AUTOMATION</div>
                        <div class="layer-desc">Automazioni intelligenti</div>
                        <div class="layer-status" id="layer-automation-status">Ready</div>
                    </div>
                    
                    <div class="cam-layer-card" onclick="showCAMLayer('human')">
                        <div class="layer-icon">ðŸ‘¤</div>
                        <div class="layer-name">HUMAN INTERFACE</div>
                        <div class="layer-desc">Anti-panico UI</div>
                        <div class="layer-status" id="layer-human-status">Active</div>
                    </div>
                    
                    <div class="cam-layer-card" onclick="showCAMLayer('recovery')">
                        <div class="layer-icon">ðŸ”„</div>
                        <div class="layer-name">RECOVERY</div>
                        <div class="layer-desc">Post-crisi & lessons</div>
                        <div class="layer-status" id="layer-recovery-status">Standby</div>
                    </div>
                </div>
                
                <!-- CAM Rules -->
                <div class="cam-rules">
                    <div class="cam-rule good">âœ… Sempre audit trail</div>
                    <div class="cam-rule good">âœ… Sempre possibilitÃ  di STOP</div>
                    <div class="cam-rule bad">âŒ No decisioni irreversibili auto</div>
                    <div class="cam-rule bad">âŒ No azioni senza spiegazione</div>
                    <div class="cam-rule bad">âŒ No escalation senza consenso</div>
                </div>
                
                <!-- Quick Actions -->
                <div class="cam-actions">
                    <button class="cam-action-btn emergency" onclick="triggerEmergencyStop()">
                        ðŸ›‘ EMERGENCY STOP
                    </button>
                    <button class="cam-action-btn" onclick="resumeCAMOperations()" style="background: rgba(0,255,136,0.1); border-color: rgba(0,255,136,0.3); color: var(--neon-green);">
                        â–¶ï¸ Resume
                    </button>
                    <button class="cam-action-btn" onclick="refreshCAMStatus()">
                        ðŸ”„ Refresh
                    </button>
                    <button class="cam-action-btn" onclick="viewCAMAuditLog()">
                        ðŸ“‹ Audit Log
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Debug Panel -->
    <div class="debug-panel" id="debug-panel">
        <div class="debug-header">
            <div class="debug-title">
                <span>ðŸ›</span>
                <span>GIDEON DEBUG CONSOLE</span>
                <span style="font-size: 0.8em; color: rgba(255,255,255,0.5);">v4.0</span>
            </div>
            <div class="debug-tabs">
                <button class="debug-tab active" onclick="switchDebugTab('console')" data-tab="console">Console</button>
                <button class="debug-tab" onclick="switchDebugTab('network')" data-tab="network">Network</button>
                <button class="debug-tab" onclick="switchDebugTab('state')" data-tab="state">State</button>
                <button class="debug-tab" onclick="switchDebugTab('performance')" data-tab="performance">Performance</button>
            </div>
            <div class="debug-actions">
                <button class="debug-action-btn" onclick="exportDebugLogs()">ðŸ“¥ Export</button>
                <button class="debug-action-btn danger" onclick="clearDebugLogs()">ðŸ—‘ï¸ Clear</button>
                <button class="debug-action-btn" onclick="toggleDebugMode()">âœ• Chiudi</button>
            </div>
        </div>
        <div class="debug-body">
            <div class="debug-content" id="debug-content">
                <!-- Console logs will appear here -->
            </div>
            <div class="debug-sidebar">
                <div style="font-weight: 600; margin-bottom: 15px; color: var(--neon-orange);">ðŸ“Š SYSTEM STATS</div>
                <div class="debug-stat">
                    <span class="debug-stat-label">Backend</span>
                    <span class="debug-stat-value" id="debug-backend-status">Checking...</span>
                </div>
                <div class="debug-stat">
                    <span class="debug-stat-label">API Calls</span>
                    <span class="debug-stat-value" id="debug-api-calls">0</span>
                </div>
                <div class="debug-stat">
                    <span class="debug-stat-label">Messages</span>
                    <span class="debug-stat-value" id="debug-messages">0</span>
                </div>
                <div class="debug-stat">
                    <span class="debug-stat-label">Errors</span>
                    <span class="debug-stat-value" id="debug-errors" style="color: var(--neon-red);">0</span>
                </div>
                <div class="debug-stat">
                    <span class="debug-stat-label">TTS Enabled</span>
                    <span class="debug-stat-value" id="debug-tts">Yes</span>
                </div>
                <div class="debug-stat">
                    <span class="debug-stat-label">Mode</span>
                    <span class="debug-stat-value" id="debug-mode">COPILOT</span>
                </div>
                <div class="debug-stat">
                    <span class="debug-stat-label">Memory</span>
                    <span class="debug-stat-value" id="debug-memory">-</span>
                </div>
                <div class="debug-stat">
                    <span class="debug-stat-label">Uptime</span>
                    <span class="debug-stat-value" id="debug-uptime">0s</span>
                </div>
                <div style="margin-top: 20px; padding-top: 15px; border-top: 1px solid rgba(255,255,255,0.1);">
                    <div style="font-weight: 600; margin-bottom: 10px; color: var(--neon-cyan);">âš¡ QUICK ACTIONS</div>
                    <button class="debug-action-btn" style="width: 100%; margin-bottom: 8px;" onclick="debugTestBackend()">Test Backend</button>
                    <button class="debug-action-btn" style="width: 100%; margin-bottom: 8px;" onclick="debugTestTTS()">Test TTS</button>
                    <button class="debug-action-btn" style="width: 100%; margin-bottom: 8px;" onclick="debugShowState()">Show State</button>
                    <button class="debug-action-btn" style="width: 100%;" onclick="debugReloadPage()">Reload Page</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Automation Toggle Button -->
    <button class="automation-toggle-btn" id="automation-toggle" onclick="toggleAutomationPanel()" title="Apri Automazioni">âš™ï¸</button>

    <!-- Automation Panel -->
    <div class="automation-panel" id="automation-panel">
        <div class="panel-header">
            <h3>ðŸ¤– AUTOMAZIONI</h3>
            <button class="close-panel-btn" onclick="toggleAutomationPanel()">âœ•</button>
        </div>
        <div class="panel-content">
            <!-- System Controls -->
            <div class="panel-section">
                <h4>ðŸ’» Sistema</h4>
                <div class="panel-buttons">
                    <button class="panel-btn" onclick="executeAction('lock')">ðŸ”’ Blocca</button>
                    <button class="panel-btn" onclick="executeAction('sleep')">ðŸ˜´ Sospendi</button>
                    <button class="panel-btn" onclick="executeAction('restart', {delay: 60})">ðŸ”„ Riavvia</button>
                    <button class="panel-btn" onclick="executeAction('shutdown', {delay: 60})">â» Spegni</button>
                </div>
            </div>
            
            <!-- Audio Controls -->
            <div class="panel-section">
                <h4>ðŸ”Š Audio</h4>
                <div class="panel-buttons">
                    <button class="panel-btn" onclick="executeAction('set_volume', {level: 0})">ðŸ”‡ Muto</button>
                    <button class="panel-btn" onclick="executeAction('set_volume', {level: 25})">ðŸ”ˆ 25%</button>
                    <button class="panel-btn" onclick="executeAction('set_volume', {level: 50})">ðŸ”‰ 50%</button>
                    <button class="panel-btn" onclick="executeAction('set_volume', {level: 100})">ðŸ”Š 100%</button>
                </div>
            </div>
            
            <!-- Apps -->
            <div class="panel-section">
                <h4>ðŸ“± Applicazioni</h4>
                <div class="panel-buttons">
                    <button class="panel-btn" onclick="executeAction('open_app', {name: 'notepad'})">ðŸ“ Notepad</button>
                    <button class="panel-btn" onclick="executeAction('open_app', {name: 'calculator'})">ðŸ§® Calcolatrice</button>
                    <button class="panel-btn" onclick="executeAction('open_app', {name: 'explorer'})">ðŸ“ Explorer</button>
                    <button class="panel-btn" onclick="executeAction('open_app', {name: 'cmd'})">âŒ¨ï¸ CMD</button>
                    <button class="panel-btn" onclick="executeAction('open_app', {name: 'powershell'})">ðŸ’  PowerShell</button>
                    <button class="panel-btn" onclick="executeAction('open_app', {name: 'vscode'})">ðŸ”· VS Code</button>
                </div>
            </div>
            
            <!-- Web -->
            <div class="panel-section">
                <h4>ðŸŒ Web</h4>
                <div class="panel-buttons">
                    <button class="panel-btn" onclick="executeAction('open_url', {url: 'https://google.com'})">ðŸ” Google</button>
                    <button class="panel-btn" onclick="executeAction('open_url', {url: 'https://youtube.com'})">â–¶ï¸ YouTube</button>
                    <button class="panel-btn" onclick="executeAction('open_url', {url: 'https://github.com'})">ðŸ™ GitHub</button>
                    <button class="panel-btn" onclick="executeAction('open_url', {url: 'https://chat.openai.com'})">ðŸ¤– ChatGPT</button>
                    <button class="panel-btn" onclick="executeAction('open_url', {url: 'https://claude.ai'})">ðŸ§  Claude</button>
                    <button class="panel-btn" onclick="executeAction('open_url', {url: 'https://twitter.com'})">ðŸ¦ Twitter</button>
                </div>
            </div>
            
            <!-- Processes -->
            <div class="panel-section">
                <h4>âš™ï¸ Processi</h4>
                <div class="panel-buttons">
                    <button class="panel-btn" onclick="showProcesses()">ðŸ“‹ Lista Processi</button>
                    <button class="panel-btn" onclick="showWindows()">ðŸªŸ Finestre Aperte</button>
                    <button class="panel-btn" onclick="showSystemInfo()">ðŸ“Š Info Sistema</button>
                    <button class="panel-btn" onclick="showResourceUsage()">ðŸ“ˆ Risorse</button>
                </div>
            </div>
            
            <!-- AI Hub -->
            <div class="panel-section ai-section">
                <h4>ðŸš€ AI Hub</h4>
                <div class="panel-buttons">
                    <button class="panel-btn ai-btn" onclick="openAIHub('image')">ðŸŽ¨ Genera Immagine</button>
                    <button class="panel-btn ai-btn" onclick="openAIHub('video')">ðŸŽ¬ Genera Video</button>
                    <button class="panel-btn ai-btn" onclick="openAIHub('music')">ðŸŽµ Genera Musica</button>
                    <button class="panel-btn ai-btn" onclick="openAIHub('presentation')">ðŸ“Š Crea Slide</button>
                    <button class="panel-btn ai-btn" onclick="openAIHub('podcast')">ðŸŽ™ï¸ Crea Podcast</button>
                    <button class="panel-btn ai-btn" onclick="openAIHub('code')">ðŸ’» Genera Codice</button>
                </div>
            </div>
            
            <!-- Video AI -->
            <div class="panel-section ai-section">
                <h4>ðŸ”¥ Video AI</h4>
                <div class="panel-buttons">
                    <button class="panel-btn ai-btn" onclick="openAIHub('veo')">ðŸ“¹ Veo 3.1</button>
                    <button class="panel-btn ai-btn" onclick="openAIHub('sora')">ðŸŽ¥ Sora 2</button>
                    <button class="panel-btn ai-btn" onclick="openAIHub('kling')">ðŸŽ¬ Kling AI</button>
                    <button class="panel-btn ai-btn" onclick="openAIHub('heygen')">ðŸ§‘â€ðŸ’¼ HeyGen</button>
                    <button class="panel-btn ai-btn" onclick="openAIHub('luma')">âœ¨ Luma Dream</button>
                    <button class="panel-btn ai-btn" onclick="openAIHub('pika')">ðŸŽžï¸ Pika Labs</button>
                </div>
            </div>
            
            <!-- Image AI -->
            <div class="panel-section ai-section">
                <h4>ðŸ–¼ï¸ Image AI</h4>
                <div class="panel-buttons">
                    <button class="panel-btn ai-btn" onclick="openAIHub('dalle')">ðŸ–Œï¸ DALL-E 3</button>
                    <button class="panel-btn ai-btn" onclick="openAIHub('midjourney')">ðŸŽ¨ Midjourney</button>
                    <button class="panel-btn ai-btn" onclick="openAIHub('flux')">âš¡ Flux AI</button>
                    <button class="panel-btn ai-btn" onclick="openAIHub('stable')">ðŸŒŠ Stable Diff</button>
                </div>
            </div>
            
            <!-- Emergency -->
            <div class="panel-section emergency-section">
                <h4>ðŸš¨ Emergenza</h4>
                <div class="panel-buttons">
                    <button class="panel-btn emergency-btn" onclick="emergencyAction('kill')">â›” KILL SWITCH</button>
                    <button class="panel-btn emergency-btn" onclick="emergencyAction('safe_mode')">ðŸ›¡ï¸ SAFE MODE</button>
                    <button class="panel-btn emergency-btn" onclick="emergencyAction('lockdown')">ðŸ” LOCKDOWN</button>
                    <button class="panel-btn success-btn" onclick="emergencyAction('resume')">âœ… RIPRENDI</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Pilot Authorization Dialog -->
    <div class="pilot-dialog-overlay" id="pilot-dialog">
        <div class="pilot-dialog">
            <div class="pilot-dialog-header">
                <h3>ðŸš€ MODALITÃ€ PILOT</h3>
                <p>Richiesta autorizzazione per controllo autonomo</p>
            </div>
            <div class="pilot-dialog-content">
                <div class="warning-box">
                    <span class="warning-icon">âš ï¸</span>
                    <p>GIDEON richiede l'autorizzazione per eseguire azioni autonome sul sistema. Inserisci il codice di autorizzazione.</p>
                </div>
                <div class="auth-input-group">
                    <label>Codice Autorizzazione:</label>
                    <input type="password" id="pilot-auth-code" placeholder="Inserisci codice..." onkeypress="if(event.key==='Enter')confirmPilotMode()">
                </div>
                <div class="pilot-permissions">
                    <h4>Permessi richiesti:</h4>
                    <ul>
                        <li>âœ“ Esecuzione comandi sistema</li>
                        <li>âœ“ Apertura applicazioni</li>
                        <li>âœ“ Navigazione web</li>
                        <li>âœ“ Gestione file</li>
                        <li>âœ“ Automazioni avanzate</li>
                    </ul>
                </div>
                <div class="hint-box">
                    <span>ðŸ’¡</span> Hint: Il codice predefinito Ã¨ "gideon" o "pilot"
                </div>
            </div>
            <div class="pilot-dialog-actions">
                <button class="pilot-btn cancel" onclick="closePilotDialog()">âŒ Annulla</button>
                <button class="pilot-btn confirm" onclick="confirmPilotMode()">âœ… Autorizza</button>
            </div>
        </div>
    </div>

    <script>
        // ============ CONFIGURATION ============
        const API_BASE = 'http://127.0.0.1:8001';
        
        // ============ DEBUG SYSTEM ============
        const debugState = {
            isActive: false,
            logs: [],
            apiCalls: 0,
            errors: 0,
            currentTab: 'console',
            startTime: Date.now()
        };
        
        // Override console methods to capture logs
        const originalConsole = {
            log: console.log,
            warn: console.warn,
            error: console.error,
            info: console.info
        };
        
        console.log = function(...args) {
            originalConsole.log.apply(console, args);
            debugLog('info', args.join(' '));
        };
        
        console.warn = function(...args) {
            originalConsole.warn.apply(console, args);
            debugLog('warn', args.join(' '));
        };
        
        console.error = function(...args) {
            originalConsole.error.apply(console, args);
            debugLog('error', args.join(' '));
            debugState.errors++;
            updateDebugStats();
        };
        
        console.info = function(...args) {
            originalConsole.info.apply(console, args);
            debugLog('info', args.join(' '));
        };
        
        function debugLog(type, message) {
            const timestamp = new Date().toLocaleTimeString();
            const logEntry = { type, message, timestamp };
            debugState.logs.push(logEntry);
            
            // Keep only last 500 logs
            if (debugState.logs.length > 500) {
                debugState.logs.shift();
            }
            
            if (debugState.isActive && debugState.currentTab === 'console') {
                appendDebugLog(logEntry);
            }
        }
        
        function appendDebugLog(entry) {
            const content = document.getElementById('debug-content');
            if (!content) return;
            
            const div = document.createElement('div');
            div.className = `log-entry ${entry.type}`;
            div.innerHTML = `<span class="log-time">[${entry.timestamp}]</span>${escapeHtml(entry.message)}`;
            content.appendChild(div);
            content.scrollTop = content.scrollHeight;
        }
        
        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }
        
        function toggleDebugMode() {
            debugState.isActive = !debugState.isActive;
            const panel = document.getElementById('debug-panel');
            const btn = document.getElementById('debug-toggle');
            
            if (debugState.isActive) {
                panel.classList.add('active');
                btn.classList.add('active');
                refreshDebugContent();
                updateDebugStats();
                debugLog('success', 'ðŸ› Debug mode ATTIVATO');
            } else {
                panel.classList.remove('active');
                btn.classList.remove('active');
                debugLog('info', 'ðŸ› Debug mode DISATTIVATO');
            }
        }
        
        function switchDebugTab(tab) {
            debugState.currentTab = tab;
            
            // Update tab buttons
            document.querySelectorAll('.debug-tab').forEach(t => {
                t.classList.toggle('active', t.dataset.tab === tab);
            });
            
            refreshDebugContent();
        }
        
        function refreshDebugContent() {
            const content = document.getElementById('debug-content');
            if (!content) return;
            
            content.innerHTML = '';
            
            switch(debugState.currentTab) {
                case 'console':
                    debugState.logs.forEach(entry => appendDebugLog(entry));
                    break;
                    
                case 'network':
                    content.innerHTML = `
                        <div style="color: var(--neon-cyan); margin-bottom: 15px;">ðŸ“¡ NETWORK REQUESTS</div>
                        <div class="log-entry info">API Base: ${API_BASE}</div>
                        <div class="log-entry info">Total API Calls: ${debugState.apiCalls}</div>
                        <div style="margin-top: 20px; color: var(--neon-yellow);">Recent Endpoints:</div>
                        <div class="log-entry info">/api/chat/send</div>
                        <div class="log-entry info">/api/tts/speak</div>
                        <div class="log-entry info">/api/gideon/health</div>
                        <div class="log-entry info">/api/hub/services</div>
                        <div class="log-entry info">/api/github/status</div>
                    `;
                    break;
                    
                case 'state':
                    content.innerHTML = `
                        <div style="color: var(--neon-cyan); margin-bottom: 15px;">ðŸ“Š APPLICATION STATE</div>
                        <pre style="color: var(--neon-green); background: rgba(0,0,0,0.3); padding: 15px; border-radius: 8px; overflow: auto;">
${JSON.stringify(state, null, 2)}
                        </pre>
                    `;
                    break;
                    
                case 'performance':
                    const memory = performance.memory ? `${Math.round(performance.memory.usedJSHeapSize / 1048576)}MB` : 'N/A';
                    const timing = performance.timing;
                    const loadTime = timing.loadEventEnd - timing.navigationStart;
                    
                    content.innerHTML = `
                        <div style="color: var(--neon-cyan); margin-bottom: 15px;">âš¡ PERFORMANCE METRICS</div>
                        <div class="log-entry info">Page Load Time: ${loadTime}ms</div>
                        <div class="log-entry info">Memory Usage: ${memory}</div>
                        <div class="log-entry info">DOM Elements: ${document.querySelectorAll('*').length}</div>
                        <div class="log-entry info">Event Listeners: ~${getEventListenerCount()}</div>
                        <div style="margin-top: 20px; color: var(--neon-yellow);">Timing Breakdown:</div>
                        <div class="log-entry info">DNS Lookup: ${timing.domainLookupEnd - timing.domainLookupStart}ms</div>
                        <div class="log-entry info">Connection: ${timing.connectEnd - timing.connectStart}ms</div>
                        <div class="log-entry info">DOM Ready: ${timing.domContentLoadedEventEnd - timing.navigationStart}ms</div>
                    `;
                    break;
            }
        }
        
        function getEventListenerCount() {
            // Estimate based on common elements
            return document.querySelectorAll('button, input, [onclick]').length * 2;
        }
        
        function updateDebugStats() {
            const backendStatus = document.getElementById('debug-backend-status');
            const apiCalls = document.getElementById('debug-api-calls');
            const messages = document.getElementById('debug-messages');
            const errors = document.getElementById('debug-errors');
            const tts = document.getElementById('debug-tts');
            const mode = document.getElementById('debug-mode');
            const memory = document.getElementById('debug-memory');
            const uptime = document.getElementById('debug-uptime');
            
            if (apiCalls) apiCalls.textContent = debugState.apiCalls;
            if (messages) messages.textContent = state.messages ? state.messages.length : 0;
            if (errors) errors.textContent = debugState.errors;
            if (tts) tts.textContent = state.isTTSEnabled ? 'Yes' : 'No';
            if (mode) mode.textContent = state.currentMode ? state.currentMode.toUpperCase() : 'COPILOT';
            
            if (memory && performance.memory) {
                memory.textContent = Math.round(performance.memory.usedJSHeapSize / 1048576) + 'MB';
            }
            
            if (uptime) {
                const seconds = Math.floor((Date.now() - debugState.startTime) / 1000);
                const mins = Math.floor(seconds / 60);
                const secs = seconds % 60;
                uptime.textContent = `${mins}m ${secs}s`;
            }
            
            // Check backend status
            if (backendStatus) {
                fetch(`${API_BASE}/api/gideon/health`, { method: 'GET' })
                    .then(r => {
                        backendStatus.textContent = 'âœ… Online';
                        backendStatus.style.color = 'var(--neon-green)';
                    })
                    .catch(e => {
                        backendStatus.textContent = 'âŒ Offline';
                        backendStatus.style.color = 'var(--neon-red)';
                    });
            }
        }
        
        function clearDebugLogs() {
            debugState.logs = [];
            debugState.errors = 0;
            debugState.apiCalls = 0;
            refreshDebugContent();
            updateDebugStats();
            debugLog('success', 'ðŸ—‘ï¸ Logs cleared');
        }
        
        function exportDebugLogs() {
            const data = {
                timestamp: new Date().toISOString(),
                logs: debugState.logs,
                state: state,
                stats: {
                    apiCalls: debugState.apiCalls,
                    errors: debugState.errors,
                    uptime: Date.now() - debugState.startTime
                }
            };
            
            const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `gideon_debug_${Date.now()}.json`;
            a.click();
            URL.revokeObjectURL(url);
            
            debugLog('success', 'ðŸ“¥ Debug logs esportati');
        }
        
        async function debugTestBackend() {
            debugLog('info', 'ðŸ” Testing backend connection...');
            try {
                const response = await fetch(`${API_BASE}/api/gideon/health`);
                const data = await response.json();
                debugLog('success', `âœ… Backend OK: ${JSON.stringify(data)}`);
            } catch (error) {
                debugLog('error', `âŒ Backend error: ${error.message}`);
            }
        }
        
        async function debugTestTTS() {
            debugLog('info', 'ðŸ”Š Testing TTS...');
            try {
                await speak("Test del sistema text to speech di Gideon.");
                debugLog('success', 'âœ… TTS test completato');
            } catch (error) {
                debugLog('error', `âŒ TTS error: ${error.message}`);
            }
        }
        
        function debugShowState() {
            debugLog('info', 'ðŸ“Š Current State:');
            debugLog('info', JSON.stringify(state, null, 2));
        }
        
        function debugReloadPage() {
            debugLog('info', 'ðŸ”„ Reloading page...');
            setTimeout(() => location.reload(), 500);
        }
        
        // ============ AUTOMATION PANEL ============
        function toggleAutomationPanel() {
            const panel = document.getElementById('automation-panel');
            const btn = document.getElementById('automation-toggle');
            if (panel) {
                panel.classList.toggle('active');
                if (btn) {
                    btn.textContent = panel.classList.contains('active') ? 'âœ•' : 'âš™ï¸';
                }
                debugLog('info', `ðŸ¤– Automation Panel: ${panel.classList.contains('active') ? 'aperto' : 'chiuso'}`);
            }
        }
        
        async function executeAction(action, params = {}) {
            debugLog('info', `âš¡ Executing action: ${action}`);
            try {
                const response = await fetch(`${API_BASE}/api/action`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ action, params })
                });
                const result = await response.json();
                if (result.success) {
                    debugLog('info', `âœ“ Action ${action} completed`);
                    addLog(`[ACTION] âœ“ ${action} eseguito`);
                } else {
                    debugLog('warn', `âœ— Action ${action} failed: ${result.error}`);
                    addLog(`[ACTION] âœ— ${action} fallito: ${result.error}`);
                }
                return result;
            } catch (err) {
                debugLog('error', `Action error: ${err.message}`);
                addLog(`[ACTION] Errore: ${err.message}`);
                return { success: false, error: err.message };
            }
        }
        
        async function showProcesses() {
            const input = document.getElementById('chat-input');
            if (input) {
                input.value = 'Mostra i processi attivi del sistema';
                sendMessage();
            }
        }
        
        async function showWindows() {
            const input = document.getElementById('chat-input');
            if (input) {
                input.value = 'Elenca le finestre aperte';
                sendMessage();
            }
        }
        
        async function showSystemInfo() {
            const input = document.getElementById('chat-input');
            if (input) {
                input.value = 'Mostra le informazioni del sistema';
                sendMessage();
            }
        }
        
        async function showResourceUsage() {
            const input = document.getElementById('chat-input');
            if (input) {
                input.value = 'Mostra utilizzo CPU, RAM e disco';
                sendMessage();
            }
        }
        
        function openAIHub(service) {
            debugLog('info', `ðŸš€ Opening AI Hub: ${service}`);
            const urls = {
                'image': 'https://openai.com/dall-e-3',
                'video': 'https://openai.com/sora',
                'music': 'https://www.suno.ai',
                'presentation': 'https://gamma.app',
                'podcast': 'https://notebooklm.google.com',
                'code': 'https://github.com/features/copilot',
                'veo': 'https://deepmind.google/technologies/veo/',
                'sora': 'https://openai.com/sora',
                'kling': 'https://klingai.com',
                'heygen': 'https://heygen.com',
                'luma': 'https://lumalabs.ai/dream-machine',
                'pika': 'https://pika.art',
                'dalle': 'https://openai.com/dall-e-3',
                'midjourney': 'https://midjourney.com',
                'flux': 'https://flux.ai',
                'stable': 'https://stability.ai'
            };
            const url = urls[service] || `https://google.com/search?q=${service}+AI`;
            window.open(url, '_blank');
            addLog(`[AI HUB] Aperto: ${service}`);
        }
        
        async function emergencyAction(action) {
            debugLog('warn', `ðŸš¨ Emergency action: ${action}`);
            addLog(`[EMERGENCY] ${action.toUpperCase()}`);
            
            try {
                const response = await fetch(`${API_BASE}/api/emergency/${action}`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' }
                });
                const result = await response.json();
                if (result.success) {
                    if (action === 'kill') {
                        addMessage('â›” KILL SWITCH ATTIVATO - Tutte le operazioni fermate', 'system');
                    } else if (action === 'safe_mode') {
                        addMessage('ðŸ›¡ï¸ SAFE MODE ATTIVATO - Solo operazioni sicure', 'system');
                    } else if (action === 'lockdown') {
                        addMessage('ðŸ” LOCKDOWN ATTIVATO - Sistema bloccato', 'system');
                    } else if (action === 'resume') {
                        addMessage('âœ… Sistema ripristinato - Operazioni normali', 'system');
                    }
                }
            } catch (err) {
                debugLog('error', `Emergency action error: ${err.message}`);
            }
        }
        
        // ============ IMAGE FUNCTIONS ============
        let selectedImageData = null;
        
        function handleImageUpload(event) {
            const file = event.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    selectedImageData = e.target.result;
                    showImagePreview(selectedImageData);
                };
                reader.readAsDataURL(file);
                debugLog('info', 'ðŸ“· Image loaded: ' + file.name);
            }
        }
        
        function showImagePreview(imageData) {
            const container = document.getElementById('image-preview-container');
            const preview = document.getElementById('image-preview');
            if (container && preview) {
                preview.src = imageData;
                container.style.display = 'block';
                document.getElementById('image-question')?.focus();
            }
        }
        
        function removeImagePreview() {
            selectedImageData = null;
            const container = document.getElementById('image-preview-container');
            const upload = document.getElementById('image-upload');
            if (container) container.style.display = 'none';
            if (upload) upload.value = '';
        }
        
        async function sendImageQuestion() {
            const questionInput = document.getElementById('image-question');
            const question = questionInput?.value.trim() || 'Cosa vedi in questa immagine?';
            
            if (!selectedImageData) {
                addMessage('âš ï¸ Nessuna immagine selezionata', 'system');
                return;
            }
            
            addMessage(`ðŸ“· [Immagine] ${question}`, 'user');
            showTyping(true);
            
            try {
                // Extract base64 data
                const base64Data = selectedImageData.split(',')[1];
                
                const response = await fetch(`${API_BASE}/api/smart/vision/analyze`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        image_base64: base64Data,
                        question: question
                    })
                });
                
                const result = await response.json();
                showTyping(false);
                
                if (result.success) {
                    addMessage(result.description || result.analysis, 'gideon');
                    if (state.isTTSEnabled) {
                        speak(result.description || result.analysis);
                    }
                } else {
                    addMessage('âŒ Errore nell\'analisi: ' + (result.error || 'Sconosciuto'), 'system');
                }
                
                removeImagePreview();
            } catch (err) {
                showTyping(false);
                addMessage('âŒ Errore di connessione: ' + err.message, 'system');
                debugLog('error', 'Image analysis error: ' + err.message);
            }
        }
        
        async function captureScreenshot() {
            addMessage('ðŸ“¸ Acquisizione screenshot...', 'system');
            showTyping(true);
            
            try {
                const response = await fetch(`${API_BASE}/api/smart/vision/screenshot`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ question: 'Descrivi cosa vedi sullo schermo' })
                });
                
                const result = await response.json();
                showTyping(false);
                
                if (result.success) {
                    addMessage(`ðŸ–¼ï¸ Screenshot analizzato:\n${result.description || result.analysis}`, 'gideon');
                    if (state.isTTSEnabled) {
                        speak(result.description || result.analysis);
                    }
                } else {
                    addMessage('âŒ Errore screenshot: ' + (result.error || 'Sconosciuto'), 'system');
                }
            } catch (err) {
                showTyping(false);
                addMessage('âŒ Errore: ' + err.message, 'system');
                debugLog('error', 'Screenshot error: ' + err.message);
            }
        }
        
        // ============ PILOT MODE DIALOG ============
        let pilotModeCallback = null;
        
        function showPilotDialog(callback) {
            pilotModeCallback = callback;
            const dialog = document.getElementById('pilot-dialog');
            const input = document.getElementById('pilot-auth-code');
            if (dialog) {
                dialog.classList.add('active');
                if (input) {
                    input.value = '';
                    setTimeout(() => input.focus(), 100);
                }
                debugLog('info', 'ðŸš€ Pilot Dialog aperto');
            }
        }
        
        function closePilotDialog() {
            const dialog = document.getElementById('pilot-dialog');
            if (dialog) {
                dialog.classList.remove('active');
                pilotModeCallback = null;
                debugLog('info', 'ðŸš€ Pilot Dialog chiuso');
            }
        }
        
        function confirmPilotMode() {
            const input = document.getElementById('pilot-auth-code');
            const code = input?.value?.trim().toLowerCase();
            
            // Accept "gideon", "pilot", "admin", or empty (for ease of use)
            const validCodes = ['gideon', 'pilot', 'admin', ''];
            
            if (validCodes.includes(code)) {
                state.isPilotMode = true;
                closePilotDialog();
                addMessage('ðŸš€ MODALITÃ€ PILOT ATTIVATA - Controllo autonomo autorizzato', 'system');
                debugLog('info', 'ðŸš€ Pilot Mode AUTORIZZATO');
                
                // Update UI to show pilot mode is active
                const indicator = document.querySelector('.status-indicator');
                if (indicator) {
                    indicator.style.background = 'linear-gradient(135deg, #ff6b6b, #ffa500)';
                    indicator.title = 'PILOT MODE ATTIVO';
                }
                
                // Execute callback if provided
                if (pilotModeCallback && typeof pilotModeCallback === 'function') {
                    pilotModeCallback();
                    pilotModeCallback = null;
                }
            } else {
                addMessage('âŒ Codice autorizzazione non valido', 'system');
                debugLog('warn', 'ðŸš€ Pilot Mode RIFIUTATO - codice invalido');
                if (input) {
                    input.value = '';
                    input.focus();
                    input.style.borderColor = '#ff4444';
                    setTimeout(() => { input.style.borderColor = ''; }, 2000);
                }
            }
        }
        
        function deactivatePilotMode() {
            state.isPilotMode = false;
            addMessage('ðŸ”’ ModalitÃ  PILOT disattivata - Ritorno a modalitÃ  standard', 'system');
            debugLog('info', 'ðŸ”’ Pilot Mode disattivato');
            
            const indicator = document.querySelector('.status-indicator');
            if (indicator) {
                indicator.style.background = '';
                indicator.title = '';
            }
        }
        
        // ============ CAMERA FUNCTIONS ============
        async function openCamera() {
            addMessage('ðŸ“¸ Apertura fotocamera... Vedrai l\'anteprima in tempo reale!', 'system');
            
            try {
                // Request camera access with higher resolution
                const stream = await navigator.mediaDevices.getUserMedia({ 
                    video: { 
                        facingMode: 'user',
                        width: { ideal: 1280 },
                        height: { ideal: 720 }
                    } 
                });
                
                // Create video element for capture
                const video = document.createElement('video');
                video.srcObject = stream;
                video.autoplay = true;
                video.playsInline = true;
                video.muted = true;
                
                // Create modal for camera preview
                const modal = document.createElement('div');
                modal.id = 'camera-modal';
                modal.innerHTML = `
                    <div class="camera-modal-content">
                        <h3>ðŸ“¸ Anteprima Fotocamera</h3>
                        <p style="color: #aaa; margin-bottom: 10px; font-size: 0.9em;">Vedi cosa stai inquadrando in tempo reale</p>
                        <div class="camera-preview-container"></div>
                        <div class="camera-controls">
                            <button class="camera-capture-btn" onclick="capturePhoto()">ðŸ“· Scatta Foto</button>
                            <button class="camera-switch-btn" onclick="switchCamera()">ðŸ”„ Cambia Camera</button>
                            <button class="camera-cancel-btn" onclick="closeCamera()">âœ• Annulla</button>
                        </div>
                    </div>
                `;
                modal.style.cssText = `
                    position: fixed; top: 0; left: 0; right: 0; bottom: 0;
                    background: rgba(0,0,0,0.95); z-index: 2000;
                    display: flex; align-items: center; justify-content: center;
                `;
                
                const style = document.createElement('style');
                style.textContent = `
                    .camera-modal-content {
                        background: linear-gradient(145deg, rgba(20, 25, 45, 0.98), rgba(30, 40, 60, 0.95));
                        border: 2px solid rgba(0, 245, 255, 0.5);
                        border-radius: 20px;
                        padding: 25px;
                        text-align: center;
                        max-width: 90vw;
                    }
                    .camera-modal-content h3 {
                        font-family: 'Orbitron', monospace;
                        color: var(--neon-cyan);
                        margin-bottom: 5px;
                        font-size: 1.5em;
                    }
                    .camera-preview-container {
                        position: relative;
                        display: inline-block;
                    }
                    .camera-preview-container video {
                        width: 100%;
                        max-width: 640px;
                        min-width: 320px;
                        border-radius: 12px;
                        border: 3px solid rgba(0, 245, 255, 0.6);
                        box-shadow: 0 0 30px rgba(0, 245, 255, 0.3);
                    }
                    .camera-preview-container::after {
                        content: 'ðŸ”´ LIVE';
                        position: absolute;
                        top: 15px;
                        right: 15px;
                        background: rgba(255, 0, 0, 0.8);
                        color: white;
                        padding: 5px 10px;
                        border-radius: 5px;
                        font-size: 0.8em;
                        font-weight: bold;
                        animation: livePulse 1s infinite;
                    }
                    @keyframes livePulse {
                        0%, 100% { opacity: 1; }
                        50% { opacity: 0.5; }
                    }
                    .camera-controls {
                        display: flex;
                        gap: 12px;
                        justify-content: center;
                        margin-top: 20px;
                        flex-wrap: wrap;
                    }
                    .camera-capture-btn, .camera-cancel-btn, .camera-switch-btn {
                        padding: 14px 28px;
                        border-radius: 10px;
                        border: none;
                        cursor: pointer;
                        font-family: 'Orbitron', monospace;
                        font-size: 1em;
                        transition: all 0.3s ease;
                    }
                    .camera-capture-btn {
                        background: linear-gradient(135deg, rgba(0, 255, 100, 0.4), rgba(0, 200, 100, 0.3));
                        color: #00ff66;
                        border: 2px solid rgba(0, 255, 100, 0.6);
                        font-size: 1.1em;
                    }
                    .camera-capture-btn:hover {
                        background: rgba(0, 255, 100, 0.5);
                        box-shadow: 0 0 25px rgba(0, 255, 100, 0.6);
                        transform: scale(1.05);
                    }
                    .camera-switch-btn {
                        background: rgba(100, 100, 255, 0.2);
                        color: #aaf;
                        border: 1px solid rgba(100, 100, 255, 0.4);
                    }
                    .camera-switch-btn:hover {
                        background: rgba(100, 100, 255, 0.4);
                    }
                    .camera-cancel-btn {
                        background: rgba(255, 0, 100, 0.2);
                        color: #ff6699;
                        border: 1px solid rgba(255, 0, 100, 0.3);
                    }
                    .camera-cancel-btn:hover {
                        background: rgba(255, 0, 100, 0.4);
                    }
                `;
                document.head.appendChild(style);
                document.body.appendChild(modal);
                
                modal.querySelector('.camera-preview-container').appendChild(video);
                
                // Store stream and facing mode for later
                window.currentCameraStream = stream;
                window.currentCameraVideo = video;
                window.currentFacingMode = 'user';
                
                debugLog('info', 'ðŸ“· Camera opened successfully');
                
            } catch (error) {
                console.error('Camera error:', error);
                addMessage('âŒ Errore accesso fotocamera: ' + error.message, 'system');
                debugLog('error', 'Camera error: ' + error.message);
            }
        }
        
        function capturePhoto() {
            const video = window.currentCameraVideo;
            if (!video) return;
            
            const canvas = document.createElement('canvas');
            canvas.width = video.videoWidth;
            canvas.height = video.videoHeight;
            canvas.getContext('2d').drawImage(video, 0, 0);
            
            selectedImageData = canvas.toDataURL('image/jpeg', 0.9);
            showImagePreview(selectedImageData);
            closeCamera();
            addMessage('âœ… Foto scattata! Aggiungi una domanda e clicca Analizza.', 'system');
            debugLog('info', 'ðŸ“· Photo captured');
        }
        
        async function switchCamera() {
            if (!window.currentCameraStream) return;
            
            // Stop current stream
            window.currentCameraStream.getTracks().forEach(track => track.stop());
            
            // Toggle facing mode
            window.currentFacingMode = window.currentFacingMode === 'user' ? 'environment' : 'user';
            
            try {
                const newStream = await navigator.mediaDevices.getUserMedia({
                    video: { 
                        facingMode: window.currentFacingMode,
                        width: { ideal: 1280 },
                        height: { ideal: 720 }
                    }
                });
                
                window.currentCameraStream = newStream;
                window.currentCameraVideo.srcObject = newStream;
                
                addMessage('ðŸ“· Fotocamera: ' + (window.currentFacingMode === 'user' ? 'Frontale' : 'Posteriore'), 'system');
            } catch (error) {
                console.error('Switch camera error:', error);
                addMessage('âš ï¸ Errore cambio fotocamera', 'system');
            }
        }
        
        function closeCamera() {
            if (window.currentCameraStream) {
                window.currentCameraStream.getTracks().forEach(track => track.stop());
                window.currentCameraStream = null;
            }
            const modal = document.getElementById('camera-modal');
            if (modal) modal.remove();
            debugLog('info', 'ðŸ“· Camera closed');
        }
        
        // ============ RESULT POPUP ============
        function showResultPopup(message, type = 'info') {
            // Remove existing popups
            document.querySelectorAll('.result-popup').forEach(p => p.remove());
            
            const popup = document.createElement('div');
            popup.className = `result-popup ${type}`;
            popup.innerHTML = message;
            popup.style.cssText = `
                position: fixed;
                top: 100px;
                right: 20px;
                padding: 15px 25px;
                border-radius: 12px;
                font-family: 'Rajdhani', sans-serif;
                font-size: 0.95em;
                z-index: 3000;
                animation: slideInRight 0.3s ease;
                max-width: 400px;
                backdrop-filter: blur(10px);
                border: 1px solid rgba(255,255,255,0.2);
            `;
            
            if (type === 'success') {
                popup.style.background = 'rgba(0, 255, 100, 0.2)';
                popup.style.borderColor = 'rgba(0, 255, 100, 0.5)';
                popup.style.color = '#00ff66';
            } else if (type === 'error') {
                popup.style.background = 'rgba(255, 100, 100, 0.2)';
                popup.style.borderColor = 'rgba(255, 100, 100, 0.5)';
                popup.style.color = '#ff6666';
            } else {
                popup.style.background = 'rgba(0, 200, 255, 0.2)';
                popup.style.borderColor = 'rgba(0, 200, 255, 0.5)';
                popup.style.color = '#00ccff';
            }
            
            document.body.appendChild(popup);
            
            // Auto-remove after 4 seconds
            setTimeout(() => {
                popup.style.animation = 'slideInRight 0.3s ease reverse';
                setTimeout(() => popup.remove(), 300);
            }, 4000);
        }
        
        // ============ AI HUB ADVANCED ============
        let currentAIHubMode = null;
        
        const aiHubForms = {
            image: {
                title: 'ðŸŽ¨ Genera Immagine AI',
                fields: [
                    { name: 'prompt', label: 'Descrivi l\'immagine', type: 'textarea', placeholder: 'Es: Un gatto astronauta sulla luna, stile pittura a olio' },
                    { name: 'size', label: 'Dimensione', type: 'select', options: ['1024x1024', '1792x1024', '1024x1792'] },
                    { name: 'style', label: 'Stile', type: 'select', options: ['vivid', 'natural'] }
                ]
            },
            video: {
                title: 'ðŸŽ¬ Genera Video AI',
                fields: [
                    { name: 'prompt', label: 'Descrivi il video', type: 'textarea', placeholder: 'Es: Un tramonto sul mare con onde che si infrangono' },
                    { name: 'script', label: 'Script (opzionale)', type: 'textarea', placeholder: 'Testo da far leggere all\'avatar' },
                    { name: 'avatar_id', label: 'Avatar ID (HeyGen)', type: 'text', placeholder: 'Lascia vuoto per default' }
                ]
            },
            music: {
                title: 'ðŸŽµ Genera Musica AI',
                fields: [
                    { name: 'prompt', label: 'Descrivi la musica', type: 'textarea', placeholder: 'Es: Una melodia jazz rilassante con pianoforte e sassofono' },
                    { name: 'style', label: 'Genere', type: 'select', options: ['pop', 'rock', 'jazz', 'classical', 'electronic', 'hip-hop'] },
                    { name: 'duration', label: 'Durata (secondi)', type: 'number', value: 30 }
                ]
            },
            presentation: {
                title: 'ðŸ“Š Crea Presentazione AI',
                fields: [
                    { name: 'topic', label: 'Argomento', type: 'text', placeholder: 'Es: Intelligenza Artificiale nel 2025' },
                    { name: 'slides', label: 'Numero slide', type: 'number', value: 10 },
                    { name: 'style', label: 'Stile', type: 'select', options: ['professional', 'creative', 'minimal', 'tech'] }
                ]
            },
            podcast: {
                title: 'ðŸŽ™ï¸ Crea Podcast AI',
                fields: [
                    { name: 'content', label: 'Contenuto da discutere', type: 'textarea', placeholder: 'Incolla qui il testo o l\'argomento da trasformare in podcast' },
                    { name: 'title', label: 'Titolo', type: 'text', placeholder: 'Es: Tech Talk con GIDEON' },
                    { name: 'hosts', label: 'Numero host', type: 'number', value: 2 },
                    { name: 'duration_minutes', label: 'Durata (minuti)', type: 'number', value: 5 }
                ]
            },
            code: {
                title: 'ðŸ’» Genera Codice AI',
                fields: [
                    { name: 'description', label: 'Descrivi cosa deve fare', type: 'textarea', placeholder: 'Es: Una funzione Python che ordina una lista' },
                    { name: 'language', label: 'Linguaggio', type: 'select', options: ['python', 'javascript', 'typescript', 'java', 'c++', 'go', 'rust'] },
                    { name: 'framework', label: 'Framework (opzionale)', type: 'text', placeholder: 'Es: FastAPI, React, etc.' }
                ]
            }
        };
        
        function openAIHubModal(mode) {
            currentAIHubMode = mode;
            const config = aiHubForms[mode];
            if (!config) {
                // If no form config, just open the external URL
                openAIHub(mode);
                return;
            }
            
            // Create modal dynamically
            const existingModal = document.getElementById('ai-hub-modal');
            if (existingModal) existingModal.remove();
            
            const modal = document.createElement('div');
            modal.id = 'ai-hub-modal';
            modal.style.cssText = `
                position: fixed; top: 0; left: 0; right: 0; bottom: 0;
                background: rgba(0,0,0,0.9); z-index: 2000;
                display: flex; align-items: center; justify-content: center;
            `;
            
            modal.innerHTML = `
                <div class="ai-hub-content" style="
                    background: linear-gradient(145deg, rgba(20, 25, 45, 0.98), rgba(30, 40, 60, 0.95));
                    border: 2px solid rgba(0, 245, 255, 0.5);
                    border-radius: 20px;
                    padding: 30px;
                    max-width: 500px;
                    width: 90%;
                ">
                    <h3 id="ai-hub-title" style="
                        font-family: 'Orbitron', monospace;
                        color: var(--neon-cyan);
                        margin-bottom: 20px;
                        text-align: center;
                        font-size: 1.4em;
                    ">${config.title}</h3>
                    
                    <div id="ai-hub-form-container" style="
                        display: flex;
                        flex-direction: column;
                        gap: 15px;
                    "></div>
                    
                    <div id="ai-hub-result" style="
                        display: none;
                        margin-top: 20px;
                        padding: 15px;
                        border-radius: 10px;
                        background: rgba(0, 200, 255, 0.1);
                    "></div>
                    
                    <div style="display: flex; gap: 15px; margin-top: 25px; justify-content: center;">
                        <button onclick="closeAIHubModal()" style="
                            padding: 12px 30px;
                            border-radius: 10px;
                            border: 1px solid rgba(255, 100, 100, 0.5);
                            background: rgba(255, 100, 100, 0.2);
                            color: #ff6666;
                            cursor: pointer;
                            font-family: 'Orbitron', monospace;
                        ">âŒ Annulla</button>
                        <button onclick="submitAIHubModal()" style="
                            padding: 12px 30px;
                            border-radius: 10px;
                            border: 1px solid rgba(0, 255, 100, 0.5);
                            background: rgba(0, 255, 100, 0.2);
                            color: #00ff66;
                            cursor: pointer;
                            font-family: 'Orbitron', monospace;
                        ">ðŸš€ Genera</button>
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
            
            // Fill form fields
            const formContainer = document.getElementById('ai-hub-form-container');
            formContainer.innerHTML = config.fields.map(field => {
                const labelStyle = "color: var(--neon-cyan); font-size: 0.9em; margin-bottom: 5px;";
                const inputStyle = `
                    width: 100%;
                    padding: 10px 15px;
                    border-radius: 8px;
                    border: 1px solid rgba(0, 245, 255, 0.3);
                    background: rgba(0, 0, 0, 0.3);
                    color: white;
                    font-family: 'Rajdhani', sans-serif;
                `;
                
                if (field.type === 'textarea') {
                    return `
                        <div>
                            <label style="${labelStyle}">${field.label}</label>
                            <textarea name="${field.name}" placeholder="${field.placeholder || ''}" style="${inputStyle} min-height: 80px; resize: vertical;">${field.value || ''}</textarea>
                        </div>
                    `;
                } else if (field.type === 'select') {
                    return `
                        <div>
                            <label style="${labelStyle}">${field.label}</label>
                            <select name="${field.name}" style="${inputStyle}">
                                ${field.options.map(opt => `<option value="${opt}">${opt}</option>`).join('')}
                            </select>
                        </div>
                    `;
                } else if (field.type === 'number') {
                    return `
                        <div>
                            <label style="${labelStyle}">${field.label}</label>
                            <input type="number" name="${field.name}" value="${field.value || 0}" style="${inputStyle}">
                        </div>
                    `;
                } else {
                    return `
                        <div>
                            <label style="${labelStyle}">${field.label}</label>
                            <input type="text" name="${field.name}" placeholder="${field.placeholder || ''}" value="${field.value || ''}" style="${inputStyle}">
                        </div>
                    `;
                }
            }).join('');
            
            debugLog('info', `ðŸš€ AI Hub Modal opened: ${mode}`);
        }
        
        function closeAIHubModal() {
            const modal = document.getElementById('ai-hub-modal');
            if (modal) modal.remove();
            currentAIHubMode = null;
        }
        
        async function submitAIHubModal() {
            if (!currentAIHubMode) return;
            
            const formContainer = document.getElementById('ai-hub-form-container');
            const formData = {};
            
            formContainer.querySelectorAll('input, textarea, select').forEach(el => {
                formData[el.name] = el.type === 'number' ? parseInt(el.value) : el.value;
            });
            
            const resultDiv = document.getElementById('ai-hub-result');
            resultDiv.style.display = 'block';
            resultDiv.innerHTML = 'â³ Elaborazione in corso...';
            resultDiv.style.background = 'rgba(138, 43, 226, 0.2)';
            
            try {
                let endpoint = '';
                let body = formData;
                
                switch(currentAIHubMode) {
                    case 'image': endpoint = '/api/hub/image'; break;
                    case 'video': endpoint = '/api/hub/video'; break;
                    case 'music': endpoint = '/api/hub/music'; break;
                    case 'presentation': endpoint = '/api/hub/presentation'; break;
                    case 'podcast': endpoint = '/api/hub/podcast'; break;
                    case 'code': endpoint = '/api/gideon/chat'; 
                        body = { message: `Genera codice ${formData.language}${formData.framework ? ' con ' + formData.framework : ''}: ${formData.description}` };
                        break;
                }
                
                const response = await fetch(`${API_BASE}${endpoint}`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(body)
                });
                
                const result = await response.json();
                
                if (result.success || result.response) {
                    resultDiv.style.background = 'rgba(0, 255, 100, 0.2)';
                    
                    if (result.image_base64) {
                        resultDiv.innerHTML = `
                            <p style="color: #00ff66;">âœ… Immagine generata!</p>
                            <img src="data:image/png;base64,${result.image_base64}" style="max-width: 100%; border-radius: 10px; margin-top: 10px;">
                        `;
                    } else if (result.audio_base64) {
                        resultDiv.innerHTML = `
                            <p style="color: #00ff66;">âœ… Audio generato!</p>
                            <audio controls src="data:audio/mp3;base64,${result.audio_base64}" style="width: 100%; margin-top: 10px;"></audio>
                        `;
                    } else if (result.response) {
                        resultDiv.innerHTML = `
                            <p style="color: #00ff66;">âœ… Codice generato!</p>
                            <pre style="white-space: pre-wrap; max-height: 300px; overflow-y: auto; background: rgba(0,0,0,0.3); padding: 10px; border-radius: 8px; font-family: 'JetBrains Mono', monospace; font-size: 0.85em;">${result.response}</pre>
                        `;
                    } else {
                        resultDiv.innerHTML = `<p style="color: #00ff66;">âœ… Operazione completata!</p><pre style="white-space: pre-wrap; max-height: 200px; overflow-y: auto;">${JSON.stringify(result, null, 2)}</pre>`;
                    }
                    
                    addMessage(`ðŸš€ AI Hub: ${currentAIHubMode} completato!`, 'system');
                    showResultPopup(`âœ… ${currentAIHubMode} completato!`, 'success');
                } else {
                    resultDiv.style.background = 'rgba(255, 100, 100, 0.2)';
                    resultDiv.innerHTML = `<p style="color: #ff6666;">âŒ Errore: ${result.error || 'Operazione fallita'}</p>`;
                }
            } catch (error) {
                resultDiv.style.background = 'rgba(255, 100, 100, 0.2)';
                resultDiv.innerHTML = `<p style="color: #ff6666;">âŒ Errore di connessione: ${error.message}</p>`;
            }
        }
        
        // Track API calls
        const originalFetch = window.fetch;
        window.fetch = function(...args) {
            debugState.apiCalls++;
            updateDebugStats();
            debugLog('info', `ðŸ“¡ API Call: ${args[0]}`);
            return originalFetch.apply(this, args);
        };
        
        // Update debug stats periodically
        setInterval(updateDebugStats, 5000);
        
        // ============ STATE ============
        const state = {
            currentMode: 'copilot',
            currentTab: 'chat',
            responseMode: 'fast',  // eco, fast, deep
            isTTSEnabled: true,  // TTS ATTIVO DI DEFAULT per sentire GIDEON
            isListening: false,
            isSpeaking: false,
            isHandsFree: false,
            isPilotMode: false,  // ModalitÃ  PILOT per controllo autonomo
            isConnected: false,  // Connection status
            messages: [],
            workflows: [],
            sessionStartTime: Date.now(),
            workflowNodes: [],
            nodeIdCounter: 0,
            recognition: null,
            cameraStream: null,
            sessionId: 'session_' + Date.now(),
            apiBaseUrl: API_BASE  // For CAM and other modules
        };
        
        // ============ FUTURISTIC EFFECTS ============
        function initParticles() {
            const container = document.getElementById('particles');
            if (!container) return;
            
            const colors = ['var(--neon-cyan)', 'var(--neon-purple)', 'var(--neon-blue)', 'var(--neon-green)'];
            
            for (let i = 0; i < 25; i++) {
                const particle = document.createElement('div');
                particle.className = 'particle';
                particle.style.left = Math.random() * 100 + '%';
                particle.style.animationDelay = Math.random() * 15 + 's';
                particle.style.animationDuration = (15 + Math.random() * 10) + 's';
                particle.style.background = colors[Math.floor(Math.random() * colors.length)];
                particle.style.width = (2 + Math.random() * 4) + 'px';
                particle.style.height = particle.style.width;
                container.appendChild(particle);
            }
        }
        
        function initHolographicEffects() {
            // Add holographic shimmer to cards on hover
            document.querySelectorAll('.module-card, .service-card, .monitor-card, .science-tool').forEach(card => {
                card.addEventListener('mousemove', (e) => {
                    const rect = card.getBoundingClientRect();
                    const x = ((e.clientX - rect.left) / rect.width) * 100;
                    const y = ((e.clientY - rect.top) / rect.height) * 100;
                    card.style.setProperty('--mouse-x', x + '%');
                    card.style.setProperty('--mouse-y', y + '%');
                    
                    // 3D tilt effect
                    const tiltX = (y - 50) / 10;
                    const tiltY = (x - 50) / -10;
                    card.style.transform = `perspective(1000px) rotateX(${tiltX}deg) rotateY(${tiltY}deg) scale(1.02)`;
                });
                
                card.addEventListener('mouseleave', () => {
                    card.style.transform = 'perspective(1000px) rotateX(0) rotateY(0) scale(1)';
                });
            });
        }
        
        function initGlowCursor() {
            // Create cursor glow element
            const glowCursor = document.createElement('div');
            glowCursor.style.cssText = `
                position: fixed;
                width: 300px;
                height: 300px;
                border-radius: 50%;
                background: radial-gradient(circle, rgba(0,245,255,0.1) 0%, transparent 70%);
                pointer-events: none;
                z-index: 9999;
                transform: translate(-50%, -50%);
                transition: opacity 0.3s ease;
                opacity: 0;
            `;
            document.body.appendChild(glowCursor);
            
            document.addEventListener('mousemove', (e) => {
                glowCursor.style.left = e.clientX + 'px';
                glowCursor.style.top = e.clientY + 'px';
                glowCursor.style.opacity = '1';
            });
            
            document.addEventListener('mouseleave', () => {
                glowCursor.style.opacity = '0';
            });
        }
        
        function initSoundEffects() {
            // Subtle hover sound for buttons
            const buttons = document.querySelectorAll('button, .module-card, .service-card, .control-btn');
            buttons.forEach(btn => {
                btn.addEventListener('mouseenter', () => {
                    // Could add sound here if desired
                });
            });
        }
        
        // ============ INITIALIZATION ============
        document.addEventListener('DOMContentLoaded', () => {
            // Init futuristic effects
            initParticles();
            initHolographicEffects();
            initGlowCursor();
            initSoundEffects();
            
            // Init main features
            initModeSelector();
            initChat();
            initVoice();
            initWorkflow();
            
            // Init status displays
            updateDateTime();
            setInterval(updateDateTime, 1000);
            updateSessionTime();
            setInterval(updateSessionTime, 1000);
            
            // Check connection status
            checkConnectionStatus();
            setInterval(checkConnectionStatus, 5000);
            
            // Typing effect for title
            typeWriterEffect();
            
            // Welcome message with TTS
            setTimeout(() => {
                if (state.isTTSEnabled) {
                    speak("Benvenuto in Gideon 4.0, la piattaforma di intelligenza unificata.");
                }
            }, 1500);
            
            // Animate metric bars on load
            setTimeout(animateMetrics, 500);
            
            console.log('%cðŸš€ GIDEON 4.0 INITIALIZED', 'color: #00f5ff; font-size: 20px; font-weight: bold;');
            console.log('%cUnified Intelligence Platform Ready', 'color: #8000ff; font-size: 14px;');
        });
        
        function animateMetrics() {
            document.querySelectorAll('.metric-fill').forEach(fill => {
                const targetWidth = fill.style.width;
                fill.style.width = '0%';
                setTimeout(() => {
                    fill.style.width = targetWidth;
                }, 100);
            });
        }
        
        function typeWriterEffect() {
            const subtitle = document.querySelector('.logo-text span');
            if (!subtitle) return;
            const text = subtitle.textContent;
            subtitle.textContent = '';
            let i = 0;
            const type = () => {
                if (i < text.length) {
                    subtitle.textContent += text.charAt(i);
                    i++;
                    setTimeout(type, 50);
                }
            };
            setTimeout(type, 500);
        }
        
        // ============ MODE SELECTOR ============
        function initModeSelector() {
            document.querySelectorAll('.mode-btn').forEach(btn => {
                btn.addEventListener('click', () => {
                    const mode = btn.dataset.mode;
                    if (mode === 'pilot' || mode === 'executive') {
                        showAuthDialog(mode);
                    } else {
                        setMode(mode);
                    }
                });
            });
        }
        
        function setMode(mode) {
            state.currentMode = mode;
            document.querySelectorAll('.mode-btn').forEach(btn => {
                btn.classList.toggle('active', btn.dataset.mode === mode);
            });
            
            const modeColors = {
                passive: 'var(--passive-color)',
                copilot: 'var(--copilot-color)',
                pilot: 'var(--pilot-color)',
                executive: 'var(--executive-color)'
            };
            
            document.documentElement.style.setProperty('--current-mode-color', modeColors[mode]);
            addLog(`[MODE] Switched to ${mode.toUpperCase()} mode`);
            
            if (state.isTTSEnabled) {
                speak(`ModalitÃ  ${mode} attivata.`);
            }
        }
        
        function showAuthDialog(mode) {
            const phrase = prompt(`ðŸ” Per attivare ${mode.toUpperCase()} MODE, inserisci la frase di autorizzazione:\n\n(Suggerimento: "Autorizzazione ${mode} alfa zero uno")`);
            
            if (phrase && phrase.toLowerCase() === `autorizzazione ${mode} alfa zero uno`) {
                setMode(mode);
                addSystemMessage(`ðŸš€ ${mode.toUpperCase()} MODE ATTIVATO - Controllo completo abilitato`);
            } else if (phrase) {
                alert('âŒ Frase di autorizzazione non corretta');
            }
        }
        
        // ============ TABS ============
        function switchTab(tabName) {
            state.currentTab = tabName;
            
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.classList.toggle('active', btn.textContent.toLowerCase().includes(tabName));
            });
            
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.toggle('active', content.id === `tab-${tabName}`);
            });
            
            addLog(`[UI] Switched to ${tabName.toUpperCase()} tab`);
        }
        
        // ============ CHAT ============
        function initChat() {
            const input = document.getElementById('chat-input');
            const sendBtn = document.getElementById('send-btn');
            
            input.addEventListener('keydown', (e) => {
                if (e.key === 'Enter' && !e.shiftKey) {
                    e.preventDefault();
                    sendMessage();
                }
            });
            
            sendBtn.addEventListener('click', sendMessage);
            
            // Auto-resize textarea
            input.addEventListener('input', () => {
                input.style.height = 'auto';
                input.style.height = Math.min(input.scrollHeight, 150) + 'px';
            });
            
            // Initialize response mode selector
            initResponseMode();
            
            // Initialize quick actions
            initQuickActions();
        }
        
        function initResponseMode() {
            document.querySelectorAll('.response-mode-btn').forEach(btn => {
                btn.addEventListener('click', () => {
                    const mode = btn.dataset.mode;
                    state.responseMode = mode;
                    
                    // Update UI
                    document.querySelectorAll('.response-mode-btn').forEach(b => b.classList.remove('active'));
                    btn.classList.add('active');
                    
                    const modeNames = { eco: 'ECO (breve)', fast: 'FAST (bilanciato)', deep: 'DEEP (approfondito)' };
                    addLog(`[CHAT] Response mode: ${modeNames[mode]}`);
                    
                    // Feedback vocale opzionale
                    if (state.isTTSEnabled && mode === 'deep') {
                        speak('ModalitÃ  approfondita attivata.');
                    }
                });
            });
        }
        
        // Initialize Quick Actions
        function initQuickActions() {
            document.querySelectorAll('.quick-action').forEach(btn => {
                btn.addEventListener('click', async () => {
                    const message = btn.dataset.message;
                    const action = btn.dataset.action;
                    const params = btn.dataset.params ? JSON.parse(btn.dataset.params) : {};
                    
                    if (message) {
                        // Send as chat message
                        document.getElementById('chat-input').value = message;
                        sendMessage();
                    } else if (action) {
                        // Execute action directly
                        try {
                            addLog(`[ACTION] Executing: ${action}`);
                            const response = await fetch(`${API_BASE}/api/action`, {
                                method: 'POST',
                                headers: { 'Content-Type': 'application/json' },
                                body: JSON.stringify({ action, params })
                            });
                            const result = await response.json();
                            if (result.success) {
                                addLog(`[ACTION] âœ“ ${action} completato`);
                            } else {
                                addLog(`[ACTION] âœ— ${action} fallito: ${result.error}`);
                            }
                        } catch (err) {
                            addLog(`[ACTION] Errore: ${err.message}`);
                        }
                    }
                });
            });
        }
        
        async function sendMessage() {
            const input = document.getElementById('chat-input');
            const text = input.value.trim();
            
            if (!text) return;
            
            // Add user message
            addMessage(text, 'user');
            input.value = '';
            input.style.height = 'auto';
            
            // Show typing indicator
            showTyping(true);
            
            try {
                // Use the combined endpoint for chat + voice if TTS is enabled
                const endpoint = state.isTTSEnabled 
                    ? `${API_BASE}/api/chat/send-with-voice`
                    : `${API_BASE}/api/chat/send`;
                
                const response = await fetch(endpoint, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        message: text,
                        mode: state.currentMode,
                        response_mode: state.responseMode,
                        session_id: state.sessionId || 'main'
                    })
                });
                
                const data = await response.json();
                showTyping(false);
                
                // Handle response text
                const responseText = data.response || data.text || data.message;
                if (responseText) {
                    addMessage(responseText, 'assistant');
                    
                    // If using send-with-voice, audio is included as base64
                    if (state.isTTSEnabled && data.audio_base64) {
                        playAudioBase64(data.audio_base64);
                    } else if (state.isTTSEnabled && responseText) {
                        // Fallback to separate TTS call
                        speak(responseText);
                    }
                } else {
                    addMessage('âš ï¸ Risposta vuota dal server', 'assistant');
                }
            } catch (error) {
                showTyping(false);
                addMessage('âš ï¸ Errore di connessione al backend. Verifica che il server sia attivo.', 'assistant');
                addLog(`[ERROR] Chat request failed: ${error.message}`);
                console.error('Chat error:', error);
            }
        }
        
        // Play base64 encoded audio
        function playAudioBase64(base64Audio) {
            try {
                const audioData = atob(base64Audio);
                const arrayBuffer = new Uint8Array(audioData.length);
                for (let i = 0; i < audioData.length; i++) {
                    arrayBuffer[i] = audioData.charCodeAt(i);
                }
                const blob = new Blob([arrayBuffer], { type: 'audio/mp3' });
                const audio = new Audio(URL.createObjectURL(blob));
                
                state.isSpeaking = true;
                audio.onended = () => { state.isSpeaking = false; };
                
                audio.play().catch(e => {
                    console.log('Autoplay blocked:', e);
                    addLog('[AUDIO] Autoplay bloccato - clicca sulla pagina per abilitare');
                });
            } catch (error) {
                console.error('Audio playback error:', error);
            }
        }
        
        function addMessage(text, type) {
            const container = document.getElementById('chat-messages');
            const time = new Date().toLocaleTimeString('it-IT', { hour: '2-digit', minute: '2-digit' });
            
            const msg = document.createElement('div');
            msg.className = `message ${type}`;
            msg.innerHTML = `
                <div class="message-content">${formatMessage(text)}</div>
                <div class="message-meta">${type === 'user' ? 'Tu' : 'GIDEON'} â€¢ ${time}</div>
            `;
            
            container.appendChild(msg);
            container.scrollTop = container.scrollHeight;
            
            state.messages.push({ text, type, time });
        }
        
        function addSystemMessage(text, type = 'info') {
            // type can be: 'info', 'success', 'warning', 'error'
            const typeStyles = {
                info: 'color: var(--neon-cyan);',
                success: 'color: var(--neon-green);',
                warning: 'color: var(--neon-orange);',
                error: 'color: var(--neon-red);'
            };
            const style = typeStyles[type] || typeStyles.info;
            addMessage(`<span style="${style}"><em>${text}</em></span>`, 'assistant');
        }
        
        function formatMessage(text) {
            // Basic markdown-like formatting
            return text
                .replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>')
                .replace(/\*(.*?)\*/g, '<em>$1</em>')
                .replace(/`(.*?)`/g, '<code>$1</code>')
                .replace(/\n/g, '<br>');
        }
        
        function showTyping(show) {
            document.getElementById('typing-indicator').classList.toggle('active', show);
        }
        
        // ============ CARD INFO TOGGLE ============
        function toggleCardInfo(cardId) {
            const card = document.getElementById(cardId);
            const info = card.querySelector('.card-info');
            
            // Close all other info boxes
            document.querySelectorAll('.card-info.visible').forEach(el => {
                if (el !== info) el.classList.remove('visible');
            });
            
            // Toggle current info box
            info.classList.toggle('visible');
        }
        
        // Close info boxes when clicking outside
        document.addEventListener('click', (e) => {
            if (!e.target.closest('.control-card') && !e.target.closest('.info-toggle')) {
                document.querySelectorAll('.card-info.visible').forEach(el => {
                    el.classList.remove('visible');
                });
            }
        });
        
        // ============ VOICE & CONTROLS ============
        function initVoice() {
            // Get control buttons
            const micBtn = document.getElementById('mic-btn');
            const ttsBtn = document.getElementById('tts-btn');
            const handsfreeBtn = document.getElementById('handsfree-btn');
            const cameraBtn = document.getElementById('camera-btn');
            const screenshotBtn = document.getElementById('screenshot-btn');
            
            // Add event listeners
            micBtn.addEventListener('click', toggleMicrophone);
            ttsBtn.addEventListener('click', toggleTTS);
            handsfreeBtn.addEventListener('click', toggleHandsFree);
            cameraBtn.addEventListener('click', activateCamera);
            screenshotBtn.addEventListener('click', takeScreenshot);
            
            // Initialize Web Speech API
            if ('webkitSpeechRecognition' in window || 'SpeechRecognition' in window) {
                const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
                state.recognition = new SpeechRecognition();
                state.recognition.continuous = false;
                state.recognition.interimResults = true;
                state.recognition.lang = 'it-IT';
                
                state.recognition.onresult = (event) => {
                    const text = event.results[0][0].transcript;
                    const isFinal = event.results[0].isFinal;
                    
                    // Show interim results in input
                    document.getElementById('chat-input').value = text;
                    
                    if (isFinal) {
                        sendMessage();
                        
                        // In hands-free mode, restart listening after response
                        if (state.isHandsFree) {
                            setTimeout(() => {
                                if (!state.isSpeaking) {
                                    startListening();
                                }
                            }, 1000);
                        }
                    }
                };
                
                state.recognition.onend = () => {
                    state.isListening = false;
                    micBtn.classList.remove('recording');
                    
                    // In hands-free mode, restart listening
                    if (state.isHandsFree && !state.isSpeaking) {
                        setTimeout(startListening, 500);
                    }
                };
                
                state.recognition.onerror = (event) => {
                    console.log('Speech recognition error:', event.error);
                    if (event.error !== 'no-speech') {
                        addLog(`[MIC] Errore: ${event.error}`);
                    }
                    
                    // In hands-free mode, restart on error
                    if (state.isHandsFree) {
                        setTimeout(startListening, 1000);
                    }
                };
            } else {
                addLog('[MIC] Speech Recognition non supportato');
                micBtn.disabled = true;
                handsfreeBtn.disabled = true;
            }
        }
        
        function startListening() {
            if (!state.recognition || state.isListening) return;
            
            try {
                state.recognition.start();
                state.isListening = true;
                document.getElementById('mic-btn').classList.add('recording');
                document.getElementById('mic-card').classList.add('recording');
            } catch (e) {
                console.log('Could not start recognition:', e);
            }
        }
        
        function stopListening() {
            if (!state.recognition || !state.isListening) return;
            
            try {
                state.recognition.stop();
                state.isListening = false;
                document.getElementById('mic-btn').classList.remove('recording');
                document.getElementById('mic-card').classList.remove('recording');
            } catch (e) {
                console.log('Could not stop recognition:', e);
            }
        }
        
        function toggleMicrophone() {
            const micBtn = document.getElementById('mic-btn');
            const micCard = document.getElementById('mic-card');
            
            if (state.isListening) {
                stopListening();
                micBtn.classList.remove('active');
                micCard.classList.remove('recording');
                addLog('[MIC] Microfono disattivato');
            } else {
                startListening();
                micBtn.classList.add('active');
                micCard.classList.add('recording');
                addLog('[MIC] Microfono attivo - Parla!');
            }
        }
        
        function toggleTTS() {
            state.isTTSEnabled = !state.isTTSEnabled;
            const ttsBtn = document.getElementById('tts-btn');
            const ttsCard = document.getElementById('tts-card');
            const ttsStatus = document.getElementById('tts-status');
            
            ttsBtn.classList.toggle('active', state.isTTSEnabled);
            ttsCard.classList.toggle('active', state.isTTSEnabled);
            if (ttsStatus) ttsStatus.textContent = state.isTTSEnabled ? 'TTS ON' : 'TTS OFF';
            
            addLog(`[VOCE] Voce GIDEON ${state.isTTSEnabled ? 'ATTIVA' : 'DISATTIVA'}`);
            
            if (state.isTTSEnabled) {
                speak('Voce attiva. Sono pronto ad assisterti.');
            }
        }
        
        function toggleHandsFree() {
            state.isHandsFree = !state.isHandsFree;
            const handsfreeBtn = document.getElementById('handsfree-btn');
            const handsfreeCard = document.getElementById('handsfree-card');
            const indicator = document.getElementById('handsfree-indicator');
            
            handsfreeBtn.classList.toggle('active', state.isHandsFree);
            handsfreeCard.classList.toggle('active', state.isHandsFree);
            indicator.classList.toggle('active', state.isHandsFree);
            
            if (state.isHandsFree) {
                // Enable TTS and start listening
                state.isTTSEnabled = true;
                document.getElementById('tts-btn').classList.add('active');
                document.getElementById('tts-card').classList.add('active');
                startListening();
                addLog('[HANDS-FREE] ModalitÃ  hands-free ATTIVA');
                speak('ModalitÃ  hands-free attivata. Parla quando vuoi, ti ascolto sempre.');
            } else {
                stopListening();
                addLog('[HANDS-FREE] ModalitÃ  hands-free DISATTIVATA');
                speak('ModalitÃ  hands-free disattivata.');
            }
        }
        
        async function activateCamera() {
            addLog('[CAMERA] Attivazione fotocamera...');
            
            try {
                // Create video preview modal
                const modal = document.createElement('div');
                modal.id = 'camera-modal';
                modal.innerHTML = `
                    <div class="camera-container" style="
                        position: fixed;
                        top: 50%;
                        left: 50%;
                        transform: translate(-50%, -50%);
                        background: rgba(15,15,25,0.98);
                        border: 2px solid var(--neon-cyan);
                        border-radius: 20px;
                        padding: 20px;
                        z-index: 10000;
                        box-shadow: 0 0 50px rgba(0,245,255,0.3);
                    ">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                            <h3 style="color: var(--neon-cyan); font-family: 'Orbitron', monospace; margin: 0;">ðŸ“· GIDEON Vision</h3>
                            <button onclick="closeCameraModal()" style="
                                background: transparent;
                                border: 1px solid var(--neon-red);
                                color: var(--neon-red);
                                padding: 5px 15px;
                                border-radius: 10px;
                                cursor: pointer;
                            ">âœ• Chiudi</button>
                        </div>
                        <video id="camera-preview" autoplay playsinline style="
                            width: 480px;
                            max-width: 90vw;
                            border-radius: 10px;
                            border: 1px solid var(--glass-border);
                        "></video>
                        <div style="margin-top: 15px; display: flex; gap: 10px; justify-content: center;">
                            <button onclick="captureAndAnalyze()" style="
                                background: linear-gradient(135deg, var(--neon-cyan), var(--neon-blue));
                                border: none;
                                color: #000;
                                padding: 12px 25px;
                                border-radius: 25px;
                                font-weight: bold;
                                cursor: pointer;
                            ">ðŸ“¸ Scatta e Analizza</button>
                            <input type="text" id="camera-question" placeholder="Cosa vuoi sapere?" style="
                                flex: 1;
                                background: rgba(0,0,0,0.5);
                                border: 1px solid var(--glass-border);
                                border-radius: 10px;
                                padding: 10px 15px;
                                color: #fff;
                            " value="Cosa vedi in questa immagine?">
                        </div>
                    </div>
                    <div onclick="closeCameraModal()" style="
                        position: fixed;
                        top: 0; left: 0;
                        width: 100%; height: 100%;
                        background: rgba(0,0,0,0.7);
                        z-index: 9999;
                    "></div>
                `;
                document.body.appendChild(modal);
                
                // Get camera stream
                const stream = await navigator.mediaDevices.getUserMedia({ video: true });
                state.cameraStream = stream;
                document.getElementById('camera-preview').srcObject = stream;
                
            } catch (error) {
                addLog(`[CAMERA] Errore: ${error.message}`);
                addSystemMessage('âš ï¸ Impossibile accedere alla fotocamera. Verifica i permessi del browser.');
            }
        }
        
        window.closeCameraModal = function() {
            const modal = document.getElementById('camera-modal');
            if (modal) {
                if (state.cameraStream) {
                    state.cameraStream.getTracks().forEach(track => track.stop());
                    state.cameraStream = null;
                }
                modal.remove();
            }
        };
        
        window.captureAndAnalyze = async function() {
            const video = document.getElementById('camera-preview');
            const question = document.getElementById('camera-question').value || 'Cosa vedi?';
            
            // Capture frame to canvas
            const canvas = document.createElement('canvas');
            canvas.width = video.videoWidth;
            canvas.height = video.videoHeight;
            canvas.getContext('2d').drawImage(video, 0, 0);
            
            // Convert to base64
            const imageBase64 = canvas.toDataURL('image/jpeg', 0.8).split(',')[1];
            
            closeCameraModal();
            addSystemMessage(`ðŸ“· Analizzo l'immagine: "${question}"`);
            showTyping(true);
            
            try {
                const response = await fetch(`${API_BASE}/api/smart/vision/analyze`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        image_base64: imageBase64,
                        question: question
                    })
                });
                
                const data = await response.json();
                showTyping(false);
                
                if (data.analysis || data.response) {
                    addMessage(data.analysis || data.response, 'assistant');
                    if (state.isTTSEnabled) speak(data.analysis || data.response);
                }
            } catch (error) {
                showTyping(false);
                addMessage('âš ï¸ Errore nell\'analisi dell\'immagine.', 'assistant');
            }
        };
        
        async function takeScreenshot() {
            addLog('[SCREENSHOT] Cattura schermo...');
            addSystemMessage('ðŸ“¸ Sto catturando lo screenshot...');
            showTyping(true);
            
            try {
                const response = await fetch(`${API_BASE}/api/smart/vision/screenshot`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        question: 'Descrivi cosa vedi sullo schermo in modo dettagliato.'
                    })
                });
                
                const data = await response.json();
                showTyping(false);
                
                if (data.analysis || data.response) {
                    addMessage(`ðŸ–¼ï¸ **Analisi Screenshot:**\n\n${data.analysis || data.response}`, 'assistant');
                    if (state.isTTSEnabled) speak(data.analysis || data.response);
                }
            } catch (error) {
                showTyping(false);
                addMessage('âš ï¸ Errore nella cattura dello screenshot.', 'assistant');
                addLog(`[SCREENSHOT] Errore: ${error.message}`);
            }
        }
        
        // ============ TTS VOICE ENGINE ============
        let audioQueue = [];
        let isPlayingAudio = false;
        
        async function speak(text, force = false) {
            // Se force=true parla anche se TTS Ã¨ disabilitato
            if (!text) return;
            if (!state.isTTSEnabled && !force) return;
            
            // Stop listening while speaking in hands-free mode
            if (state.isHandsFree && state.isListening) {
                stopListening();
            }
            
            console.log('[TTS] Richiesta voce:', text.substring(0, 50) + '...');
            addLog(`[VOCE] ${text.substring(0, 30)}...`);
            
            try {
                const response = await fetch(`${API_BASE}/api/tts/speak`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ text })
                });
                
                if (response.ok) {
                    const blob = await response.blob();
                    const audioUrl = URL.createObjectURL(blob);
                    const audio = new Audio(audioUrl);
                    
                    // Configurazione audio
                    audio.volume = 1.0;
                    state.isSpeaking = true;
                    
                    // Indicatore visivo che GIDEON sta parlando
                    document.body.classList.add('gideon-speaking');
                    
                    audio.onended = () => {
                        state.isSpeaking = false;
                        document.body.classList.remove('gideon-speaking');
                        URL.revokeObjectURL(audioUrl);
                        
                        // Resume listening in hands-free mode
                        if (state.isHandsFree) {
                            setTimeout(startListening, 300);
                        }
                    };
                    
                    audio.onerror = (e) => {
                        console.error('Audio error:', e);
                        state.isSpeaking = false;
                        document.body.classList.remove('gideon-speaking');
                    };
                    
                    // Prova a riprodurre
                    const playPromise = audio.play();
                    if (playPromise !== undefined) {
                        playPromise
                            .then(() => {
                                console.log('[TTS] âœ… Audio in riproduzione');
                            })
                            .catch(e => {
                                console.log('[TTS] âš ï¸ Autoplay bloccato, riprovo con interazione utente');
                                state.isSpeaking = false;
                                document.body.classList.remove('gideon-speaking');
                                
                                // Mostra messaggio per abilitare audio
                                showAudioEnablePrompt(audioUrl, text);
                            });
                    }
                } else {
                    console.error('[TTS] Errore risposta:', response.status);
                }
            } catch (error) {
                console.error('[TTS] Errore:', error);
                state.isSpeaking = false;
                document.body.classList.remove('gideon-speaking');
            }
        }
        
        function showAudioEnablePrompt(audioUrl, text) {
            // Crea un overlay temporaneo per abilitare l'audio
            const overlay = document.createElement('div');
            overlay.id = 'audio-enable-overlay';
            overlay.style.cssText = `
                position: fixed;
                top: 0; left: 0;
                width: 100%; height: 100%;
                background: rgba(0,0,0,0.8);
                display: flex;
                flex-direction: column;
                justify-content: center;
                align-items: center;
                z-index: 99999;
                cursor: pointer;
            `;
            overlay.innerHTML = `
                <div style="font-size: 4em; margin-bottom: 20px;">ðŸ”Š</div>
                <div style="color: var(--neon-cyan); font-family: 'Orbitron', monospace; font-size: 1.5em; text-align: center;">
                    Clicca per abilitare la voce di GIDEON
                </div>
                <div style="color: rgba(255,255,255,0.5); margin-top: 10px;">
                    (Il browser richiede un'interazione per l'audio)
                </div>
            `;
            
            overlay.onclick = () => {
                const audio = new Audio(audioUrl);
                audio.volume = 1.0;
                audio.play().then(() => {
                    console.log('[TTS] âœ… Audio abilitato dall\'utente');
                    state.isSpeaking = true;
                    document.body.classList.add('gideon-speaking');
                    
                    audio.onended = () => {
                        state.isSpeaking = false;
                        document.body.classList.remove('gideon-speaking');
                    };
                });
                overlay.remove();
            };
            
            document.body.appendChild(overlay);
            
            // Rimuovi automaticamente dopo 10 secondi
            setTimeout(() => {
                if (document.getElementById('audio-enable-overlay')) {
                    overlay.remove();
                }
            }, 10000);
        }
        
        // Funzione per forzare GIDEON a parlare (bypass TTS toggle)
        function gideonSpeak(text) {
            speak(text, true);
        }
        
        // ============ MODULES ============
        function openModule(moduleName) {
            const panelId = `${moduleName}-panel`;
            const panel = document.getElementById(panelId);
            
            if (panel) {
                panel.classList.add('active');
                addLog(`[MODULE] Opened ${moduleName.toUpperCase()} module`);
            } else if (moduleName === 'workflows') {
                switchTab('workflow');
            }
        }
        
        function closePanel(panelId) {
            document.getElementById(panelId).classList.remove('active');
        }
        
        // ============ CAM - CRISIS AUTOMATION MODE ============
        function openCAMPanel() {
            const panel = document.getElementById('cam-panel');
            if (panel) {
                panel.classList.add('active');
                refreshCAMStatus();
                addLog('[CAM] Opened Crisis Automation Mode panel');
            }
        }
        
        async function triggerEmergencyStop() {
            if (!confirm('âš ï¸ CONFERMI EMERGENCY STOP?\n\nQuesto bloccherÃ  tutte le automazioni attive.')) {
                return;
            }
            
            addLog('[CAM] ðŸš¨ EMERGENCY STOP TRIGGERED');
            addSystemMessage('ðŸš¨ EMERGENCY STOP ATTIVATO - Tutte le automazioni bloccate', 'error');
            
            try {
                const response = await fetch(`${API_BASE}/api/cam/emergency-stop`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' }
                });
                
                if (response.ok) {
                    const data = await response.json();
                    addSystemMessage(`âœ… ${data.message}`, 'success');
                    
                    // Update UI
                    updateCAMUIAfterStop();
                } else {
                    addSystemMessage('âš ï¸ Emergency Stop: errore server', 'warning');
                }
            } catch (error) {
                console.error('Emergency stop error:', error);
                addSystemMessage('âš ï¸ Emergency Stop locale attivato (server non raggiungibile)', 'warning');
                updateCAMUIAfterStop();
            }
        }
        
        function updateCAMUIAfterStop() {
            // Update layer statuses visually
            document.querySelectorAll('.cam-layer-card .layer-status').forEach(el => {
                el.textContent = 'â¹ï¸ STOPPED';
                el.style.background = 'rgba(255,51,102,0.2)';
                el.style.borderColor = 'rgba(255,51,102,0.3)';
                el.style.color = '#ff3366';
            });
            
            // Update status indicator
            const statusDot = document.getElementById('cam-status-dot');
            if (statusDot) statusDot.classList.add('engaged');
            
            // Update level display
            const levelDisplay = document.getElementById('cam-level-display');
            if (levelDisplay) {
                levelDisplay.textContent = 'STOPPED';
                levelDisplay.style.background = 'rgba(255,51,102,0.2)';
                levelDisplay.style.borderColor = '#ff3366';
                levelDisplay.style.color = '#ff3366';
            }
            
            // Update panel status
            const statusText = document.querySelector('.cam-status-text');
            if (statusText) statusText.textContent = 'STOPPED';
            
            const statusIcon = document.querySelector('.cam-status-icon');
            if (statusIcon) statusIcon.textContent = 'ðŸ”´';
        }
        
        async function refreshCAMStatus() {
            addLog('[CAM] Refreshing status...');
            
            try {
                const response = await fetch(`${API_BASE}/api/cam/status`);
                if (response.ok) {
                    const data = await response.json();
                    updateCAMUI(data);
                    addLog('[CAM] Status updated from server');
                } else {
                    updateCAMUI(getDefaultCAMStatus());
                }
            } catch (error) {
                console.error('CAM status error:', error);
                updateCAMUI(getDefaultCAMStatus());
            }
        }
        
        function getDefaultCAMStatus() {
            return {
                status: 'MONITORING',
                crisis_level: 'NONE',
                autonomy_percentage: 100,
                control_state: 'NORMAL',
                layers_active: 6,
                last_check: new Date().toISOString()
            };
        }
        
        function updateCAMUI(data) {
            // Update sidebar indicator
            const statusDot = document.getElementById('cam-status-dot');
            if (statusDot) {
                statusDot.classList.remove('engaged', 'recovery');
                if (data.status === 'STOPPED' || data.status === 'CRISIS') {
                    statusDot.classList.add('engaged');
                } else if (data.status === 'RECOVERY' || data.status === 'ALERT') {
                    statusDot.classList.add('recovery');
                }
            }
            
            // Update sidebar level display
            const levelDisplay = document.getElementById('cam-level-display');
            if (levelDisplay) {
                levelDisplay.textContent = data.status || 'MONITORING';
                levelDisplay.style.background = getStatusColor(data.status, 0.2);
                levelDisplay.style.borderColor = getStatusColor(data.status, 1);
                levelDisplay.style.color = getStatusColor(data.status, 1);
            }
            
            // Update panel status
            const statusText = document.querySelector('.cam-status-text');
            if (statusText) statusText.textContent = data.status || 'MONITORING';
            
            const statusIcon = document.querySelector('.cam-status-icon');
            if (statusIcon) {
                statusIcon.textContent = data.status === 'MONITORING' ? 'ðŸŸ¢' : 
                                        data.status === 'ALERT' ? 'ðŸŸ¡' :
                                        data.status === 'CRISIS' ? 'ðŸ”´' :
                                        data.status === 'STOPPED' ? 'â›”' : 'ðŸŸ¢';
            }
            
            // Update detail values in panel
            const crisisLevel = document.getElementById('cam-crisis-level');
            if (crisisLevel) crisisLevel.textContent = data.crisis_level || 'NONE';
            
            const autonomy = document.getElementById('cam-autonomy');
            if (autonomy) autonomy.textContent = `${data.autonomy_percentage || 100}%`;
            
            const controlState = document.getElementById('cam-control-state');
            if (controlState) controlState.textContent = data.control_state || 'NORMAL';
        }
        
        function getStatusColor(status, alpha) {
            const colors = {
                'MONITORING': `rgba(0,255,136,${alpha})`,
                'ALERT': `rgba(255,200,0,${alpha})`,
                'CRISIS': `rgba(255,51,102,${alpha})`,
                'STOPPED': `rgba(255,0,0,${alpha})`,
                'RECOVERY': `rgba(0,200,255,${alpha})`
            };
            return colors[status] || colors['MONITORING'];
        }
        
        async function viewCAMAuditLog() {
            addLog('[CAM] Loading audit log...');
            
            try {
                const response = await fetch(`${API_BASE}/api/cam/audit-log?limit=20`);
                if (response.ok) {
                    const data = await response.json();
                    closePanel('cam-panel');
                    
                    addSystemMessage('ðŸ“‹ CAM AUDIT LOG - Ultime attivitÃ :', 'info');
                    
                    if (data.entries && data.entries.length > 0) {
                        data.entries.reverse().slice(0, 10).forEach(entry => {
                            const time = new Date(entry.timestamp).toLocaleTimeString('it-IT');
                            addSystemMessage(`â€¢ [${time}] ${entry.action}: ${entry.details}`);
                        });
                    } else {
                        addSystemMessage('â€¢ Nessuna attivitÃ  recente');
                    }
                } else {
                    showLocalAuditLog();
                }
            } catch (error) {
                console.error('Audit log error:', error);
                showLocalAuditLog();
            }
        }
        
        function showLocalAuditLog() {
            closePanel('cam-panel');
            addSystemMessage('ðŸ“‹ CAM Audit Log - Stato locale:', 'info');
            addSystemMessage(`â€¢ [${new Date().toLocaleTimeString()}] Sistema CAM operativo`);
            addSystemMessage('â€¢ Livello minaccia: BASSO');
            addSystemMessage('â€¢ Tutti i layer attivi e monitorati');
        }
        
        async function showCAMLayer(layerName) {
            addLog(`[CAM] Viewing Layer: ${layerName}`);
            
            try {
                const response = await fetch(`${API_BASE}/api/cam/layer/${layerName}`);
                if (response.ok) {
                    const data = await response.json();
                    closePanel('cam-panel');
                    
                    addSystemMessage(`\n${data.details.description}\n`, 'info');
                    addSystemMessage(`Status: ${data.status}`);
                    
                    // Show layer-specific details
                    Object.entries(data.details).forEach(([key, value]) => {
                        if (key !== 'description') {
                            addSystemMessage(`â€¢ ${key}: ${JSON.stringify(value)}`);
                        }
                    });
                } else {
                    showLocalLayerInfo(layerName);
                }
            } catch (error) {
                console.error('Layer info error:', error);
                showLocalLayerInfo(layerName);
            }
        }
        
        function showLocalLayerInfo(layerName) {
            const layerInfo = {
                'detection': 'ðŸ” DETECTION LAYER\nAnalisi continua minacce e anomalie.\nâœ… Attivo e monitorando',
                'control': 'âš™ï¸ CONTROL LAYER\nGoverna autonomia e potenza del sistema.\nâœ… Autonomia al 100%',
                'reasoning': 'ðŸ§  REASONING LAYER\nMulti-path analysis per decisioni complesse.\nâœ… Pronto per analisi',
                'automation': 'ðŸ¤– AUTOMATION LAYER\nGestisce automazioni con limiti di sicurezza.\nâœ… Nessun task attivo',
                'human': 'ðŸ‘¤ HUMAN INTERFACE LAYER\nAnti-panico UI e verifica umana.\nâœ… Interfaccia normale',
                'recovery': 'ðŸ”„ RECOVERY LAYER\nPost-crisi e lessons learned.\nâ¸ï¸ In standby'
            };
            
            closePanel('cam-panel');
            addSystemMessage(layerInfo[layerName] || `Layer ${layerName} non trovato`, 'info');
        }
        
        async function resumeCAMOperations() {
            try {
                const response = await fetch(`${API_BASE}/api/cam/resume`, {
                    method: 'POST'
                });
                
                if (response.ok) {
                    const data = await response.json();
                    addSystemMessage(`âœ… ${data.message}`, 'success');
                    refreshCAMStatus();
                    
                    // Reset layer statuses visually
                    document.querySelectorAll('.cam-layer-card .layer-status').forEach((el, i) => {
                        const statuses = ['Active', 'Active', 'Ready', 'Ready', 'Active', 'Standby'];
                        el.textContent = statuses[i];
                        el.style.background = 'rgba(0,255,136,0.2)';
                        el.style.borderColor = 'rgba(0,255,136,0.3)';
                        el.style.color = 'var(--neon-green)';
                    });
                }
            } catch (error) {
                addSystemMessage('âš ï¸ Errore nel ripristino operazioni', 'error');
            }
        }

        // ============ SCIENCE TOOLS ============
        function runScienceTool(tool) {
            addLog(`[SCIENCE] Running ${tool} tool`);
            closePanel('science-panel');
            
            const toolMessages = {
                data_analysis: 'ðŸ“Š Avvio Data Analysis Engine... Carica un dataset per iniziare.',
                genomics: 'ðŸ§¬ Genomics Lab pronto. Inserisci una sequenza genetica o carica un file FASTA.',
                climate: 'ðŸŒ¡ï¸ Climate Modeling attivo. Seleziona parametri per la simulazione.',
                physics: 'âš›ï¸ Physics Simulator inizializzato. Descrivi lo scenario da simulare.',
                astronomy: 'ðŸ”­ Astronomy Tools connessi. Database celeste caricato.',
                chemistry: 'ðŸ§ª Chemistry Lab pronto. Inserisci una formula molecolare o nome composto.'
            };
            
            addSystemMessage(toolMessages[tool] || `ðŸ”¬ Tool ${tool} avviato`);
            if (state.isTTSEnabled) speak(toolMessages[tool]);
        }
        
        function runMedicalTool(tool) {
            addLog(`[MEDICAL] Running ${tool} tool`);
            closePanel('medical-panel');
            
            const toolMessages = {
                diagnostics: 'ðŸ©º Diagnostica AI pronta. Descrivi i sintomi del paziente.',
                biometry: 'ðŸ«€ Biometria attiva. Connetti un dispositivo o inserisci i dati vitali.',
                neuro: 'ðŸ§  Neuroimaging analysis ready. Carica immagini MRI/CT.',
                pharma: 'ðŸ’Š Database farmacologico caricato. Cerca un farmaco o verifica interazioni.',
                epidemiology: 'ðŸ¦  Epidemiology tracker attivo. Seleziona area geografica.',
                telemedicine: 'ðŸ“± Telemedicina connessa. Avvia una nuova sessione.'
            };
            
            addSystemMessage(toolMessages[tool] || `ðŸ¥ Tool ${tool} avviato`);
            if (state.isTTSEnabled) speak(toolMessages[tool]);
        }
        
        function runSecurityTool(tool) {
            addLog(`[SECURITY] Running ${tool} tool`);
            closePanel('security-panel');
            
            const toolMessages = {
                video_analytics: 'ðŸ“¹ Video Analytics attivo. Stream CCTV in analisi.',
                threat_detection: 'ðŸš¨ Threat Detection scanning... Nessuna minaccia rilevata.',
                geo_tracking: 'ðŸ—ºï¸ GeoTracking attivo. Mappa caricata.',
                emergency: 'ðŸš’ Emergency Response System online. Risorse pronte.',
                disaster: 'ðŸŒŠ Disaster Prediction monitoring active.',
                access_control: 'ðŸ” Access Control System connesso.'
            };
            
            addSystemMessage(toolMessages[tool] || `ðŸ›¡ï¸ Tool ${tool} avviato`);
            if (state.isTTSEnabled) speak(toolMessages[tool]);
        }
        
        function runMilitaryTool(tool) {
            addLog(`[MILITARY] Running ${tool} tool`);
            closePanel('military-panel');
            
            const toolMessages = {
                sigint: 'ðŸ›°ï¸ SIGINT Analysis attiva. Canali in monitoraggio.',
                tactical: 'ðŸŽ¯ Tactical AI pronto. Definisci scenario operativo.',
                cyber: 'ðŸ–¥ï¸ Cyber Defense attiva. Perimetro protetto.',
                c4isr: 'ðŸ“¡ C4ISR Network connessa. Tutti i nodi operativi.',
                intel_fusion: 'ðŸ—„ï¸ Intelligence Fusion Engine online. Fonti aggregate.',
                drone: 'ðŸš€ Drone Control ready. Seleziona unitÃ .'
            };
            
            addSystemMessage(toolMessages[tool] || `âš”ï¸ Tool ${tool} avviato`);
            if (state.isTTSEnabled) speak(toolMessages[tool]);
        }
        
        // ============ SCHEDULER FUNCTIONS ============
        let scheduledTasks = [];
        let automationStates = {
            'daily-report': false,
            'backup': false,
            'monitor': true,
            'cleanup': false
        };
        
        function scheduleTask() {
            const taskInput = document.getElementById('schedule-task');
            const datetimeInput = document.getElementById('schedule-datetime');
            const repeatSelect = document.getElementById('schedule-repeat');
            
            const taskDesc = taskInput.value.trim();
            const datetime = datetimeInput.value;
            const repeat = repeatSelect.value;
            
            if (!taskDesc) {
                addSystemMessage('âš ï¸ Inserisci una descrizione per il task');
                return;
            }
            
            if (!datetime) {
                addSystemMessage('âš ï¸ Seleziona una data e ora per il task');
                return;
            }
            
            const task = {
                id: Date.now(),
                description: taskDesc,
                datetime: datetime,
                repeat: repeat,
                created: new Date().toISOString()
            };
            
            scheduledTasks.push(task);
            updateScheduledTasksList();
            
            // Clear inputs
            taskInput.value = '';
            datetimeInput.value = '';
            repeatSelect.value = 'once';
            
            const repeatText = {
                once: 'una volta',
                daily: 'giornaliero',
                weekly: 'settimanale',
                monthly: 'mensile'
            };
            
            addSystemMessage(`ðŸ“… Task schedulato: "${taskDesc}" - ${new Date(datetime).toLocaleString('it-IT')} (${repeatText[repeat]})`);
            addLog(`[SCHEDULER] Task created: ${taskDesc}`);
            
            if (state.isTTSEnabled) speak(`Task programmato per ${new Date(datetime).toLocaleString('it-IT')}`);
        }
        
        function updateScheduledTasksList() {
            const container = document.getElementById('scheduled-tasks-list');
            if (!container) return;
            
            if (scheduledTasks.length === 0) {
                container.innerHTML = '<div class="empty-scheduler">Nessun task programmato</div>';
                return;
            }
            
            const repeatLabels = {
                once: 'â±ï¸ Una volta',
                daily: 'ðŸ”„ Giornaliero',
                weekly: 'ðŸ“… Settimanale',
                monthly: 'ðŸ“† Mensile'
            };
            
            container.innerHTML = scheduledTasks.map(task => `
                <div class="scheduled-task-item">
                    <div class="task-info">
                        <div class="task-name">${task.description}</div>
                        <div class="task-time">${new Date(task.datetime).toLocaleString('it-IT')} - ${repeatLabels[task.repeat]}</div>
                    </div>
                    <button class="task-delete" onclick="deleteScheduledTask(${task.id})">ðŸ—‘ï¸</button>
                </div>
            `).join('');
        }
        
        function deleteScheduledTask(taskId) {
            scheduledTasks = scheduledTasks.filter(t => t.id !== taskId);
            updateScheduledTasksList();
            addSystemMessage('ðŸ—‘ï¸ Task rimosso dalla programmazione');
            addLog('[SCHEDULER] Task deleted');
        }
        
        function toggleAutomation(automation) {
            automationStates[automation] = !automationStates[automation];
            const statusEl = document.getElementById(`auto-${automation}`);
            
            if (statusEl) {
                statusEl.textContent = automationStates[automation] ? 'ON' : 'OFF';
                statusEl.className = `automation-status ${automationStates[automation] ? 'on' : ''}`;
            }
            
            const automationNames = {
                'daily-report': 'Daily Report',
                'backup': 'Auto Backup',
                'monitor': 'System Monitor',
                'cleanup': 'Auto Cleanup'
            };
            
            const status = automationStates[automation] ? 'attivata' : 'disattivata';
            addSystemMessage(`ðŸ¤– Automazione "${automationNames[automation]}" ${status}`);
            addLog(`[SCHEDULER] Automation ${automation} ${status}`);
            
            if (state.isTTSEnabled) speak(`Automazione ${automationNames[automation]} ${status}`);
        }

        // ============ AI SERVICES ============
        function openAIService(service) {
            addLog(`[AI] Opening ${service} service`);
            
            const servicePrompts = {
                veo: 'Descrivi il video che vuoi generare con Veo 3.1:',
                sora: 'Descrivi il video che vuoi creare con Sora 2:',
                luma: 'Descrivi la scena video per Luma Dream:',
                seedream: 'Descrivi l\'immagine per Seedream 3.0:',
                seedvr: 'Descrivi la scena VR 360Â° per SeedVR:',
                dalle: 'Descrivi l\'immagine per DALL-E 3:',
                suno: 'Descrivi la musica che vuoi generare:',
                udio: 'Descrivi il brano musicale per Udio:',
                openrouter: 'Quale modello AI vuoi utilizzare?'
            };
            
            const prompt = servicePrompts[service];
            if (prompt) {
                const input = document.getElementById('chat-input');
                input.value = `[${service.toUpperCase()}] `;
                input.focus();
                addSystemMessage(`ðŸš€ ${service.toUpperCase()} attivo. ${prompt}`);
                if (state.isTTSEnabled) speak(prompt);
            }
        }
        
        // ============ GITHUB INTEGRATION ============
        function openGitHubPanel() {
            document.getElementById('github-panel').classList.add('active');
            checkGitHubConnection();
            addLog('[GITHUB] Pannello GitHub aperto');
        }
        
        async function checkGitHubStatus() {
            const indicator = document.getElementById('github-status-indicator');
            const statusText = document.getElementById('github-status-text');
            indicator.style.display = 'block';
            statusText.textContent = 'â³ Verificando...';
            
            try {
                const response = await fetch(`${API_BASE}/api/github/status`);
                const data = await response.json();
                
                if (data.configured && data.authenticated) {
                    statusText.innerHTML = `âœ… Connesso come <b>${data.user || 'user'}</b>`;
                    statusText.style.color = 'var(--neon-green)';
                } else {
                    statusText.textContent = 'âš ï¸ Token non configurato';
                    statusText.style.color = 'var(--neon-yellow)';
                }
            } catch (error) {
                statusText.textContent = 'âŒ Errore connessione';
                statusText.style.color = 'var(--neon-red)';
            }
        }
        
        async function checkGitHubConnection() {
            const statusIcon = document.getElementById('gh-status-icon');
            const statusText = document.getElementById('gh-status-text');
            const userInfo = document.getElementById('gh-user-info');
            
            try {
                const response = await fetch(`${API_BASE}/api/github/status`);
                const data = await response.json();
                
                if (data.configured && data.authenticated) {
                    statusIcon.textContent = 'âœ…';
                    statusText.textContent = 'Connesso a GitHub';
                    statusText.style.color = 'var(--neon-green)';
                    userInfo.style.display = 'block';
                    document.getElementById('gh-username').textContent = data.user || 'user';
                    
                    // Annuncia con voce
                    if (state.isTTSEnabled) {
                        speak(`GitHub connesso. Bentornato ${data.user || ''}.`);
                    }
                } else {
                    statusIcon.textContent = 'âš ï¸';
                    statusText.textContent = 'Token GitHub non configurato. Aggiungi GITHUB_TOKEN nel file .env';
                    statusText.style.color = 'var(--neon-yellow)';
                }
            } catch (error) {
                statusIcon.textContent = 'âŒ';
                statusText.textContent = 'Impossibile connettersi al backend';
                statusText.style.color = 'var(--neon-red)';
            }
        }
        
        async function gitHubAction(action) {
            const resultsArea = document.getElementById('github-results');
            const resultsContent = document.getElementById('github-results-content');
            resultsArea.style.display = 'block';
            resultsContent.innerHTML = '<span style="color: var(--neon-cyan);">â³ Caricamento...</span>';
            
            try {
                switch(action) {
                    case 'list_repos':
                        await listGitHubRepos();
                        break;
                    case 'create_repo':
                        promptCreateRepo();
                        break;
                    case 'issues':
                        promptSelectRepoForIssues();
                        break;
                    case 'gists':
                        promptCreateGist();
                        break;
                    case 'pull_requests':
                        await listPullRequests();
                        break;
                    case 'search':
                        promptGitHubSearch();
                        break;
                }
            } catch (error) {
                resultsContent.innerHTML = `<span style="color: var(--neon-red);">âŒ Errore: ${error.message}</span>`;
                addLog(`[GITHUB] Errore: ${error.message}`);
            }
        }
        
        async function listGitHubRepos() {
            const resultsContent = document.getElementById('github-results-content');
            
            const response = await fetch(`${API_BASE}/api/github/user/repos?per_page=20`);
            const repos = await response.json();
            
            if (repos.error) {
                resultsContent.innerHTML = `<span style="color: var(--neon-red);">âŒ ${repos.error}</span>`;
                return;
            }
            
            let html = '<div style="display: flex; flex-direction: column; gap: 10px;">';
            for (const repo of repos) {
                html += `
                    <div style="padding: 10px; background: rgba(110,84,148,0.1); border-radius: 8px; border: 1px solid rgba(110,84,148,0.3);">
                        <div style="display: flex; justify-content: space-between; align-items: center;">
                            <div>
                                <b style="color: var(--neon-cyan);">ðŸ“¦ ${repo.name}</b>
                                ${repo.private ? '<span style="color: var(--neon-yellow); font-size: 0.8em; margin-left: 5px;">ðŸ”’ Privato</span>' : ''}
                            </div>
                            <div style="font-size: 0.8em; color: rgba(255,255,255,0.5);">
                                â­ ${repo.stargazers_count || 0} | ðŸ”€ ${repo.forks_count || 0}
                            </div>
                        </div>
                        <div style="font-size: 0.85em; color: rgba(255,255,255,0.6); margin-top: 5px;">
                            ${repo.description || 'Nessuna descrizione'}
                        </div>
                        <div style="margin-top: 8px; display: flex; gap: 5px;">
                            <button class="service-btn" style="padding: 3px 10px; font-size: 0.75em;" onclick="viewRepoDetails('${repo.owner?.login || ''}', '${repo.name}')">ðŸ“‹ Dettagli</button>
                            <button class="service-btn" style="padding: 3px 10px; font-size: 0.75em;" onclick="askGideonGitHub('Mostrami le issues del repository ${repo.name}')">ðŸ“ Issues</button>
                        </div>
                    </div>
                `;
            }
            html += '</div>';
            resultsContent.innerHTML = html;
            
            // Annuncia con voce
            if (state.isTTSEnabled) {
                speak(`Ho trovato ${repos.length} repository. I piÃ¹ recenti sono ${repos.slice(0,3).map(r => r.name).join(', ')}.`);
            }
            
            addLog(`[GITHUB] Elencati ${repos.length} repository`);
        }
        
        function promptCreateRepo() {
            const resultsContent = document.getElementById('github-results-content');
            resultsContent.innerHTML = `
                <div style="display: flex; flex-direction: column; gap: 15px;">
                    <div style="color: var(--neon-cyan); font-weight: bold;">âž• Crea Nuovo Repository</div>
                    <input type="text" id="new-repo-name" placeholder="Nome repository" style="
                        background: rgba(0,0,0,0.5);
                        border: 1px solid var(--glass-border);
                        border-radius: 8px;
                        padding: 10px;
                        color: #fff;
                    ">
                    <input type="text" id="new-repo-desc" placeholder="Descrizione (opzionale)" style="
                        background: rgba(0,0,0,0.5);
                        border: 1px solid var(--glass-border);
                        border-radius: 8px;
                        padding: 10px;
                        color: #fff;
                    ">
                    <div style="display: flex; gap: 10px; align-items: center;">
                        <label style="display: flex; align-items: center; gap: 5px; cursor: pointer;">
                            <input type="checkbox" id="new-repo-private"> Privato
                        </label>
                        <label style="display: flex; align-items: center; gap: 5px; cursor: pointer;">
                            <input type="checkbox" id="new-repo-readme" checked> Con README
                        </label>
                    </div>
                    <button onclick="createGitHubRepo()" style="
                        background: linear-gradient(135deg, #6e5494, #8b5cf6);
                        border: none;
                        color: #fff;
                        padding: 12px;
                        border-radius: 8px;
                        cursor: pointer;
                        font-weight: bold;
                    ">ðŸš€ CREA REPOSITORY</button>
                </div>
            `;
            
            if (state.isTTSEnabled) {
                speak('Inserisci il nome e la descrizione del nuovo repository.');
            }
        }
        
        async function createGitHubRepo() {
            const name = document.getElementById('new-repo-name').value.trim();
            const description = document.getElementById('new-repo-desc').value.trim();
            const isPrivate = document.getElementById('new-repo-private').checked;
            const autoInit = document.getElementById('new-repo-readme').checked;
            
            if (!name) {
                addSystemMessage('âš ï¸ Inserisci un nome per il repository');
                return;
            }
            
            const resultsContent = document.getElementById('github-results-content');
            resultsContent.innerHTML = '<span style="color: var(--neon-cyan);">â³ Creazione repository...</span>';
            
            try {
                const response = await fetch(`${API_BASE}/api/github/repos/create`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        name,
                        description,
                        private: isPrivate,
                        auto_init: autoInit
                    })
                });
                
                const data = await response.json();
                
                if (data.success) {
                    resultsContent.innerHTML = `
                        <div style="text-align: center; padding: 20px;">
                            <div style="font-size: 3em;">âœ…</div>
                            <div style="color: var(--neon-green); font-size: 1.2em; margin-top: 10px;">Repository creato!</div>
                            <div style="color: rgba(255,255,255,0.7); margin-top: 5px;">ðŸ“¦ ${name}</div>
                            <a href="${data.repo?.html_url || '#'}" target="_blank" style="
                                display: inline-block;
                                margin-top: 15px;
                                background: linear-gradient(135deg, #6e5494, #8b5cf6);
                                color: #fff;
                                padding: 10px 20px;
                                border-radius: 20px;
                                text-decoration: none;
                            ">ðŸ”— Apri su GitHub</a>
                        </div>
                    `;
                    
                    addLog(`[GITHUB] Repository ${name} creato con successo`);
                    addSystemMessage(`âœ… Repository "${name}" creato con successo!`);
                    
                    if (state.isTTSEnabled) {
                        speak(`Perfetto! Ho creato il repository ${name} su GitHub.`);
                    }
                } else {
                    throw new Error(data.detail || 'Errore creazione');
                }
            } catch (error) {
                resultsContent.innerHTML = `<span style="color: var(--neon-red);">âŒ Errore: ${error.message}</span>`;
                if (state.isTTSEnabled) {
                    speak(`Mi dispiace, c'Ã¨ stato un errore nella creazione del repository.`);
                }
            }
        }
        
        function promptCreateGist() {
            const resultsContent = document.getElementById('github-results-content');
            resultsContent.innerHTML = `
                <div style="display: flex; flex-direction: column; gap: 15px;">
                    <div style="color: var(--neon-cyan); font-weight: bold;">ðŸ“ Crea Nuovo Gist</div>
                    <input type="text" id="gist-filename" placeholder="Nome file (es: script.py)" style="
                        background: rgba(0,0,0,0.5);
                        border: 1px solid var(--glass-border);
                        border-radius: 8px;
                        padding: 10px;
                        color: #fff;
                    ">
                    <input type="text" id="gist-desc" placeholder="Descrizione (opzionale)" style="
                        background: rgba(0,0,0,0.5);
                        border: 1px solid var(--glass-border);
                        border-radius: 8px;
                        padding: 10px;
                        color: #fff;
                    ">
                    <textarea id="gist-content" placeholder="Contenuto del file..." rows="8" style="
                        background: rgba(0,0,0,0.5);
                        border: 1px solid var(--glass-border);
                        border-radius: 8px;
                        padding: 10px;
                        color: #fff;
                        font-family: 'JetBrains Mono', monospace;
                        resize: vertical;
                    "></textarea>
                    <label style="display: flex; align-items: center; gap: 5px; cursor: pointer;">
                        <input type="checkbox" id="gist-public"> Pubblico
                    </label>
                    <button onclick="createGist()" style="
                        background: linear-gradient(135deg, #6e5494, #8b5cf6);
                        border: none;
                        color: #fff;
                        padding: 12px;
                        border-radius: 8px;
                        cursor: pointer;
                        font-weight: bold;
                    ">ðŸ“¤ CREA GIST</button>
                </div>
            `;
            
            if (state.isTTSEnabled) {
                speak('Inserisci il nome del file e il contenuto per creare un nuovo gist.');
            }
        }
        
        async function createGist() {
            const filename = document.getElementById('gist-filename').value.trim();
            const description = document.getElementById('gist-desc').value.trim();
            const content = document.getElementById('gist-content').value;
            const isPublic = document.getElementById('gist-public').checked;
            
            if (!filename || !content) {
                addSystemMessage('âš ï¸ Nome file e contenuto sono obbligatori');
                return;
            }
            
            const resultsContent = document.getElementById('github-results-content');
            resultsContent.innerHTML = '<span style="color: var(--neon-cyan);">â³ Creazione gist...</span>';
            
            try {
                const response = await fetch(`${API_BASE}/api/github/gists`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        filename,
                        content,
                        description,
                        public: isPublic
                    })
                });
                
                const data = await response.json();
                
                if (data.html_url) {
                    resultsContent.innerHTML = `
                        <div style="text-align: center; padding: 20px;">
                            <div style="font-size: 3em;">âœ…</div>
                            <div style="color: var(--neon-green); font-size: 1.2em; margin-top: 10px;">Gist creato!</div>
                            <a href="${data.html_url}" target="_blank" style="
                                display: inline-block;
                                margin-top: 15px;
                                background: linear-gradient(135deg, #6e5494, #8b5cf6);
                                color: #fff;
                                padding: 10px 20px;
                                border-radius: 20px;
                                text-decoration: none;
                            ">ðŸ”— Apri Gist</a>
                        </div>
                    `;
                    
                    if (state.isTTSEnabled) {
                        speak(`Gist creato con successo!`);
                    }
                } else {
                    throw new Error(data.error || 'Errore creazione');
                }
            } catch (error) {
                resultsContent.innerHTML = `<span style="color: var(--neon-red);">âŒ Errore: ${error.message}</span>`;
            }
        }
        
        function promptSelectRepoForIssues() {
            const resultsContent = document.getElementById('github-results-content');
            resultsContent.innerHTML = `
                <div style="display: flex; flex-direction: column; gap: 15px;">
                    <div style="color: var(--neon-cyan); font-weight: bold;">ðŸ“‹ Gestione Issues</div>
                    <input type="text" id="issue-owner" placeholder="Owner (es: tuousername)" style="
                        background: rgba(0,0,0,0.5);
                        border: 1px solid var(--glass-border);
                        border-radius: 8px;
                        padding: 10px;
                        color: #fff;
                    ">
                    <input type="text" id="issue-repo" placeholder="Repository" style="
                        background: rgba(0,0,0,0.5);
                        border: 1px solid var(--glass-border);
                        border-radius: 8px;
                        padding: 10px;
                        color: #fff;
                    ">
                    <button onclick="loadRepoIssues()" style="
                        background: linear-gradient(135deg, #6e5494, #8b5cf6);
                        border: none;
                        color: #fff;
                        padding: 12px;
                        border-radius: 8px;
                        cursor: pointer;
                        font-weight: bold;
                    ">ðŸ“¥ CARICA ISSUES</button>
                </div>
            `;
        }
        
        async function loadRepoIssues() {
            const owner = document.getElementById('issue-owner').value.trim();
            const repo = document.getElementById('issue-repo').value.trim();
            
            if (!owner || !repo) {
                addSystemMessage('âš ï¸ Inserisci owner e repository');
                return;
            }
            
            const resultsContent = document.getElementById('github-results-content');
            resultsContent.innerHTML = '<span style="color: var(--neon-cyan);">â³ Caricamento issues...</span>';
            
            try {
                const response = await fetch(`${API_BASE}/api/github/repos/${owner}/${repo}/issues?state=all&per_page=20`);
                const issues = await response.json();
                
                if (issues.error) {
                    throw new Error(issues.error);
                }
                
                let html = `<div style="margin-bottom: 15px; display: flex; justify-content: space-between; align-items: center;">
                    <span style="color: var(--neon-cyan);">ðŸ“‹ Issues di ${owner}/${repo}</span>
                    <button class="service-btn" style="padding: 5px 15px;" onclick="promptCreateIssue('${owner}', '${repo}')">âž• Nuova Issue</button>
                </div>`;
                html += '<div style="display: flex; flex-direction: column; gap: 8px;">';
                
                for (const issue of issues) {
                    const stateColor = issue.state === 'open' ? 'var(--neon-green)' : 'var(--neon-red)';
                    html += `
                        <div style="padding: 10px; background: rgba(0,0,0,0.3); border-radius: 8px; border-left: 3px solid ${stateColor};">
                            <div style="display: flex; justify-content: space-between;">
                                <span><b>#${issue.number}</b> ${issue.title}</span>
                                <span style="color: ${stateColor}; font-size: 0.8em;">${issue.state.toUpperCase()}</span>
                            </div>
                        </div>
                    `;
                }
                html += '</div>';
                resultsContent.innerHTML = html;
                
                if (state.isTTSEnabled) {
                    const openCount = issues.filter(i => i.state === 'open').length;
                    speak(`Ho trovato ${issues.length} issues, di cui ${openCount} aperte.`);
                }
            } catch (error) {
                resultsContent.innerHTML = `<span style="color: var(--neon-red);">âŒ ${error.message}</span>`;
            }
        }
        
        function promptCreateIssue(owner, repo) {
            const resultsContent = document.getElementById('github-results-content');
            resultsContent.innerHTML = `
                <div style="display: flex; flex-direction: column; gap: 15px;">
                    <div style="color: var(--neon-cyan); font-weight: bold;">âž• Nuova Issue per ${owner}/${repo}</div>
                    <input type="text" id="new-issue-title" placeholder="Titolo issue" style="
                        background: rgba(0,0,0,0.5); border: 1px solid var(--glass-border);
                        border-radius: 8px; padding: 12px; color: #fff;
                    ">
                    <textarea id="new-issue-body" placeholder="Descrizione issue (opzionale)..." style="
                        background: rgba(0,0,0,0.5); border: 1px solid var(--glass-border);
                        border-radius: 8px; padding: 12px; color: #fff; min-height: 100px; resize: vertical;
                    "></textarea>
                    <button onclick="createIssue('${owner}', '${repo}')" style="
                        background: linear-gradient(135deg, #6e5494, #8b5cf6);
                        border: none; color: #fff; padding: 12px;
                        border-radius: 8px; cursor: pointer; font-weight: bold;
                    ">ðŸ“ CREA ISSUE</button>
                </div>
            `;
        }
        
        async function createIssue(owner, repo) {
            const title = document.getElementById('new-issue-title').value.trim();
            const body = document.getElementById('new-issue-body').value.trim();
            
            if (!title) {
                addSystemMessage('âš ï¸ Inserisci un titolo per la issue!');
                return;
            }
            
            const resultsContent = document.getElementById('github-results-content');
            resultsContent.innerHTML = '<span style="color: var(--neon-cyan);">â³ Creazione issue...</span>';
            
            try {
                const response = await fetch(`${API_BASE}/api/github/repos/${owner}/${repo}/issues`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ title, body })
                });
                
                const data = await response.json();
                
                if (data.error) {
                    throw new Error(data.error);
                }
                
                resultsContent.innerHTML = `
                    <div style="padding: 15px; background: rgba(0,255,136,0.1); border: 1px solid var(--neon-green); border-radius: 10px;">
                        <div style="color: var(--neon-green); font-weight: bold; margin-bottom: 10px;">âœ… Issue creata con successo!</div>
                        <div><b>#${data.number}</b> - ${data.title}</div>
                        <a href="${data.html_url}" target="_blank" style="color: var(--neon-cyan);">ðŸ”— Apri su GitHub</a>
                    </div>
                `;
                
                if (state.isTTSEnabled) {
                    speak(`Issue creata con successo. Numero ${data.number}.`);
                }
                
                addLog(`[GITHUB] Issue #${data.number} creata su ${owner}/${repo}`);
            } catch (error) {
                resultsContent.innerHTML = `<span style="color: var(--neon-red);">âŒ ${error.message}</span>`;
            }
        }
        
        async function listPullRequests() {
            const resultsContent = document.getElementById('github-results-content');
            resultsContent.innerHTML = `
                <div style="display: flex; flex-direction: column; gap: 15px;">
                    <div style="color: var(--neon-cyan); font-weight: bold;">ðŸ”€ Pull Requests</div>
                    <input type="text" id="pr-owner" placeholder="Owner" style="
                        background: rgba(0,0,0,0.5); border: 1px solid var(--glass-border);
                        border-radius: 8px; padding: 10px; color: #fff;
                    ">
                    <input type="text" id="pr-repo" placeholder="Repository" style="
                        background: rgba(0,0,0,0.5); border: 1px solid var(--glass-border);
                        border-radius: 8px; padding: 10px; color: #fff;
                    ">
                    <button onclick="loadRepoPRs()" style="
                        background: linear-gradient(135deg, #6e5494, #8b5cf6);
                        border: none; color: #fff; padding: 12px;
                        border-radius: 8px; cursor: pointer; font-weight: bold;
                    ">ðŸ“¥ CARICA PRs</button>
                </div>
            `;
        }
        
        async function loadRepoPRs() {
            const owner = document.getElementById('pr-owner').value.trim();
            const repo = document.getElementById('pr-repo').value.trim();
            
            if (!owner || !repo) return;
            
            const resultsContent = document.getElementById('github-results-content');
            resultsContent.innerHTML = '<span style="color: var(--neon-cyan);">â³ Caricamento...</span>';
            
            try {
                const response = await fetch(`${API_BASE}/api/github/repos/${owner}/${repo}/pulls`);
                const prs = await response.json();
                
                let html = '<div style="display: flex; flex-direction: column; gap: 8px;">';
                for (const pr of prs) {
                    html += `
                        <div style="padding: 10px; background: rgba(0,0,0,0.3); border-radius: 8px; border-left: 3px solid var(--neon-magenta);">
                            <div><b>#${pr.number}</b> ${pr.title}</div>
                            <div style="font-size: 0.8em; color: rgba(255,255,255,0.5);">${pr.head?.ref} â†’ ${pr.base?.ref}</div>
                        </div>
                    `;
                }
                html += '</div>';
                resultsContent.innerHTML = html || '<span style="color: rgba(255,255,255,0.5);">Nessuna PR trovata</span>';
                
            } catch (error) {
                resultsContent.innerHTML = `<span style="color: var(--neon-red);">âŒ ${error.message}</span>`;
            }
        }
        
        function promptGitHubSearch() {
            const resultsContent = document.getElementById('github-results-content');
            resultsContent.innerHTML = `
                <div style="display: flex; flex-direction: column; gap: 15px;">
                    <div style="color: var(--neon-cyan); font-weight: bold;">ðŸ” Cerca su GitHub</div>
                    <input type="text" id="github-search-query" placeholder="Cosa vuoi cercare?" style="
                        background: rgba(0,0,0,0.5); border: 1px solid var(--glass-border);
                        border-radius: 8px; padding: 10px; color: #fff;
                    ">
                    <select id="github-search-type" style="
                        background: rgba(0,0,0,0.5); border: 1px solid var(--glass-border);
                        border-radius: 8px; padding: 10px; color: #fff;
                    ">
                        <option value="repositories">Repository</option>
                        <option value="code">Codice</option>
                        <option value="users">Utenti</option>
                    </select>
                    <button onclick="executeGitHubSearch()" style="
                        background: linear-gradient(135deg, #6e5494, #8b5cf6);
                        border: none; color: #fff; padding: 12px;
                        border-radius: 8px; cursor: pointer; font-weight: bold;
                    ">ðŸ”Ž CERCA</button>
                </div>
            `;
            
            if (state.isTTSEnabled) {
                speak('Inserisci la tua ricerca GitHub.');
            }
        }
        
        async function executeGitHubSearch() {
            const query = document.getElementById('github-search-query').value.trim();
            const type = document.getElementById('github-search-type').value;
            
            if (!query) return;
            
            const resultsContent = document.getElementById('github-results-content');
            resultsContent.innerHTML = '<span style="color: var(--neon-cyan);">â³ Ricerca in corso...</span>';
            
            try {
                const response = await fetch(`${API_BASE}/api/github/search/${type}?q=${encodeURIComponent(query)}`);
                const data = await response.json();
                
                let html = `<div style="margin-bottom: 10px; color: rgba(255,255,255,0.5);">Trovati ${data.total_count || 0} risultati</div>`;
                html += '<div style="display: flex; flex-direction: column; gap: 8px;">';
                
                for (const item of (data.items || []).slice(0, 15)) {
                    html += `
                        <div style="padding: 10px; background: rgba(0,0,0,0.3); border-radius: 8px;">
                            <a href="${item.html_url}" target="_blank" style="color: var(--neon-cyan); text-decoration: none;">
                                ${item.full_name || item.login || item.name}
                            </a>
                            <div style="font-size: 0.8em; color: rgba(255,255,255,0.5);">
                                ${item.description || ''}
                            </div>
                        </div>
                    `;
                }
                html += '</div>';
                resultsContent.innerHTML = html;
                
                if (state.isTTSEnabled) {
                    speak(`Ho trovato ${data.total_count || 0} risultati per ${query}.`);
                }
            } catch (error) {
                resultsContent.innerHTML = `<span style="color: var(--neon-red);">âŒ ${error.message}</span>`;
            }
        }
        
        async function viewRepoDetails(owner, repo) {
            const resultsContent = document.getElementById('github-results-content');
            resultsContent.innerHTML = '<span style="color: var(--neon-cyan);">â³ Caricamento dettagli...</span>';
            
            try {
                const response = await fetch(`${API_BASE}/api/github/repos/${owner}/${repo}`);
                const data = await response.json();
                
                resultsContent.innerHTML = `
                    <div style="padding: 15px; background: rgba(110,84,148,0.1); border-radius: 10px;">
                        <div style="font-size: 1.3em; color: var(--neon-cyan); margin-bottom: 15px;">ðŸ“¦ ${data.full_name}</div>
                        <div style="color: rgba(255,255,255,0.7); margin-bottom: 15px;">${data.description || 'Nessuna descrizione'}</div>
                        <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; margin-bottom: 15px;">
                            <div style="text-align: center; padding: 10px; background: rgba(0,0,0,0.3); border-radius: 8px;">
                                <div style="font-size: 1.5em;">â­</div>
                                <div style="font-size: 1.2em; color: var(--neon-yellow);">${data.stargazers_count}</div>
                                <div style="font-size: 0.8em; color: rgba(255,255,255,0.5);">Stars</div>
                            </div>
                            <div style="text-align: center; padding: 10px; background: rgba(0,0,0,0.3); border-radius: 8px;">
                                <div style="font-size: 1.5em;">ðŸ”€</div>
                                <div style="font-size: 1.2em; color: var(--neon-magenta);">${data.forks_count}</div>
                                <div style="font-size: 0.8em; color: rgba(255,255,255,0.5);">Forks</div>
                            </div>
                            <div style="text-align: center; padding: 10px; background: rgba(0,0,0,0.3); border-radius: 8px;">
                                <div style="font-size: 1.5em;">ðŸ‘ï¸</div>
                                <div style="font-size: 1.2em; color: var(--neon-cyan);">${data.watchers_count}</div>
                                <div style="font-size: 0.8em; color: rgba(255,255,255,0.5);">Watchers</div>
                            </div>
                        </div>
                        <div style="display: flex; gap: 10px;">
                            <a href="${data.html_url}" target="_blank" class="service-btn primary" style="text-decoration: none; text-align: center;">ðŸ”— Apri su GitHub</a>
                            <button class="service-btn" onclick="askGideonGitHub('Analizza il repository ${data.full_name}')">ðŸ¤– Chiedi a GIDEON</button>
                        </div>
                    </div>
                `;
                
                if (state.isTTSEnabled) {
                    speak(`Repository ${data.name}. Ha ${data.stargazers_count} stelle e ${data.forks_count} fork.`);
                }
            } catch (error) {
                resultsContent.innerHTML = `<span style="color: var(--neon-red);">âŒ ${error.message}</span>`;
            }
        }
        
        function askGideonGitHub(question) {
            closePanel('github-panel');
            const input = document.getElementById('chat-input');
            input.value = question;
            sendMessage();
            addLog(`[GITHUBâ†’GIDEON] ${question}`);
        }

        // ============ SCHEDULER ============
        let scheduledTasks = [];
        let automations = {
            'daily-report': false,
            'backup': false,
            'monitor': true,
            'cleanup': false
        };
        
        function scheduleTask() {
            const taskInput = document.getElementById('schedule-task');
            const datetimeInput = document.getElementById('schedule-datetime');
            const repeatSelect = document.getElementById('schedule-repeat');
            
            const task = taskInput.value.trim();
            const datetime = datetimeInput.value;
            const repeat = repeatSelect.value;
            
            if (!task) {
                addSystemMessage('âŒ Inserisci una descrizione per il task!');
                return;
            }
            
            if (!datetime) {
                addSystemMessage('âŒ Seleziona data e ora per il task!');
                return;
            }
            
            const newTask = {
                id: Date.now(),
                task: task,
                datetime: datetime,
                repeat: repeat,
                status: 'pending'
            };
            
            scheduledTasks.push(newTask);
            updateScheduledTasksList();
            
            // Clear inputs
            taskInput.value = '';
            datetimeInput.value = '';
            repeatSelect.value = 'once';
            
            const formattedDate = new Date(datetime).toLocaleString('it-IT');
            addLog(`[SCHEDULER] Task scheduled: "${task}" at ${formattedDate}`);
            addSystemMessage(`âœ… Task programmato per il ${formattedDate}: "${task}"`);
            if (state.isTTSEnabled) speak(`Task programmato per il ${formattedDate}`);
            
            // Schedule actual execution
            scheduleExecution(newTask);
        }
        
        function scheduleExecution(task) {
            const now = new Date().getTime();
            const executeAt = new Date(task.datetime).getTime();
            const delay = executeAt - now;
            
            if (delay > 0) {
                setTimeout(() => {
                    executeScheduledTask(task);
                }, delay);
            }
        }
        
        function executeScheduledTask(task) {
            addLog(`[SCHEDULER] Executing task: ${task.task}`);
            addSystemMessage(`â° Esecuzione task programmato: "${task.task}"`);
            if (state.isTTSEnabled) speak(`Esecuzione task: ${task.task}`);
            
            // Update task status
            const taskIndex = scheduledTasks.findIndex(t => t.id === task.id);
            if (taskIndex !== -1) {
                if (task.repeat === 'once') {
                    scheduledTasks[taskIndex].status = 'completed';
                } else {
                    // Reschedule for next occurrence
                    const nextDate = new Date(task.datetime);
                    switch(task.repeat) {
                        case 'daily': nextDate.setDate(nextDate.getDate() + 1); break;
                        case 'weekly': nextDate.setDate(nextDate.getDate() + 7); break;
                        case 'monthly': nextDate.setMonth(nextDate.getMonth() + 1); break;
                    }
                    scheduledTasks[taskIndex].datetime = nextDate.toISOString().slice(0, 16);
                    scheduleExecution(scheduledTasks[taskIndex]);
                }
            }
            updateScheduledTasksList();
            
            // Send to chat for AI processing
            const input = document.getElementById('chat-input');
            input.value = task.task;
            sendMessage();
        }
        
        function updateScheduledTasksList() {
            const list = document.getElementById('scheduled-tasks-list');
            if (!list) return;
            
            if (scheduledTasks.length === 0) {
                list.innerHTML = '<div class="empty-scheduler">Nessun task programmato</div>';
                return;
            }
            
            list.innerHTML = scheduledTasks.map(task => `
                <div class="scheduled-task ${task.status}">
                    <div class="task-info">
                        <div class="task-name">${task.task}</div>
                        <div class="task-time">ðŸ“… ${new Date(task.datetime).toLocaleString('it-IT')} | ðŸ”„ ${task.repeat}</div>
                    </div>
                    <div class="task-actions">
                        <button class="task-btn delete" onclick="deleteScheduledTask(${task.id})">ðŸ—‘ï¸</button>
                    </div>
                </div>
            `).join('');
        }
        
        function deleteScheduledTask(taskId) {
            scheduledTasks = scheduledTasks.filter(t => t.id !== taskId);
            updateScheduledTasksList();
            addLog(`[SCHEDULER] Task deleted: ${taskId}`);
        }
        
        function toggleAutomation(automationId) {
            automations[automationId] = !automations[automationId];
            const statusEl = document.getElementById(`auto-${automationId}`);
            if (statusEl) {
                statusEl.textContent = automations[automationId] ? 'ON' : 'OFF';
                statusEl.style.color = automations[automationId] ? 'var(--neon-green)' : 'var(--neon-red)';
            }
            
            addLog(`[AUTOMATION] ${automationId} ${automations[automationId] ? 'enabled' : 'disabled'}`);
            addSystemMessage(`ðŸ¤– Automazione "${automationId}" ${automations[automationId] ? 'attivata' : 'disattivata'}`);
            
            // Handle specific automations
            if (automationId === 'monitor' && automations[automationId]) {
                addSystemMessage('ðŸ“Š System monitoring avviato. Riceverai report periodici.');
            } else if (automationId === 'daily-report' && automations[automationId]) {
                addSystemMessage('ðŸ“Š Daily report attivato. Riceverai un report ogni giorno alle 9:00.');
            } else if (automationId === 'backup' && automations[automationId]) {
                addSystemMessage('ðŸ’¾ Auto backup attivato. Backup automatico ogni 6 ore.');
            } else if (automationId === 'cleanup' && automations[automationId]) {
                addSystemMessage('ðŸ§¹ Auto cleanup attivato. Pulizia automatica settimanale.');
            }
        }

        // ============ WORKFLOW ============
        function initWorkflow() {
            const canvas = document.getElementById('workflow-canvas');
            
            // Make canvas droppable
            canvas.addEventListener('dragover', (e) => e.preventDefault());
            canvas.addEventListener('drop', handleNodeDrop);
        }
        
        function addWorkflowNode(type) {
            const canvas = document.getElementById('workflow-canvas');
            const nodeId = `node-${++state.nodeIdCounter}`;
            
            const nodeTypes = {
                trigger: { icon: 'âš¡', title: 'TRIGGER', color: 'var(--neon-green)' },
                action: { icon: 'â–¶ï¸', title: 'ACTION', color: 'var(--neon-cyan)' },
                condition: { icon: 'ðŸ”€', title: 'CONDITION', color: 'var(--neon-yellow)' },
                ai: { icon: 'ðŸ¤–', title: 'AI NODE', color: 'var(--neon-magenta)' }
            };
            
            const nodeConfig = nodeTypes[type] || nodeTypes.action;
            
            const node = document.createElement('div');
            node.className = 'workflow-node';
            node.id = nodeId;
            node.style.left = `${50 + state.nodeIdCounter * 30}px`;
            node.style.top = `${100 + state.nodeIdCounter * 20}px`;
            node.innerHTML = `
                <div class="node-header" style="background: linear-gradient(135deg, ${nodeConfig.color}33, transparent);">
                    <span>${nodeConfig.icon}</span>
                    <span>${nodeConfig.title}</span>
                </div>
                <div class="node-body">
                    <small style="color: rgba(255,255,255,0.5);">Click per configurare</small>
                </div>
                <div class="node-port input"></div>
                <div class="node-port output"></div>
            `;
            
            // Make node draggable
            node.draggable = true;
            node.addEventListener('dragstart', handleNodeDragStart);
            node.addEventListener('click', () => selectNode(nodeId));
            
            canvas.appendChild(node);
            state.workflowNodes.push({ id: nodeId, type, config: {} });
            
            addLog(`[WORKFLOW] Added ${type} node`);
        }
        
        function handleNodeDragStart(e) {
            e.dataTransfer.setData('nodeId', e.target.id);
        }
        
        function handleNodeDrop(e) {
            e.preventDefault();
            const nodeId = e.dataTransfer.getData('nodeId');
            const node = document.getElementById(nodeId);
            
            if (node) {
                const rect = e.currentTarget.getBoundingClientRect();
                node.style.left = `${e.clientX - rect.left - 90}px`;
                node.style.top = `${e.clientY - rect.top - 30}px`;
            }
        }
        
        function selectNode(nodeId) {
            document.querySelectorAll('.workflow-node').forEach(n => n.classList.remove('selected'));
            document.getElementById(nodeId)?.classList.add('selected');
        }
        
        function saveWorkflow() {
            const workflowData = JSON.stringify(state.workflowNodes, null, 2);
            addLog('[WORKFLOW] Workflow saved');
            addSystemMessage('ðŸ’¾ Workflow salvato con successo!');
        }
        
        function runWorkflow() {
            if (state.workflowNodes.length === 0) {
                addSystemMessage('âš ï¸ Aggiungi almeno un nodo al workflow prima di eseguirlo.');
                return;
            }
            
            addLog('[WORKFLOW] Executing workflow...');
            addSystemMessage('â–¶ï¸ Esecuzione workflow in corso...');
            
            // Simulate execution
            setTimeout(() => {
                addSystemMessage('âœ… Workflow completato con successo!');
            }, 2000);
        }
        
        // ============ QUICK ACTIONS ============
        async function executeQuickAction(action) {
            addLog(`[ACTION] Executing ${action}`);
            
            try {
                let response;
                
                if (action === 'screenshot') {
                    addSystemMessage('ðŸ“¸ Analisi schermo in corso...');
                    response = await fetch(`${API_BASE}/api/smart/vision/screenshot`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ question: 'Descrivi cosa vedi sullo schermo' })
                    });
                } else if (action === 'camera') {
                    addSystemMessage('ðŸ“· Accesso camera in corso...');
                    response = await fetch(`${API_BASE}/api/smart/vision/camera`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ question: 'Cosa vedi?' })
                    });
                }
                
                if (response?.ok) {
                    const data = await response.json();
                    if (data.analysis) {
                        addMessage(data.analysis, 'assistant');
                        if (state.isTTSEnabled) speak(data.analysis);
                    }
                }
            } catch (error) {
                addSystemMessage(`âš ï¸ Errore: ${error.message}`);
            }
        }
        
        // ============ SYSTEM MONITOR ============
        let monitorInterval = null;
        let actionsCount = 0;
        
        function initMonitor() {
            // Start real-time updates
            updateMonitorTime();
            setInterval(updateMonitorTime, 1000);
            
            // Fetch system data every 3 seconds
            fetchSystemData();
            monitorInterval = setInterval(fetchSystemData, 3000);
            
            // Check services status
            checkServicesStatus();
            setInterval(checkServicesStatus, 10000);
        }
        
        function updateMonitorTime() {
            const now = new Date();
            const timeStr = now.toLocaleTimeString('it-IT');
            const monitorTime = document.getElementById('monitor-time');
            if (monitorTime) monitorTime.textContent = timeStr;
            
            // Update uptime
            const elapsed = Math.floor((Date.now() - state.sessionStartTime) / 1000);
            const minutes = Math.floor(elapsed / 60);
            const hours = Math.floor(minutes / 60);
            const statUptime = document.getElementById('stat-uptime');
            if (statUptime) {
                statUptime.textContent = hours > 0 ? `${hours}h ${minutes % 60}m` : `${minutes}m`;
            }
            
            // Update message count
            const statMessages = document.getElementById('stat-messages');
            if (statMessages) statMessages.textContent = state.messages.length;
            
            // Update actions count
            const statActions = document.getElementById('stat-actions');
            if (statActions) statActions.textContent = actionsCount;
            
            // Update current mode
            const modeDisplay = document.getElementById('current-mode-display');
            const modeDesc = document.getElementById('mode-description');
            if (modeDisplay) {
                modeDisplay.textContent = state.currentMode.toUpperCase();
                const modeDescriptions = {
                    passive: 'Solo osservazione, nessuna azione automatica',
                    copilot: 'Assistenza attiva con conferma utente',
                    pilot: 'Esecuzione autonoma di azioni sicure',
                    executive: 'Controllo totale del sistema'
                };
                if (modeDesc) modeDesc.textContent = modeDescriptions[state.currentMode] || '';
            }
        }
        
        async function fetchSystemData() {
            try {
                const response = await fetch(`${API_BASE}/api/system/load`, { 
                    method: 'GET',
                    timeout: 5000 
                });
                
                if (response.ok) {
                    const data = await response.json();
                    // Il backend ritorna { success, load: {...}, timestamp }
                    const loadData = data.load || data;
                    updateMetrics(loadData);
                }
            } catch (error) {
                // Simulate data if API not available
                updateMetrics({
                    cpu_percent: Math.random() * 30 + 10,
                    cpu_cores: 8,
                    cpu_freq: '3.2 GHz',
                    ram_percent: Math.random() * 20 + 40,
                    ram_used_gb: 8.5,
                    ram_total_gb: 16,
                    disk_percent: 45,
                    disk_used_gb: 250,
                    disk_total_gb: 512,
                    network_download_kbs: Math.random() * 500,
                    network_upload_kbs: Math.random() * 100
                });
            }
        }
        
        function updateMetrics(data) {
            // CPU - supporta formato nuovo e legacy
            const cpuPercent = Math.round(data.cpu_percent || (data.cpu && data.cpu.percent) || data.cpu || 0);
            const cpuCores = data.cpu_cores || (data.cpu && data.cpu.cores) || '?';
            const cpuFreq = data.cpu_freq || (data.cpu && data.cpu.speed) || 'N/A';
            
            const cpuValueEl = document.getElementById('cpu-value');
            const cpuBarEl = document.getElementById('cpu-bar');
            const cpuCoresEl = document.getElementById('cpu-cores');
            const cpuSpeedEl = document.getElementById('cpu-speed');
            
            if (cpuValueEl) cpuValueEl.innerHTML = `${cpuPercent}<span class="metric-unit">%</span>`;
            if (cpuBarEl) cpuBarEl.style.width = `${cpuPercent}%`;
            if (cpuCoresEl) cpuCoresEl.textContent = `Cores: ${cpuCores}`;
            if (cpuSpeedEl) cpuSpeedEl.textContent = `Speed: ${cpuFreq}`;
            
            // RAM - supporta formato nuovo e legacy
            const ramPercent = Math.round(data.ram_percent || data.memory || (data.ram && data.ram.percent) || 0);
            const ramUsed = data.ram_used_gb || (data.ram && data.ram.used_gb) || 0;
            const ramTotal = data.ram_total_gb || (data.ram && data.ram.total_gb) || 0;
            
            const ramValueEl = document.getElementById('ram-value');
            const ramBarEl = document.getElementById('ram-bar');
            const ramUsedEl = document.getElementById('ram-used');
            const ramTotalEl = document.getElementById('ram-total');
            
            if (ramValueEl) ramValueEl.innerHTML = `${ramPercent}<span class="metric-unit">%</span>`;
            if (ramBarEl) ramBarEl.style.width = `${ramPercent}%`;
            if (ramUsedEl) ramUsedEl.textContent = `Used: ${ramUsed.toFixed ? ramUsed.toFixed(1) : ramUsed} GB`;
            if (ramTotalEl) ramTotalEl.textContent = `Total: ${ramTotal} GB`;
            
            // Disk - supporta formato nuovo e legacy
            const diskPercent = Math.round(data.disk_percent || (data.disk && data.disk.percent) || 0);
            const diskUsed = data.disk_used_gb || (data.disk && data.disk.used_gb) || 0;
            const diskTotal = data.disk_total_gb || (data.disk && data.disk.total_gb) || 0;
            
            const diskValueEl = document.getElementById('disk-value');
            const diskBarEl = document.getElementById('disk-bar');
            const diskUsedEl = document.getElementById('disk-used');
            const diskTotalEl = document.getElementById('disk-total');
            
            if (diskValueEl) diskValueEl.innerHTML = `${diskPercent}<span class="metric-unit">%</span>`;
            if (diskBarEl) diskBarEl.style.width = `${diskPercent}%`;
            if (diskUsedEl) diskUsedEl.textContent = `Used: ${diskUsed} GB`;
            if (diskTotalEl) diskTotalEl.textContent = `Total: ${diskTotal} GB`;
            
            // Network - supporta formato nuovo e legacy
            const download = Math.round(data.network_download_kbs || (data.network && data.network.download_kbs) || 0);
            const upload = Math.round(data.network_upload_kbs || (data.network && data.network.upload_kbs) || 0);
            const total = download + upload;
            
            const networkValueEl = document.getElementById('network-value');
            const networkBarEl = document.getElementById('network-bar');
            const networkDownEl = document.getElementById('network-down');
            const networkUpEl = document.getElementById('network-up');
            
            if (networkValueEl) networkValueEl.innerHTML = `${total}<span class="metric-unit">KB/s</span>`;
            if (networkBarEl) networkBarEl.style.width = `${Math.min(total / 10, 100)}%`;
            if (networkDownEl) networkDownEl.textContent = `â†“ ${download} KB/s`;
            if (networkUpEl) networkUpEl.textContent = `â†‘ ${upload} KB/s`;
        }
        
        async function checkServicesStatus() {
            // Check Backend
            try {
                const backendRes = await fetch(`${API_BASE}/api/gideon/health`, { timeout: 3000 });
                document.getElementById('backend-status').textContent = backendRes.ok ? 'ONLINE' : 'ERROR';
                document.getElementById('backend-status').className = `service-status ${backendRes.ok ? 'online' : 'offline'}`;
            } catch {
                document.getElementById('backend-status').textContent = 'OFFLINE';
                document.getElementById('backend-status').className = 'service-status offline';
            }
            
            // Check TTS
            try {
                const ttsRes = await fetch(`${API_BASE}/api/tts/voice-info`, { timeout: 3000 });
                const ttsServiceEl = document.getElementById('tts-service-status');
                if (ttsServiceEl) {
                    ttsServiceEl.textContent = ttsRes.ok ? 'ONLINE' : 'ERROR';
                    ttsServiceEl.className = `service-status ${ttsRes.ok ? 'online' : 'offline'}`;
                }
            } catch {
                const ttsServiceEl = document.getElementById('tts-service-status');
                if (ttsServiceEl) {
                    ttsServiceEl.textContent = 'OFFLINE';
                    ttsServiceEl.className = 'service-status offline';
                }
            }
            
            // Check AI Provider
            try {
                const aiRes = await fetch(`${API_BASE}/api/ai/status`, { timeout: 3000 });
                document.getElementById('ai-status').textContent = aiRes.ok ? 'ONLINE' : 'WARNING';
                document.getElementById('ai-status').className = `service-status ${aiRes.ok ? 'online' : 'warning'}`;
            } catch {
                document.getElementById('ai-status').textContent = 'WARNING';
                document.getElementById('ai-status').className = 'service-status warning';
            }
            
            // Frontend is always online if we're here
            document.getElementById('frontend-status').textContent = 'ONLINE';
            document.getElementById('frontend-status').className = 'service-status online';
        }
        
        function addActivity(text) {
            const feed = document.getElementById('activity-feed');
            if (!feed) return;
            
            const time = new Date().toLocaleTimeString('it-IT', { hour: '2-digit', minute: '2-digit' });
            const item = document.createElement('div');
            item.className = 'activity-item';
            item.innerHTML = `
                <span class="activity-time">${time}</span>
                <span class="activity-text">${text}</span>
            `;
            
            // Add to top
            feed.insertBefore(item, feed.firstChild);
            
            // Keep only last 20 items
            while (feed.children.length > 20) {
                feed.removeChild(feed.lastChild);
            }
            
            actionsCount++;
        }
        
        // ============ UTILITIES ============
        function updateSessionTime() {
            const elapsed = Math.floor((Date.now() - state.sessionStartTime) / 1000);
            const minutes = Math.floor(elapsed / 60);
            const seconds = elapsed % 60;
            document.getElementById('session-time').textContent = 
                `${minutes}:${seconds.toString().padStart(2, '0')}`;
        }
        
        function updateDateTime() {
            const now = new Date();
            
            // Update date
            const dateEl = document.getElementById('current-date');
            if (dateEl) {
                dateEl.textContent = now.toLocaleDateString('it-IT', {
                    weekday: 'short',
                    day: '2-digit',
                    month: 'short',
                    year: 'numeric'
                });
            }
            
            // Update time
            const timeEl = document.getElementById('current-time');
            if (timeEl) {
                timeEl.textContent = now.toLocaleTimeString('it-IT', {
                    hour: '2-digit',
                    minute: '2-digit',
                    second: '2-digit'
                });
            }
        }
        
        async function checkConnectionStatus() {
            const statusDot = document.getElementById('status-dot');
            const statusText = document.getElementById('status-text');
            
            if (!statusDot || !statusText) return;
            
            try {
                const response = await fetch(`${API_BASE}/health`, {
                    method: 'GET',
                    timeout: 3000
                });
                
                if (response.ok) {
                    // Online
                    statusDot.style.background = 'var(--neon-green)';
                    statusDot.style.boxShadow = '0 0 10px var(--neon-green)';
                    statusText.textContent = 'ONLINE';
                    statusText.style.color = 'var(--neon-green)';
                    state.isConnected = true;
                } else {
                    setOfflineStatus();
                }
            } catch (error) {
                setOfflineStatus();
            }
        }
        
        function setOfflineStatus() {
            const statusDot = document.getElementById('status-dot');
            const statusText = document.getElementById('status-text');
            
            if (statusDot) {
                statusDot.style.background = 'var(--neon-red)';
                statusDot.style.boxShadow = '0 0 10px var(--neon-red)';
            }
            if (statusText) {
                statusText.textContent = 'OFFLINE';
                statusText.style.color = 'var(--neon-red)';
            }
            state.isConnected = false;
        }
        
        function addLog(message) {
            const logs = document.getElementById('logs-container');
            const time = new Date().toLocaleTimeString('it-IT');
            logs.innerHTML += `<br>[${time}] ${message}`;
            logs.scrollTop = logs.scrollHeight;
            
            // Also add to activity feed
            addActivity(message);
        }
        
        // ============ AVATAR 3D FUNCTIONS ============
        let avatarWS = null;
        let avatarMinimized = false;
        
        function initAvatar() {
            console.log('ðŸŽ­ Initializing Avatar System...');
            connectAvatarWebSocket();
            startAvatarHUDUpdates();
            syncAvatarWithMode();
        }
        
        function connectAvatarWebSocket() {
            if (avatarWS && avatarWS.readyState === WebSocket.OPEN) return;
            
            try {
                avatarWS = new WebSocket('ws://127.0.0.1:8001/api/avatar/ws');
                
                avatarWS.onopen = () => {
                    console.log('ðŸŽ­ Avatar WebSocket connected');
                    setAvatarState('idle');
                };
                
                avatarWS.onmessage = (event) => {
                    try {
                        const data = JSON.parse(event.data);
                        handleAvatarUpdate(data);
                    } catch (e) {
                        console.warn('Avatar WS parse error:', e);
                    }
                };
                
                avatarWS.onclose = () => {
                    console.log('ðŸŽ­ Avatar WebSocket closed, reconnecting...');
                    setTimeout(connectAvatarWebSocket, 3000);
                };
                
                avatarWS.onerror = (error) => {
                    console.warn('ðŸŽ­ Avatar WebSocket error:', error);
                };
            } catch (e) {
                console.warn('ðŸŽ­ Avatar WebSocket failed:', e);
            }
        }
        
        function handleAvatarUpdate(data) {
            const container = document.getElementById('avatarContainer');
            if (!container) return;
            
            // Update state
            if (data.state) {
                setAvatarState(data.state);
            }
            
            // Update expression
            if (data.expression) {
                setAvatarExpression(data.expression);
            }
            
            // Update mode
            if (data.mode) {
                container.setAttribute('data-mode', data.mode);
            }
            
            // Update HUD
            if (data.hud) {
                updateAvatarHUD(data.hud);
            }
            
            // Handle lip sync
            if (data.lipsync) {
                setAvatarSpeaking(data.lipsync.speaking);
            }
        }
        
        function setAvatarState(state) {
            const container = document.getElementById('avatarContainer');
            const statusEl = document.getElementById('avatarStatus');
            if (!container) return;
            
            container.setAttribute('data-state', state);
            
            const stateLabels = {
                'idle': 'READY',
                'listening': 'LISTENING...',
                'thinking': 'PROCESSING...',
                'speaking': 'SPEAKING...',
                'processing': 'ANALYZING...',
                'alert': 'ALERT!',
                'celebrating': 'âœ“ SUCCESS',
                'confused': '? UNCERTAIN'
            };
            
            if (statusEl) {
                statusEl.textContent = stateLabels[state] || state.toUpperCase();
            }
        }
        
        function setAvatarExpression(expression) {
            const leftEye = document.getElementById('leftEye');
            const rightEye = document.getElementById('rightEye');
            const mouth = document.getElementById('avatarMouth');
            
            // Reset styles
            if (leftEye) leftEye.style.transform = '';
            if (rightEye) rightEye.style.transform = '';
            if (mouth) mouth.style.borderRadius = '0 0 15px 15px';
            
            switch(expression) {
                case 'happy':
                    if (leftEye) leftEye.style.transform = 'scaleY(0.7)';
                    if (rightEye) rightEye.style.transform = 'scaleY(0.7)';
                    if (mouth) mouth.style.borderRadius = '50%';
                    break;
                case 'thinking':
                    if (leftEye) leftEye.style.transform = 'translateX(3px)';
                    if (rightEye) rightEye.style.transform = 'translateX(3px)';
                    break;
                case 'surprised':
                    if (leftEye) leftEye.style.transform = 'scale(1.2)';
                    if (rightEye) rightEye.style.transform = 'scale(1.2)';
                    if (mouth) mouth.style.borderRadius = '50%';
                    break;
                case 'focused':
                    if (leftEye) leftEye.style.transform = 'scaleY(0.6)';
                    if (rightEye) rightEye.style.transform = 'scaleY(0.6)';
                    break;
            }
        }
        
        function setAvatarSpeaking(isSpeaking) {
            const container = document.getElementById('avatarContainer');
            const mouth = document.getElementById('avatarMouth');
            
            if (container) {
                container.setAttribute('data-speaking', isSpeaking ? 'true' : 'false');
            }
            
            if (mouth) {
                if (isSpeaking) {
                    mouth.classList.add('speaking');
                    setAvatarState('speaking');
                } else {
                    mouth.classList.remove('speaking');
                    setAvatarState('idle');
                }
            }
        }
        
        function toggleAvatarSize() {
            const container = document.getElementById('avatarContainer');
            const btn = container.querySelector('.avatar-toggle');
            avatarMinimized = !avatarMinimized;
            
            if (avatarMinimized) {
                container.classList.add('avatar-minimized');
                btn.textContent = 'â–¶';
            } else {
                container.classList.remove('avatar-minimized');
                btn.textContent = 'â—€';
            }
        }
        
        function syncAvatarWithMode() {
            const container = document.getElementById('avatarContainer');
            if (container && state.currentMode) {
                container.setAttribute('data-mode', state.currentMode);
            }
        }
        
        function startAvatarHUDUpdates() {
            // Update HUD every 5 seconds with system info
            setInterval(async () => {
                try {
                    const response = await fetch('http://127.0.0.1:8001/api/system/load');
                    if (response.ok) {
                        const data = await response.json();
                        updateAvatarHUD({
                            cpu: data.cpu || 0,
                            memory: data.memory || 0,
                            network: 'OK'
                        });
                    }
                } catch (e) {
                    // Ignore errors
                }
            }, 5000);
        }
        
        function updateAvatarHUD(data) {
            const cpuEl = document.getElementById('hudCpu');
            const memEl = document.getElementById('hudMem');
            const netEl = document.getElementById('hudNet');
            
            if (cpuEl && data.cpu !== undefined) {
                cpuEl.textContent = `${Math.round(data.cpu)}%`;
            }
            if (memEl && data.memory !== undefined) {
                memEl.textContent = `${Math.round(data.memory)}%`;
            }
            if (netEl && data.network !== undefined) {
                netEl.textContent = data.network;
            }
        }
        
        // Hook avatar into existing TTS speak function
        const originalSpeak = typeof speak === 'function' ? speak : null;
        if (originalSpeak) {
            window.speak = function(text) {
                setAvatarSpeaking(true);
                setAvatarState('speaking');
                return originalSpeak(text).finally(() => {
                    setAvatarSpeaking(false);
                    setAvatarState('idle');
                });
            };
        }
        
        // Hook avatar into mode changes
        const originalModeObserver = new MutationObserver((mutations) => {
            mutations.forEach((mutation) => {
                if (mutation.attributeName === 'data-mode') {
                    syncAvatarWithMode();
                }
            });
        });
        
        // Initialize monitor when DOM is ready
        document.addEventListener('DOMContentLoaded', () => {
            setTimeout(initMonitor, 500);
            setTimeout(initAvatar, 1000);  // Initialize Avatar 3D
        });
        
        // Close panels on Escape
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape') {
                // Close all overlays
                document.querySelectorAll('.panel-overlay.active').forEach(p => p.classList.remove('active'));
                
                // Close automation panel
                const automationPanel = document.getElementById('automation-panel');
                if (automationPanel && automationPanel.classList.contains('active')) {
                    toggleAutomationPanel();
                }
                
                // Close pilot dialog
                const pilotDialog = document.getElementById('pilot-dialog');
                if (pilotDialog && pilotDialog.classList.contains('active')) {
                    closePilotDialog();
                }
                
                // Close AI Hub modal
                closeAIHubModal();
                
                // Close camera if open
                closeCamera();
            }
        });
        
        // Close panels on overlay click
        document.querySelectorAll('.panel-overlay').forEach(overlay => {
            overlay.addEventListener('click', (e) => {
                if (e.target === overlay) {
                    overlay.classList.remove('active');
                }
            });
        });
    </script>
</body>
</html>

