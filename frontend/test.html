<!DOCTYPE html>
<html>
<head>
    <title>Test WebSocket Gideon</title>
</head>
<body>
    <h1>Test Connessione WebSocket</h1>
    <div id="status">Connessione...</div>
    <button onclick="sendTest()">Invia Test</button>
    <div id="log"></div>

    <script>
        let ws = null;
        
        function log(msg) {
            document.getElementById('log').innerHTML += `<p>${msg}</p>`;
            console.log(msg);
        }
        
        // Connetti WebSocket
        ws = new WebSocket('ws://127.0.0.1:8001/ws');
        
        ws.onopen = () => {
            document.getElementById('status').textContent = '‚úÖ CONNESSO!';
            document.getElementById('status').style.color = 'green';
            log('‚úÖ WebSocket connesso!');
        };
        
        ws.onclose = () => {
            document.getElementById('status').textContent = '‚ùå DISCONNESSO';
            document.getElementById('status').style.color = 'red';
            log('‚ùå WebSocket disconnesso');
        };
        
        ws.onerror = (error) => {
            document.getElementById('status').textContent = '‚ö†Ô∏è ERRORE';
            document.getElementById('status').style.color = 'orange';
            log('‚ö†Ô∏è Errore: ' + error);
        };
        
        ws.onmessage = (event) => {
            const data = JSON.parse(event.data);
            log('üì© Ricevuto: ' + JSON.stringify(data));
        };
        
        function sendTest() {
            if (ws && ws.readyState === WebSocket.OPEN) {
                ws.send(JSON.stringify({
                    type: 'text_message',
                    payload: { text: 'ciao test' }
                }));
                log('üì§ Inviato: ciao test');
            } else {
                log('‚ö†Ô∏è WebSocket non connesso');
            }
        }
    </script>
</body>
</html>
